import{s as D,ad as E,a2 as T,_ as M,B as g,T as R,m as k,G as p,q as c,k as m,W as V,o as n,v as s,x as l,l as r,J as y,I as d,X as h,L as w,t as f,F as v,H as I,K}from"./bootstrap.js";import{c as j}from"./DataTableActions.js";function q(e){const{pass_code:t}=e;let a={pass_code:[t,"isRequired"]};const _=new E(T),{errors:o,isValid:i}=_.validate(a);return D.dispatch("setValidationError",o),{errors:o,isValid:i}}const H={name:"barcode-modal",description:"BarCode Modal component",props:{showModal:{type:Boolean,default:!1},two_factor:{type:Boolean,default:!1},onClose:{type:Function},color:{type:String,default:"#1d78ff"},buttonStyle:{type:Object,default:()=>{}},inputStyle:{type:Object,default:()=>{}},linkStyle:{type:Object,default:()=>{}},from:{type:String,default:""}},data(){return{isDisabled:!0,containerStyle:{width:"600px"},loading:!1,showBarcode:!0,btnName:"next",passwordVerified:!1,password:"",labelStyle:{visibility:"hidden"},remember:!0,verifyLoader:!1,showPasscode:!1,showKeycode:!1,pass_code:"",factorData:"",codeVerified:!1,showPasswordVerify:!1,recoveryCopied:!1,recoveryCode:"",copied:!1,downloaded:!1}},computed:{shouldHideCloseButtons(){return this.two_factor||this.from==="client"}},beforeMount(){this.getRequiredPass()},methods:{getUserData(){return!0},getRequiredPass(){this.loading=!0,g.get("/show/verify-password").then(e=>{this.passwordVerified=!0,this.getRecoveryCode()}).catch(e=>{this.showPasswordVerify=!0,this.loading=!1})},getRecoveryCode(){this.loading=!0,g.post("/2fa-recovery-code").then(e=>{this.recoveryCode=e.data.data.code,this.loading=!1}).catch(e=>{this.loading=!1})},printRecovery(){var e=window.open("","","left=0,top=0,width=800,height=600,toolbar=0,scrollbars=0,status=0");e.document.write(this.recoveryCode),e.document.close(),e.focus(),e.print(),setTimeout(function(){e.close()},5)},copyToClipboard(){j(this.recoveryCode),this.copied=!0,this.showCopyIconAfterCopying()},showCopyIconAfterCopying(){setTimeout(()=>{this.copied=!1},5e3)},downloadCodes(){this.downloaded=!0,setTimeout(()=>{this.downloaded=!1},5e3)},afterCopy(){this.recoveryCopied=!0,this.getBarCode()},isValid(){const{errors:e,isValid:t}=q(this.$data);return t},getBarCode(){this.loading=!0,g.post("/2fa/enable").then(e=>{this.factorData=e.data.data,this.loading=!1}).catch(e=>{this.loading=!1})},onChange(e,t){this[t]=e},validatePass(){this.verifyLoader=!0;const e={};e.password=this.password,g.post("/verify/password",e).then(t=>{this.passwordVerified=!0,this.verifyLoader=!1,this.getRecoveryCode()}).catch(t=>{this.passwordVerified=!1,this.verifyLoader=!1,this.$store.dispatch("setValidationError",{password:"This field is Required."})})},passCode(){this.showBarcode=!1,this.showPasscode=!0},barCode(){this.showPasscode=!1,this.showBarcode=!0,this.pass_code=""},keyCode(){this.showBarcode=!1,this.showPasscode=!1,this.showKeycode=!0},keyCodeReverse(){this.showBarcode=!0,this.showPasscode=!1,this.showKeycode=!1},validatePassCode(){if(this.isValid()){this.verifyLoader=!0;const e={};e.totp=this.pass_code,g.post("/2fa/setupValidate",e).then(t=>{window.emitter.emit("updateEditData",!0),this.codeVerified=!0,this.verifyLoader=!1}).catch(t=>{this.verifyLoader=!1,this.$store.dispatch("setValidationError",{pass_code:"Wrong code. Try again"})})}},triggerEvent(e){var t=e.which||e.keyCode;t===13&&(this.passwordVerified||this.validatePass(),document.getElementById("pass").value!==""&&this.validatePassCode())},onDone(){this.onClose("2faDone")}},components:{"text-field":R}},N={class:"modal-title"},z={key:0,class:"text-center"},F={class:"col-sm-offset-3 offset-sm-2 text-start"},O={class:"col-sm-offset-4",id:"barcode_scan"},A=["innerHTML"],W={class:"row"},G={class:"col-sm-8 col-sm-offset-2 offset-sm-2 text-start"},J={class:"col-sm-8 col-sm-offset-2 offset-sm-2",id:"secret_key"},U=["value","keyuplistener"],X={class:"col-sm-8 col-sm-offset-2 offset-sm-2 text-start"},Q={class:"col-sm-offset-3 offset-sm-2 text-left"},Y={key:1},Z={key:1,class:"text-start"},x={class:"card card-light px-0"},$={class:"card-header"},ee={class:"card-title"},te={class:"card-tools"},se=["href"],oe={class:"card-body"},le={class:"row"},ae={class:"col-sm-6 text-center"},ne={href:"https://1Password.com",target:"_blank"},re={href:"https://keepersecurity.com.com",target:"_blank"},ie={key:1,class:"row"},de={key:2,class:"row"},ce=["disabled","keyupListener"],ue=["disabled","keyupListener"],fe=["disabled"];function he(e,t,a,_,o,i){const b=m("text-field"),B=m("reuse-loader"),P=m("custom-loader"),S=m("modal"),L=V("focus-first-input"),C=V("tooltip");return a.showModal?(n(),k(S,{key:0,showModal:a.showModal,onClose:a.onClose,containerStyle:o.containerStyle,showIconCloseBtn:i.shouldHideCloseButtons,showCloseBtn:!1},{title:p(()=>[s("h4",N,l(e.lang("setup_authenticator")),1)]),fields:p(()=>[o.loading?c("",!0):(n(),r("div",{key:0,class:f({bar_row:a.from==="client"})},[o.passwordVerified?(n(),r("div",z,[o.recoveryCopied?(n(),r(y,{key:0},[o.showBarcode&&!o.showPasscode?(n(),r(y,{key:0},[s("ul",F,[s("li",null,l(e.lang("get_authenticator_app")),1),s("li",null,[d(l(e.lang("app_select"))+" ",1),s("b",null,l(e.lang("set_up_account")),1)]),s("li",null,[d(l(e.lang("choose"))+" ",1),s("b",null,l(e.lang("scan_a_barcode")),1)])]),s("div",O,[(n(),r("svg",{innerHTML:o.factorData.image},null,8,A))]),s("a",{href:"javascript:;",id:"scan",onClick:t[0]||(t[0]=u=>i.keyCode()),style:h(a.linkStyle)},l(e.lang("cant_scan")),5)],64)):c("",!0),o.showKeycode&&!o.showBarcode&&!o.showPasscode?(n(),r(y,{key:1},[s("div",W,[s("div",G,[s("ul",null,[s("li",null,[d(l(e.lang("tap"))+" ",1),s("b",null,l(e.lang("menu")),1),d(", "+l(e.lang("then"))+" ",1),s("b",null,l(e.lang("set_up_account")),1)]),s("li",null,[d(l(e.lang("tap"))+" ",1),s("b",null,l(e.lang("enter_provided_key")),1)]),s("li",null,l(e.lang("enter_you_email_and_key")),1)])]),s("div",J,[s("input",{type:"text",value:o.factorData.secret,keyuplistener:i.triggerEvent,class:"form-control",readonly:""},null,8,U)]),s("div",X,[s("ul",Q,[s("li",null,l(e.lang("get_authenticator_app")),1),s("li",null,[d(l(e.lang("app_select"))+" ",1),s("b",null,l(e.lang("set_up_account")),1)]),s("li",null,l(e.lang("scan_a_barcode")),1),s("li",null,[d(l(e.lang("make_sure_time_based"))+" ",1),s("b",null,l(e.lang("time_based")),1),d(" "+l(e.lang("add"))+" ",1),s("b",null,l(e.lang("to_finish")),1),t[10]||(t[10]=d("."))])])])]),s("a",{href:"javascript:;",id:"scan",onClick:t[1]||(t[1]=u=>i.keyCodeReverse()),style:h(a.linkStyle)},l(e.lang("scan_barcode")),5)],64)):c("",!0),o.showPasscode&&!o.showBarcode?(n(),r(y,{key:2},[o.codeVerified?c("",!0):w((n(),r("div",{key:0,class:f(["row",{flex_row:a.from==="client"}])},[v(b,{label:e.lang("enter_the_code_you_see_in_the_app"),value:o.pass_code,type:"text",name:"pass_code",id:"pass",placehold:"Enter Passcode...",keyupListener:i.triggerEvent,onChange:i.onChange,classname:"col-sm-12 text-start",inputStyle:a.inputStyle},null,8,["label","value","keyupListener","onChange","inputStyle"])],2)),[[L]]),o.codeVerified?(n(),r("span",Y,l(e.lang("you_are_all_set_from_now_on_you_will_use_authenticator_to_sign_in_to_your_account")),1)):c("",!0)],64)):c("",!0)],64)):(n(),r("div",Z,[s("p",null,l(e.lang("recovery_codes_are_used")),1),s("div",{class:f([a.from==="client"?"":"row","mx-1"])},[s("div",x,[s("div",$,[s("h3",ee,l(e.trans("recovery_codes")),1),s("div",te,[w((n(),r("a",{href:e.basePath()+"/2fa/downloadRecoveryCode",class:"btn btn-tool",target:"_blank",onClick:t[2]||(t[2]=(...u)=>i.downloadCodes&&i.downloadCodes(...u))},t[11]||(t[11]=[s("i",{class:"fas fa-download"},null,-1)]),8,se)),[[C,e.trans("download")]]),w((n(),r("button",{onClick:t[3]||(t[3]=I((...u)=>i.copyToClipboard&&i.copyToClipboard(...u),["prevent"])),class:"btn btn-tool"},[s("i",{class:f(o.copied?"fas fa-check":"fas fa-clipboard")},null,2)])),[[C,e.trans("copy")]])])]),s("div",oe,[s("div",le,[(n(!0),r(y,null,K(o.recoveryCode,u=>(n(),r("div",ae,[s("p",null,l(u),1)]))),256))])])])],2),s("p",null,[d(l(e.lang("treat_your_recover_codes"))+" ",1),t[12]||(t[12]=s("a",{href:"https://lastpass.com",target:"_blank"},"Lastpass",-1)),t[13]||(t[13]=d(", ")),s("a",ne,l(e.lang("1password")),1),d(", "+l(e.lang("keeper_or"))+" ",1),s("a",re,l(e.lang("keeper")),1),t[14]||(t[14]=d(". "))])]))])):c("",!0),o.showPasswordVerify&&!o.passwordVerified?(n(),k(b,{key:1,label:e.lang("to_continue_first_verify"),value:o.password,type:"password",name:"password",placehold:"Enter Password...",keyupListener:i.triggerEvent,onChange:i.onChange,classname:"col-sm-12",inputStyle:a.inputStyle,autofocus:!0},null,8,["label","value","keyupListener","onChange","inputStyle"])):c("",!0)],2)),o.loading?(n(),r("div",ie,[v(B,{"animation-duration":4e3,size:60,color:a.color},null,8,["color"])])):c("",!0),o.verifyLoader?(n(),r("div",de,[v(P,{duration:4e3,color:a.color},null,8,["color"])])):c("",!0)]),controls:p(()=>[!o.passwordVerified&&!o.codeVerified?(n(),r("button",{key:0,type:"button",class:f(["btn",[{"btn-primary pull-right float-end":a.from!=="client"},{"btn-custom text-capitalize  pull-right float-end":a.from==="client"}]]),disabled:!o.password,onClick:t[4]||(t[4]=u=>i.validatePass()),keyupListener:i.triggerEvent,style:h(a.buttonStyle)},[t[15]||(t[15]=s("i",{class:"fas fa-check"},null,-1)),d(" "+l(e.lang("validate")),1)],14,ce)):c("",!0),o.passwordVerified?(n(),r(y,{key:1},[o.recoveryCopied?(n(),r(y,{key:0},[o.showBarcode||o.showKeycode&&!o.showPasscode?(n(),r("button",{key:0,class:f(["btn",[{"btn-primary pull-right float-end":a.from!=="client"},{"btn-custom  pull-right float-end":a.from==="client"}]]),onClick:t[5]||(t[5]=u=>i.passCode()),style:h(a.buttonStyle)},[d(l(e.lang("next"))+"   ",1),t[16]||(t[16]=s("i",{class:"fas fa-arrow-right"},null,-1))],6)):c("",!0),o.showPasscode&&!o.codeVerified?(n(),r("button",{key:1,class:f(["btn",[{"btn-light pull-right float-end":a.from!=="client"},{"btn-light text_uppercase  pull-right float-end":a.from==="client"}]]),onClick:t[6]||(t[6]=u=>i.barCode()),style:h({buttonStyle:a.from!=="client"})},[t[17]||(t[17]=s("i",{class:"fas fa-arrow-left"},null,-1)),d("  "+l(e.lang("previous")),1)],6)):c("",!0),o.showPasscode&&!o.codeVerified?(n(),r("button",{key:2,type:"button",class:f(["btn ms-auto",[{"btn-primary  pull-right float-end":a.from!=="client"},{"btn-custom  pull-right float-end":a.from==="client"}]]),disabled:!o.pass_code,onClick:t[7]||(t[7]=u=>i.validatePassCode()),keyupListener:i.triggerEvent,style:h(a.buttonStyle)},[t[18]||(t[18]=s("i",{class:"fas fa-check"},null,-1)),d(" "+l(e.lang("verify")),1)],14,ue)):c("",!0)],64)):(n(),r("button",{key:1,class:f(["btn",[{"btn-primary pull-right float-end":a.from!=="client"},{"btn-custom  pull-right float-end":a.from==="client"}]]),style:h(a.buttonStyle),disabled:!(o.copied||o.downloaded),onClick:t[8]||(t[8]=(...u)=>i.afterCopy&&i.afterCopy(...u))},[d(l(e.lang("next"))+"   ",1),t[19]||(t[19]=s("i",{class:"fas fa-arrow-right"},null,-1))],14,fe))],64)):c("",!0),o.codeVerified?(n(),r("button",{key:2,class:f(["btn btn-custom",[{"btn-primary float-end":a.from!=="client"},{"btn-custom float-end":a.from==="client"}]]),onClick:t[9]||(t[9]=u=>i.onDone()),style:h(a.buttonStyle)},[t[20]||(t[20]=s("i",{class:"fas fa-check"},null,-1)),d(" "+l(e.lang("done")),1)],6)):c("",!0)]),_:1},8,["showModal","onClose","containerStyle","showIconCloseBtn"])):c("",!0)}const me=M(H,[["render",he]]);export{me as B};
