import{B as T,an as S,_ as C,o as a,l as o,t as p,v as t,I as _,x as r,J as g,K as v,q as u,k as f,m as D,G as M,C as I,E as x,W as A,F as k,L as H,a1 as O,N as B,S as U,O as G,s as V}from"../chunks/bootstrap.js";import{r as N,A as q}from"../chunks/adminRouter.js";import{S as E}from"../chunks/FormGenerator.js";import"../chunks/vue-router.js";import"../chunks/HelpSection.js";import"../chunks/AdminNavigationBar.js";import"../chunks/Checkbox.js";import"../chunks/DataTableActions.js";const F={name:"help-widget",props:{from:{type:String,default:""},data:{type:[String,Object],default:{}}},data(){return{monitorClass:"monitor",btnClass:"health-monitor-section",iconClass:"prime fas fa-heartbeat",widgetOpen:!1,alertList:[],loading:!0}},beforeMount(){this.getData()},methods:{toggleHealthMonitor(){this.widgetOpen=!this.widgetOpen,this.monitorClass=this.monitorClass=="monitor"?"monitor is-visible":"monitor",this.btnClass=this.btnClass=="health-monitor-section"?"health-monitor-section is-float is-visible":"health-monitor-section",this.iconClass=this.iconClass=="prime fas fa-heartbeat"?"prime fas fa-times is-active is-visible":"prime fas fa-heartbeat"},getData(){T.get("/health/system/alerts").then(e=>{this.alertList=e.data.data,this.loading=!1}).catch(e=>{this.loading=!1})}},computed:{...S(["isSettingActive"]),hasIsSettingActiveGetter(){return this.$store.getters.hasOwnProperty("isSettingActive")},healthSectionClass(){return{"help-section-true":this.hasIsSettingActiveGetter&&this.isSettingActive("conversation-widget"),"help-section-false":!(this.hasIsSettingActiveGetter&&this.isSettingActive("conversation-widget"))}},monitorClassCondition(){return{"monitor-default":this.hasIsSettingActiveGetter&&this.isSettingActive("conversation-widget"),"monitor-custom":!(this.hasIsSettingActiveGetter&&this.isSettingActive("conversation-widget"))}}}},R={class:"health-header"},W={class:"health-option"},z={id:"health-head"},K={class:"health-body card-danger-outline-left"},J={class:"card mb-2 red-body"},Q={class:"card-body p-2"},X=["innerHTML"],Y={key:1,class:"monitor-tooltip"},Z={class:"badge text-bg-secondary alert-count"},j={key:0,class:"health-tooltip"},tt={class:"health-tooltip-p"};function et(e,s,n,b,i,d){return a(),o("div",{class:p(["health-monitor",d.healthSectionClass])},[i.widgetOpen?(a(),o("div",{key:0,class:p([i.monitorClass,d.monitorClassCondition])},[t("div",R,[t("div",W,[t("h5",z,[s[1]||(s[1]=t("i",{class:"fas fa-exclamation-triangle text-white","aria-hidden":"true"},null,-1)),_(" "+r(e.trans("needing_attention")),1)])])]),t("div",K,[(a(!0),o(g,null,v(i.alertList,m=>(a(),o("div",J,[t("div",Q,[t("h6",null,[s[2]||(s[2]=t("i",{class:"fas fa-exclamation-triangle","aria-hidden":"true"},null,-1)),s[3]||(s[3]=_(" ")),t("b",null,r(m.check),1)]),t("p",{innerHTML:m.value},null,8,X)])]))),256))]),s[4]||(s[4]=t("div",{class:"health-footer card-footer card-danger-outline-left pt-1"},null,-1))],2)):u("",!0),!i.loading&&i.alertList.length?(a(),o("div",Y,[t("a",{id:"health-sidebar",class:p(i.btnClass),onClick:s[0]||(s[0]=(...m)=>d.toggleHealthMonitor&&d.toggleHealthMonitor(...m))},[t("i",{class:p(i.iconClass)},null,2),t("span",Z,r(i.alertList.length>9?"9+":i.alertList.length),1)],2),i.widgetOpen?u("",!0):(a(),o("div",j,[t("p",tt,r(e.trans("health_monitor")),1)]))])):u("",!0)],2)}const st=C(F,[["render",et],["__scopeId","data-v-8b462da7"]]);const at={name:"health-table-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function,default:()=>{}},data:{type:Object,default:()=>{}}}},ot={class:"modal-title"},lt={id:"log_desc"},nt={class:"table table-bordered table-striped"};function it(e,s,n,b,i,d){const m=f("modal");return n.showModal?(a(),D(m,{key:0,showModal:n.showModal,onClose:n.onClose},{title:M(()=>[t("h4",ot,r(n.data.check),1)]),fields:M(()=>[t("div",lt,[t("table",nt,[t("thead",null,[t("tr",null,[(a(!0),o(g,null,v(n.data.headers,y=>(a(),o("th",null,r(y),1))),256))])]),t("tbody",null,[(a(!0),o(g,null,v(n.data.columns,y=>(a(),o("tr",null,[(a(!0),o(g,null,v(y,w=>(a(),o("td",null,r(w),1))),256))]))),256))])])])]),_:1},8,["showModal","onClose"])):u("",!0)}const rt=C(at,[["render",it],["__scopeId","data-v-5b7b1391"]]);const ct={name:"system-health",data(){return{loading:!1,healthData:[],viewItem:"",showModal:!1,success:{name:"successful-checks",icon:"fas fa-check",bg_class:"success",data:[]},warning:{name:"warnings",icon:"fas fa-warning",bg_class:"warning",data:[]},danger:{name:"needing-attention",icon:"fas fa-times",bg_class:"danger",data:[]}}},beforeMount(){this.getData()},methods:{openView(e){this.viewItem=e,this.showModal=!0},onClose(e){this.viewItem="",this.showModal=!1},getData(){this.loading=!0,axios.get("/health/getServerChecks").then(e=>{this.success.data=e.data.data.Ok,this.warning.data=e.data.data.Warning,this.danger.data=e.data.data.Danger,this.healthData=[this.success,this.warning,this.danger],this.loading=!1,this.getBillHealth()}).catch(e=>{this.healthData=[this.success,this.warning,this.danger],this.loading=!1})},getBillHealth(){axios.get("/health/getServerChecks/billing").then(e=>{this.success.data.push(...e.data.data.Ok),this.warning.data.push(...e.data.data.Warning),this.danger.data.push(...e.data.data.Danger),this.healthData=[this.success,this.warning,this.danger]}).catch(e=>{this.healthData=[this.success,this.warning,this.danger]})},markResolve(e,s){s&&setTimeout(()=>{window.location.reload()},1e3),this.loading=!0;let n=e.replace(this.basePath(),"");axios.get(n).then(b=>{I(b,"system-health"),this.loading=!1,this.getData()}).catch(b=>{x(b,"system-health"),this.loading=!1})}},components:{"health-table-modal":rt}},dt={class:"col-sm-12"},ht={key:1,class:"row"},ut={class:"col-md-4 col-sm-6 col-12"},_t={class:"info-box"},pt={class:"info-box-content"},mt={class:"info-box-number"},ft={class:"info-box-text"},gt={class:"card-header border-0"},vt={class:"card-title"},bt={class:"card-tools"},yt=["onClick"],kt={class:"card mb-2"},wt={class:"card-body p-2"},Ct=["href"],Ht={class:"fas fa-question-circle labelColor"},Mt=["innerHTML"],$t={key:0},Lt=["innerHTML"],Dt={key:1},St=["onClick"],It={key:3},xt=["onClick"];function At(e,s,n,b,i,d){const m=f("alert"),y=f("reuse-loader"),w=f("router-link"),$=f("health-table-modal"),L=A("tooltip");return a(),o("div",dt,[k(m,{"component-name":"system-health"}),i.loading?(a(),D(y,{key:0})):(a(),o("div",ht,[(a(!0),o(g,null,v(this.healthData,l=>(a(),o("div",ut,[t("div",_t,[t("span",{class:p("info-box-icon bg-"+l.bg_class)},[t("i",{class:p(l.icon)},null,2)],2),t("div",pt,[t("span",mt,r(l.data.length),1),t("span",ft,r(e.trans(l.name)),1)])]),l.data.length?(a(),o("div",{key:0,class:p(["card","card-"+l.bg_class+"-outline-left",{"collapsed-card":l.collapsed}])},[t("div",gt,[t("h3",vt,[t("i",{class:p(l.icon)},null,2),_("  "+r(e.trans(l.name)),1)]),t("div",bt,[t("button",{type:"button",class:"btn btn-tool","data-lte-toggle":"card-collapse",onClick:c=>l.collapsed=!l.collapsed},[t("i",{class:p(l.collapsed?"fas fa-plus":"fas fa-minus")},null,2)],8,yt)])]),t("div",{class:p(["card-body p-2",l.collapsed?"d-none":"d-block"])},[(a(!0),o(g,null,v(l.data,c=>(a(),o("div",kt,[t("div",wt,[t("h6",null,[t("b",null,r(c.check),1),s[0]||(s[0]=_("  ")),t("a",{href:c.tool_tip_action,target:"_blank"},[H(t("i",Ht,null,512),[[L,c.tool_tip_lang]])],8,Ct)]),t("p",{class:p(c.check=="db_storage"?"health_trace":""),innerHTML:c.value},null,10,Mt),c.process?(a(),o("ul",$t,[(a(!0),o(g,null,v(c.process,(h,P)=>(a(),o("li",null,[t("p",null,[_(r(P)+" ",1),t("span",{innerHTML:h},null,8,Lt)])]))),256))])):u("",!0),c.info?(a(),o("p",Dt,[_(r(e.trans("click_to_check"))+" ",1),k(w,{to:"/health-check/php-info"},{default:M(()=>[_(r(e.trans("php_info")),1)]),_:1})])):u("",!0),c.columns&&c.columns.length?(a(),o("button",{key:2,class:"btn btn-primary",type:"button",onClick:h=>d.openView(c)},[s[1]||(s[1]=t("i",{class:"fas fa-eye"},null,-1)),_(" "+r(e.trans("view_status")),1)],8,St)):u("",!0),c.action?(a(),o("div",It,[c.action?(a(),o("button",{key:0,class:"btn btn-primary",type:"button",onClick:h=>d.markResolve(c.action,c.refresh?c.refresh:"")},[s[2]||(s[2]=t("i",{class:"fas fa-check"},null,-1)),_(" "+r(e.trans(c.label)),1)],8,xt)):u("",!0)])):u("",!0)])]))),256))],2)],2)):u("",!0)]))),256))])),k(O,{name:"modal"},{default:M(()=>[i.showModal?(a(),D($,{key:0,onClose:d.onClose,showModal:i.showModal,data:i.viewItem},null,8,["onClose","showModal","data"])):u("",!0)]),_:1})])}const Vt=C(ct,[["render",At],["__scopeId","data-v-0153e62e"]]);const Pt={name:"health-alerts",data(){return{alertData:[],moduleLoad:!1,updateLoad:!1}},beforeMount(){this.getAlertData()},computed:{...S(["formattedTime"])},methods:{getAlertData(){this.moduleLoad=!0,axios.get("/health/check/alerts").then(e=>{this.alertData=e.data.data,this.alertData.filter(s=>s.field=="number").forEach(s=>{let n=s.value.split(" ");s.value=n[0],s.type=n[1]}),this.moduleLoad=!1}).catch(e=>{this.moduleLoad=!1})},checkValue(e){e=e||window.event;let s=e.which?e.which:e.keyCode;if(s>31&&(s<48||s>57))e.preventDefault();else return!0},onPaste(e){e=e||window.event,e.preventDefault()},updateAlerts(e){this.updateLoad=!0;let s={};s.alerts=e.map(n=>({check_id:n.id,value:n.type?(n.value?n.value:1)+" "+n.type:n.value,display:n.display?1:0})),axios.post("/api/health/alerts",s).then(n=>{I(n,"health-alerts"),this.updateLoad=!1,this.getAlertData()}).catch(n=>{x(n,"health-alerts"),this.updateLoad=!1})}},components:{"status-switch":E}},Tt={class:"col-sm-12"},Ot={key:0,class:"row"},Bt={key:1,class:"row mt-5"},Ut={key:2,class:"card card-light"},Gt={class:"card-header"},Nt={class:"card-title"},qt={class:"card-body"},Et={class:"row"},Ft={class:"col-sm-12"},Rt={class:"row p-2"},Wt={class:"table border"},zt=["title"],Kt={class:"d-flex"},Jt=["onUpdate:modelValue","disabled"],Qt=["onUpdate:modelValue","disabled"],Xt=["value"],Yt={key:0,class:"card-footer"};function Zt(e,s,n,b,i,d){const m=f("alert"),y=f("custom-loader"),w=f("reuse-loader"),$=f("toggle"),L=A("tooltip");return a(),o("div",Tt,[k(m,{componentName:"health-alerts"}),i.updateLoad?(a(),o("div",Ot,[k(y,{duration:4e3})])):u("",!0),i.moduleLoad?(a(),o("div",Bt,[k(w,{"animation-duration":4e3,color:"#1d78ff",size:60})])):(a(),o("div",Ut,[t("div",Gt,[t("h3",Nt,r(e.trans("alerts")),1)]),t("div",qt,[t("div",Et,[t("div",Ft,[t("div",Rt,[t("table",Wt,[t("thead",null,[t("tr",null,[t("th",null,r(e.trans("title")),1),t("th",null,r(e.trans("value")),1),t("th",null,r(e.trans("action")),1)])]),t("tbody",null,[(a(!0),o(g,null,v(i.alertData,(l,c)=>(a(),o("tr",{key:c},[t("td",null,[_(r(e.trans(l.check))+" ",1),l.type?H((a(),o("span",{key:0,class:"health-tool",title:l.type},s[3]||(s[3]=[t("i",{class:"fas fa-question-circle tic-pop-i h-check"},null,-1)]),8,zt)),[[L,l.type]]):u("",!0)]),t("td",Kt,[l.field=="number"?H((a(),o("input",{key:0,type:"number",min:"0","onUpdate:modelValue":h=>l.value=h,max:"999",class:"form-control ml_3",onKeypress:s[0]||(s[0]=(...h)=>d.checkValue&&d.checkValue(...h)),onPaste:s[1]||(s[1]=(...h)=>d.onPaste&&d.onPaste(...h)),placeholder:"1",disabled:!l.display},null,40,Jt)),[[B,l.value]]):u("",!0),s[4]||(s[4]=_("  ")),l.field=="select"?H((a(),o("select",{key:1,name:"alert-select","onUpdate:modelValue":h=>l.value=h,class:"form-control",disabled:!l.display},[(a(!0),o(g,null,v(l.option,h=>(a(),o("option",{value:h},r(h),9,Xt))),256))],8,Qt)),[[U,l.value]]):u("",!0)]),t("td",null,[k($,{modelValue:l.display,"onUpdate:modelValue":h=>l.display=h,class:"toggle-switch mt-2"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])])])])])]),i.updateLoad?u("",!0):(a(),o("div",Yt,[t("button",{class:"btn btn-primary float-end",onClick:s[2]||(s[2]=l=>d.updateAlerts(i.alertData))},[s[5]||(s[5]=t("i",{class:"fas fa-sync-alt"},null,-1)),_(" "+r(e.trans("update")),1)])]))]))])}const jt=C(Pt,[["render",Zt],["__scopeId","data-v-34c99b8c"]]);const te={data(){return{phpInfo:""}},created(){this.fetchPhpInfo()},methods:{fetchPhpInfo(){axios.get("/health/php/info").then(e=>{this.phpInfo=e.data}).catch(e=>{console.error(e)})}}},ee={class:"col-sm-12 text-md php-info"},se=["innerHTML"];function ae(e,s,n,b,i,d){return a(),o("div",ee,[t("div",{innerHTML:i.phpInfo},null,8,se)])}const oe=C(te,[["render",ae]]);G("health-monitor",st,"layout-loaded","monitoring-system-status");let le={path:"/health-check",component:q,name:"Health",redirect:"/health-check/settings",children:[{path:"settings",name:"Health Check Settings",component:Vt,meta:{title:"health-check",crumb:{link:{name:"admin_panel",to:"/"},active:"health-check"}}},{path:"alerts",name:"Health Check Alerts",component:jt,meta:{title:"health-check-alerts",crumb:{link:{name:"admin_panel",to:"/"},active:"health-check-alerts"}}},{path:"php-info",name:"Health Check PHP Info",component:oe,meta:{title:"health-check",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"health-check",to:"/health-check/settings"},active:"php-info"}}}]};N.addRoute(le);V.dispatch("deleteUser");V.dispatch("updateUser");
