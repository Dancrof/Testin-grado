import{f as b,e as X,k as c,o as s,m as f,G as $,v as r,x as d,l,q as u,F as g,I as D,a5 as _t,B as w,C as U,E as S,_ as C,Z,c as G,ap as K,W as j,J as A,K as I,t as x,X as Q,L,aL as W,aM as mt,A as gt,ah as ft,aO as yt,aT as bt,ad as tt,a2 as et,s as at,ag as vt,aN as Ct,T as wt}from"../chunks/bootstrap.js";import{B as rt,D as kt,P as Dt,L as St,a as st,T as Ot,U as Rt,b as $t,r as At,A as Tt}from"../chunks/agentRouter.js";import{S as it,p as M,t as ot,h as B,g as nt,a as It,b as Lt,c as Ft,d as xt,_ as Pt}from"../chunks/SDReports.js";import{h as O,j as E,L as z,B as lt,p as H,k as V,l as N,A as dt,P as jt,q as Ut,T as ct,o as Mt}from"../chunks/FormGenerator.js";import{a as Et,e as Ht}from"../chunks/DataTableActions.js";import{r as Vt,A as Nt}from"../chunks/adminRouter.js";import"../chunks/vue-router.js";import"../chunks/HelpSection.js";import"../chunks/approvalTicketRules.js";import"../chunks/BarcodeModal.js";import"../chunks/Loader.js";import"../chunks/AdminNavigationBar.js";import"../chunks/Checkbox.js";import"../chunks/EleaTicketThreadSummary.js";import"../chunks/PermaLink.js";import"../chunks/ChangeCustomFields.js";const Bt=(t={})=>{let e=[];for(const a in t)if(t.hasOwnProperty(a)&&pt(t[a])){let i={};i.key=a,i.value=t[a],e.push(i)}return e},J=(t={})=>{let e={};for(const a in t)t.hasOwnProperty(a)&&pt(t[a])&&(e[a]=t[a]);return e},pt=t=>t===0||b(t),qt=(t="n*1")=>{const e=t.split("*")[1];return"col-md-"+12/Number(e)};const Wt={class:"modal-title"},Kt={key:0},zt={key:1,class:"row"},Jt={__name:"ReportDeleteModal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},reportId:{type:Number,default:""},reportType:{type:String,default:""},type:{type:String,default:""}},emits:["refreshReportHomePage"],setup(t,{emit:e}){const a=t,i=X(!1),n=X({width:"500px"}),o=()=>{i.value=!0;let p="";p=a.reportType==="ServiceDesk Analysis"?"service-desk/api/report/delete/":"api/report/",w.delete(p+a.reportId).then(h=>{i.value=!1,a.onClose(),window.emitter.emit("refreshReportHomePage",a.type),window.emitter.emit("updateAgentSidebar"),U(h,"report-home-page")}).catch(h=>{a.onClose(),S(h,"report-home-page"),i.value=!1})};return(p,h)=>{const y=c("reuse-loader");return t.showModal?(s(),f(_t,{key:0,showModal:t.showModal,onClose:t.onClose,containerStyle:n.value},{title:$(()=>[r("h4",Wt,d(p.trans("delete")),1)]),fields:$(()=>[i.value?u("",!0):(s(),l("span",Kt,d(p.trans("are_you_sure_you_want_to_delete_this_report")),1)),i.value?(s(),l("div",zt,[g(y,{duration:4e3})])):u("",!0)]),controls:$(()=>[r("button",{type:"button",id:"submit_btn",onClick:o,class:"btn btn-secondary"},[h[0]||(h[0]=r("i",{class:"fas fa-trash"},null,-1)),D(" "+d(p.trans("delete")),1)])]),_:1},8,["showModal","onClose","containerStyle"])):u("",!0)}}};const Xt={name:"report-home-page",components:{SaveReportModal:it,"report-delete-modal":Jt},setup(){const t=Z();return{formattedTime:G(()=>t.getters.formattedTime)}},data:()=>({reportList:[],isLoading:!1,showDeleteModal:!1,showEditModal:!1,reportData:"",reportId:"",reportType:"",refreshReport:!1,from:"",type:""}),beforeMount(){let t=window.location.pathname;this.type="";const e=t.indexOf("/reports/");e!==-1&&(this.type=t.substring(e+9)),this.getReportList(this.type)},created(){window.emitter.on("refreshReportHomePage",()=>this.refreshReport=!0)},methods:{viewReport(t){return t.replace(/^\/?reports\//,"")},editReport(t,e){this.from=e==="ServiceDesk Analysis"?"sd_report_home":"report-list";let a={};a.include_filters=1,w.get("api/agent/report-config/"+t,{params:a}).then(i=>{this.reportData=i.data.data,this.showEditModal=!0}).catch(i=>{S(i,"report-home-page")}).finally(i=>{this.isLoading=!1})},getIconClass(t){return t=="fa fa-support fa-stack-1x"?"fas fa-life-ring fa-stack-1x":t=="fa fa-bank fa-stack-1x"?"fas fa-university  fa-stack-1x":t+" fa-stack-1x"},getReportList(t){let e="";(t==="public"||t==="private"||t==="default"||t==="shared")&&(e=`is_${t}=1`),this.isLoading=!0,w.get(`api/agent/report-list?${e}`).then(a=>{a.data.data?this.reportList=a.data.data:this.$router.push({path:"/reports"})}).catch(a=>{S(a,"report-home-page")}).finally(a=>{this.isLoading=!1})},subString(t,e){return K(t,e)},deleteCustomReport(t,e){this.reportId=t,this.reportType=e,this.showDeleteModal=!0},onClose(){this.showEditModal=!1,this.$store.dispatch("unsetAlert")},closeDeleteModal(){this.showDeleteModal=!1}},watch:{refreshReport(t,e){t===!0&&this.getReportList(this.type),this.refreshReport=!1}}},Yt={class:"col-sm-12"},Zt={key:1},Gt={class:"card-header"},Qt={class:"card-title"},te={class:"card-body"},ee={class:"row"},ae={class:"card report-body bg-light d-flex flex-fill"},re={class:"card-header text-muted border-bottom-0 pb-0 pt-0 row"},se={class:"card-title col-sm-12"},ie={class:"row"},oe={class:"col-sm-11 p-0"},ne={class:"fa-stack fa-1x resize-icon"},le={class:"badge-style"},de={key:0,class:"badge text-bg-info"},ce={key:1,class:"badge text-bg-success"},pe={key:2,class:"badge text-bg-danger"},he={class:"col-sm-1 p-0"},ue={class:"card-tools float-end"},_e={class:"btn-group"},me={key:0,type:"button",class:"btn btn-tool","data-bs-toggle":"dropdown"},ge={class:"dropdown-menu dropdown-menu-end custom-dropdown-menu"},fe=["onClick"],ye=["onClick"],be={class:"card-body pt-1 pb-0"},ve={class:"row"},Ce={class:"col-sm-12"},we={class:"text-muted text-sm"};function ke(t,e,a,i,n,o){const p=c("alert"),h=c("custom-loader"),y=c("router-link"),m=c("save-report-modal"),k=c("report-delete-modal"),R=j("tooltip");return s(),l("div",Yt,[g(p,{componentName:"report-home-page"}),t.isLoading?(s(),f(h,{key:0,duration:4e3})):u("",!0),t.reportList.length>0?(s(),l("div",Zt,[(s(!0),l(A,null,I(t.reportList,F=>(s(),l("div",{class:"card card-light",key:F.id},[r("div",Gt,[r("h3",Qt,d(F.category),1)]),r("div",te,[r("div",ee,[(s(!0),l(A,null,I(F.reports,v=>(s(),l("div",{class:"col-sm-4",key:v.id},[r("div",ae,[r("div",re,[r("div",se,[r("div",ie,[r("div",oe,[r("div",ne,[r("i",{class:x(o.getIconClass(v.iconClass)),style:Q({color:v.iconColor})},null,6)]),g(y,{to:o.viewReport(v.view_url),class:"text-header"},{default:$(()=>[r("b",null,d(v.name),1)]),_:2},1032,["to"]),r("sup",le,[v.is_default?(s(),l("span",de,d(t.lang("default")),1)):v.is_public?(s(),l("span",ce,d(t.lang("public")),1)):(s(),l("span",pe,d(t.lang("private")),1))])]),r("div",he,[r("div",ue,[r("div",_e,[r("span",null,[v.is_default?u("",!0):L((s(),l("button",me,e[0]||(e[0]=[r("i",{class:"fas fa-ellipsis-v"},null,-1)]))),[[R,t.trans("action")]]),r("div",ge,[r("a",{class:"dropdown-item text-dark",href:"javascript:;",onClick:T=>o.editReport(v.id,v.category)},[e[1]||(e[1]=r("i",{class:"fas fa-edit"},null,-1)),D(" "+d(t.trans("edit")),1)],8,fe),v.is_deleteAble?(s(),l("a",{key:0,class:"dropdown-item text-dark",href:"javascript:;",onClick:T=>o.deleteCustomReport(v.id,v.category)},[e[2]||(e[2]=r("i",{class:"fas fa-trash"},null,-1)),D(" "+d(t.trans("delete")),1)],8,ye)):u("",!0)])])])])])])])]),r("div",be,[r("div",ve,[r("div",Ce,[r("p",we,d(o.subString(v.description,180)),1)])])])])]))),128))])])]))),128)),t.showEditModal?(s(),f(m,{key:0,"on-close":o.onClose,from:t.from,"report-data-obj":t.reportData,"modal-mode":"update"},null,8,["on-close","from","report-data-obj"])):u("",!0),t.showDeleteModal?(s(),f(k,{key:1,showModal:t.showDeleteModal,type:t.type,"on-close":o.closeDeleteModal,"report-id":t.reportId,"report-type":t.reportType},null,8,["showModal","type","on-close","report-id","report-type"])):u("",!0)])):u("",!0)])}const Y=C(Xt,[["render",ke],["__scopeId","data-v-8960685c"]]);const De={name:"InfiniteDropdown",props:{id:{type:String,default:""},label:{type:String,default:""},api:{type:String,default:""},limit:{type:Number,default:10},nameKey:{type:String,default:"name"},eventKey:{type:String,required:!0}},mounted(){const t=document.querySelector("#infinite-list");t&&t.addEventListener("scroll",e=>{t.scrollTop+t.clientHeight>=t.scrollHeight&&this.loadMore()})},computed:{dropdownTitle(){return this.selectedEntry?K(this.selectedEntry,20):this.trans(this.label)},dropdownTitleNonTruncated(){return this.selectedEntry?this.selectedEntry:this.trans(this.label)}},data(){return{loading:!1,page:1,payload:[],selectedEntry:"",searchQuery:"",lastPage:1}},methods:{async getData(){this.loading=!0;try{let t=await axios.get(`${this.api}?search_query=${this.searchQuery}&limit=${this.limit}&page=${this.page}`);this.payload=[...this.payload,...t.data.data],this.payload.map(e=>{e.is_default&&(this.selectedEntry=e.name)}),this.page=t.data.current_page,this.lastPage=t.data.last_page}catch{this.payload=null}finally{this.loading=!1}},loadMore(){this.page>=this.lastPage||(this.page++,this.getData())},itemSelected(t){this.selectedEntry=t[this.nameKey],window.emitter.emit(this.eventKey,{...t,type:this.eventKey})},dropdownItemName(t){return K(t,20)}}},Se={class:"infinite-dropdown"},Oe=["id","title"],Re={id:"infinite-list",class:"dropdown-menu dropdown-menu-right",style:{"max-height":"20vh","overflow-y":"auto"}},$e=["id","onClick","title"],Ae={key:1,class:"dropdown-item",href:"javascript:;"};function Te(t,e,a,i,n,o){const p=c("reuse-loader");return s(),l("div",Se,[r("button",{type:"button",class:"btn btn-sm btn-light dropdown-toggle","data-bs-toggle":"dropdown",onClickOnce:e[0]||(e[0]=(...h)=>o.getData&&o.getData(...h)),id:a.id,title:o.dropdownTitleNonTruncated},d(t.trans("ratings")),41,Oe),r("div",Re,[n.loading?(s(),f(p,{key:0,"animation-duration":4e3,color:"#1d78ff",size:20})):(s(),l(A,{key:1},[n.payload.length?(s(!0),l(A,{key:0},I(n.payload,h=>(s(),l("a",{class:x(["dropdown-item",n.selectedEntry===h[a.nameKey]?"active":""]),href:"javascript:;",key:h[a.nameKey],id:a.id,onClick:y=>o.itemSelected(h),title:h[a.nameKey]},d(o.dropdownItemName(h[a.nameKey])),11,$e))),128)):(s(),l("a",Ae,d(t.trans("no-records")),1))],64))])])}const Ie=C(De,[["render",Te],["__scopeId","data-v-86fa1a75"]]);O.register(E,z,lt,H,V,N);O.register(M);const Le={name:"App",props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartId:{type:String,required:!0},chartTitle:{type:Object,default:function(){return{display:!1}}}},components:{Bar:rt},data(){return{options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{color:"#000",anchor:"end",clamp:!0,align:"top"},legend:!1},layout:{padding:{left:0,right:0,top:24,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.labelString},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0}},x:{border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{callback:function(t,e){return ot(this.getLabelForValue(t))}}}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions)},mounted(){setTimeout(()=>{O.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(b(e)&&b(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(b(a)){let i=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:i})}}},onHover(t,e,a){B(e,this.chartId,this.redirectUrls)}}},Fe={class:"h-300"};function xe(t,e,a,i,n,o){const p=c("Bar");return s(),l("div",Fe,[g(p,{data:a.chartData,options:n.options,id:a.chartId},null,8,["data","options","id"])])}const Pe=C(Le,[["render",xe],["__scopeId","data-v-ea8a1df8"]]);O.register(E,z,lt,H,V,N);O.register(M);const je={name:"App",props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartId:{type:String,required:!0},chartTitle:{type:Object,default:function(){return{display:!1}}}},components:{Bar:rt},data(){return{options:{indexAxis:"y",responsive:!0,title:this.chartTitle,plugins:{datalabels:{color:"#000",anchor:"end",clamp:!0,align:"right"},legend:!1},layout:{padding:{left:0,right:24,top:0,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.labelString},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0}},x:{border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0,callback:function(t,e){return ot(this.getLabelForValue(t))}}}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions)},mounted(){setTimeout(()=>{O.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(b(e)&&b(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(b(a)){let i=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:i})}}},onHover(t,e,a){B(e,this.chartId,this.redirectUrls)}}},Ue={class:"h-300"};function Me(t,e,a,i,n,o){const p=c("Bar");return s(),l("div",Ue,[g(p,{data:a.chartData,options:n.options,id:a.chartId},null,8,["data","options","id"])])}const Ee=C(je,[["render",Me],["__scopeId","data-v-d6e1b4c8"]]);O.register(H,V,N,dt,E);O.register(M);const He={components:{Doughnut:kt},props:{chartId:{type:String,required:!0},chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}}},mounted(){setTimeout(()=>{O.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(b(e)&&b(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(b(a)){let i=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:i})}}},dataLabelFormatter(t,e){return nt(t,e)},onHover(t,e){B(e,this.chartId,this.redirectUrls)}}};function Ve(t,e,a,i,n,o){const p=c("Doughnut");return s(),l("div",null,[g(p,{id:a.chartId,data:a.chartData,options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}},null,8,["id","data","options"])])}const Ne=C(He,[["render",Ve]]);O.register(H,V,N,dt,E);O.register(M);const Be={components:{Pie:Dt},props:{chartId:{type:String,required:!0},chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}}},mounted(){setTimeout(()=>{O.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e){if(b(e)&&b(this.redirectUrls)){const a=this.redirectUrls[e[0].index];if(b(a)){let i=JSON.parse('{"'+decodeURIComponent(a.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:a.replace(this.basePath(),""),query:i})}}},dataLabelFormatter(t,e){return nt(t,e)},onHover(t,e){B(e,this.chartId,this.redirectUrls)}}};function qe(t,e,a,i,n,o){const p=c("Pie");return s(),l("div",null,[g(p,{id:a.chartId,data:a.chartData,options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:"auto",color:"#6c757d",anchor:"end",clamp:!0,align:"start",offset:10,font:{weight:"bold"},formatter:this.dataLabelFormatter},legend:{display:!0,position:"top"}},maintainAspectRatio:!1,onClick:this.clickHandler,onHover:this.onHover}},null,8,["id","data","options"])])}const We=C(Be,[["render",qe]]);O.register(E,z,jt,Ut,H,V,N);O.register(M);const Ke={components:{Line:St},props:{chartData:{type:Object},redirectUrls:{type:Array,default:()=>[]},chartOptions:{type:Object,default:null},labelString:{type:String,default:()=>""},chartTitle:{type:Object,default:function(){return{display:!1}}},chartId:{type:String,required:!0}},data(){return{datacollection:{labels:this.chartData.labels,datasets:this.chartData.data},options:{responsive:!0,title:this.chartTitle,plugins:{datalabels:{display:!1,color:"#000",anchor:"end",clamp:!0,align:"right"}},layout:{padding:{left:0,right:0,top:24,bottom:0}},scales:{y:{beginAtZero:!0,title:{display:!0,text:this.chartData.dataLabel},border:{display:!1},grid:{display:!0,drawOnChartArea:!0,drawTicks:!0},ticks:{precision:0},min:0},x:{border:{display:!1},grid:{display:!1,drawOnChartArea:!1,drawTicks:!1},title:{display:!0,text:this.chartData.categoryLabel}}},onHover:this.onHover,maintainAspectRatio:!1,onClick:this.clickHandler}}},beforeMount(){this.chartOptions!==null&&(this.options=this.chartOptions),this.chartData.data.forEach(t=>{t.tension=.3})},mounted(){setTimeout(()=>{O.defaults.plugins.datalabels.display=!0},1e3)},methods:{clickHandler(t,e,a){if(b(e)&&b(this.chartData.redirectURLs)){const i=this.chartData.redirectURLs[e[0].datasetIndex][e[0].index];if(b(i)){let n=JSON.parse('{"'+decodeURIComponent(i.split("?")[1]).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}');this.$router.push({path:i.replace(this.basePath(),""),query:n})}}},onHover(t,e){try{const a=document.getElementById(this.chartId);let i=e[0].datasetIndex;a.style.cursor="default",typeof i<"u"&&this.chartData.redirectURLs[i][e[0].index]&&(a.style.cursor="pointer")}catch{}}}},ze={class:"h-300"};function Je(t,e,a,i,n,o){const p=c("Line");return s(),l("div",ze,[g(p,{data:n.datacollection,options:n.options,id:a.chartId},null,8,["data","options","id"])])}const Xe=C(Ke,[["render",Je],["__scopeId","data-v-586ee229"]]);const Ye={name:"faveo-chart",components:{BarChart:Pe,HorizontalBarChart:Ee,DoughnutChart:Ne,PieChart:We,LineChart:Xe},props:{chartData:{type:[Object,Array],required:!0},chartType:{type:String,required:!0,validator:function(t){return["bar","horizontal_bar","pie","doughnut","line","area"].indexOf(t)!==-1}}},data:function(){return{}},methods:{getCategoryChartData(){return{labels:this.chartData.labels,datasets:[{backgroundColor:W(this.chartData.labels.length),borderColor:this.chartType==="doughnut"||this.chartType==="pie"?W(this.chartData.labels.length):mt(this.chartData.labels.length),borderWidth:2,label:this.chartData.axisLabel,data:this.chartData.data,barThickness:30}]}},getTimeChartData(){let t=[],e=[];for(let a=0;a<this.chartData.data.length;a++){const i=W();let n={fill:!1,label:this.chartData.data[a].label,borderColor:i,backgroundColor:i,pointBorderColor:i,pointBackgroundColor:i,pointBorderWidth:1,pointHoverRadius:5,pointHoverBackgroundColor:"#fff",pointHoverBorderColor:i,pointHoverBorderWidth:2,pointRadius:3,pointHitRadius:5,data:this.chartData.data[a].values};t.push(n);let o=this.chartData.data[a].redirectTo;e.push(o)}return{data:t,labels:this.chartData.labels,categoryLabel:this.chartData.categoryLabel,dataLabel:this.chartData.dataLabel,redirectURLs:JSON.parse(JSON.stringify(e))}}},computed:{getChartTitleObj:function(){let t={display:!1};return this.chartData.labels.length===0&&(t={display:!0,text:"No Data Available",fontSize:14,padding:15}),t}}},Ze={class:"faveo-chart"};function Ge(t,e,a,i,n,o){const p=c("bar-chart"),h=c("horizontal-bar-chart"),y=c("pie-chart"),m=c("doughnut-chart"),k=c("line-chart");return s(),l("div",Ze,[a.chartType==="bar"?(s(),f(p,{key:0,"chart-id":a.chartData.chartId,"chart-data":o.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"label-string":a.chartData.axisLabel,"chart-title":o.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","label-string","chart-title"])):u("",!0),a.chartType==="horizontal_bar"?(s(),f(h,{key:1,"chart-id":a.chartData.chartId,"chart-data":o.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"label-string":a.chartData.axisLabel,"chart-title":o.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","label-string","chart-title"])):u("",!0),a.chartType==="pie"?(s(),f(y,{key:2,"chart-id":a.chartData.chartId,"chart-data":o.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":o.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","chart-title"])):u("",!0),a.chartType==="doughnut"?(s(),f(m,{key:3,"chart-id":a.chartData.chartId,"chart-data":o.getCategoryChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":o.getChartTitleObj},null,8,["chart-id","chart-data","redirect-urls","chart-title"])):u("",!0),a.chartType==="line"?(s(),f(k,{key:4,"chart-id":a.chartData.data[0].chartId,"chart-labels":a.chartData.labels,"chart-data":o.getTimeChartData(),"redirect-urls":a.chartData.redirectURLs,"chart-title":o.getChartTitleObj},null,8,["chart-id","chart-labels","chart-data","redirect-urls","chart-title"])):u("",!0)])}const ht=C(Ye,[["render",Ge],["__scopeId","data-v-491670a7"]]);const Qe={name:"time-series-chart",components:{"faveo-chart":ht,"data-widget":st},props:{chartDataApi:{type:String,required:!0},dataWidgetApi:{type:String,default:()=>{}},categories:{type:Array,default:()=>[]},defaultCategory:{type:String,default:()=>""},categoryPrefix:{type:String,default:()=>"view_by"},filterParams:{type:Object,default:()=>{}},reportIndex:{type:Number,required:!0}},data:()=>({chartApiData:null,isLoading:!0,chartData:{},selectedCategory:"",dataWidgetData:null}),beforeMount(){this.selectedCategory=this.defaultCategory,this.getDataFromServer()},methods:{onCategoryChange(t){this.selectedCategory=t,this.$emit("updateChangedValue",this.selectedCategory,this.reportIndex,"selected_view_by"),this.getDataFromServer()},getDataFromServer(){this.isLoading=!0,b(this.dataWidgetApi)&&w.get(this.dataWidgetApi,{params:this.getUrlParams()}).then(t=>{this.dataWidgetData=t.data.data,this.updateDataCount("widget",this.dataWidgetData)}).catch(t=>{S(t,"category-based-report")}),w.get(this.chartDataApi,{params:this.getUrlParams()}).then(t=>{this.chartApiData=t.data.data,this.processChartData(),this.updateDataCount("chart",this.chartApiData)}).catch(t=>{S(t,"category-based-report"),this.isLoading=!1})},updateDataCount(t,e){let a=!1,i=!1;t==="chart"&&(a=e.every(n=>n.data.length===0)),t==="widget"&&(i=e.every(n=>n.value===0)),this.$emit("showReports",!(a||i))},processChartData(){try{const t=It(this.chartApiData.data);this.chartData={data:Lt(this.chartApiData.data,t),labels:t,categoryLabel:this.chartApiData.categoryLabel,dataLabel:this.chartApiData.dataLabel,panelTitle:this.chartApiData.name}}catch(t){console.error("TimeSeriesChart | processChartData ",t)}this.isLoading=!1},getUrlParams(){let t=J(this.filterParams);return t[this.categoryPrefix]=this.selectedCategory,t}},watch:{filterParams(){this.getDataFromServer()}}},ta={class:"row"},ea={class:"col-md-12"},aa={class:"card card-light",id:"chart-panel-main"},ra={class:"card-header"},sa={class:"card-title"},ia={class:"card-tools"},oa={key:0,class:"btn-group"},na={type:"button",class:"btn btn-tool dropdown-toggle","data-bs-toggle":"dropdown","aria-expanded":"true"},la={class:"dropdown-menu dropdown-menu-end",role:"menu","x-placement":"bottom-end"},da=["onClick"],ca={class:"card-body"},pa={key:1},ha={key:0};function ua(t,e,a,i,n,o){const p=c("loader"),h=c("data-widget"),y=c("faveo-chart");return s(),l("div",ta,[r("div",ea,[r("div",aa,[r("div",ra,[r("h3",sa,d(t.chartApiData?t.chartApiData.name:""),1),r("div",ia,[a.categories.length?(s(),l("div",oa,[r("button",na,[e[0]||(e[0]=r("i",{class:"fas fa-eye"},null,-1)),D(" "+d(t.lang(a.categoryPrefix))+" ",1),r("label",null,d(t.lang(t.selectedCategory)),1)]),r("div",la,[(s(!0),l(A,null,I(a.categories,(m,k)=>(s(),l("a",{key:k,class:x([t.selectedCategory===m?"active text-light":"text-dark","dropdown-item"]),onClick:R=>o.onCategoryChange(m),href:"javascript:;"},d(t.lang(a.categoryPrefix)+t.lang(m)),11,da))),128))])])):u("",!0)])]),r("div",ca,[t.isLoading?(s(),f(p,{key:0})):(s(),l("div",pa,[a.dataWidgetApi?(s(),l("section",ha,[g(h,{"data-widget-data":t.dataWidgetData},null,8,["data-widget-data"])])):u("",!0),g(y,{"chart-data":t.chartData,"chart-type":"line"},null,8,["chart-data"])]))])])])])}const ut=C(Qe,[["render",ua],["__scopeId","data-v-8b626691"]]);const _a={name:"category-based-report",components:{"ticket-filter":ct,"time-series-chart":ut,"faveo-chart":ht,"data-widget":st},props:{categoryChartDataApi:{type:String,default:()=>""},timeSeriesChartDataApi:{type:String,default:()=>""},widgetDataApi:{type:String,default:()=>{}},categories:{type:Array,default:()=>[]},defaultCategory:{type:[Number,String],default:()=>{}},categoryPrefix:{type:String,default:""},defaultChartType:{type:String,default:"bar"},layoutClass:{type:String,required:!0},filterParams:{type:Object,default:()=>{}},reportIndex:{type:Number,required:!0}},data:()=>({selectedChartType:"",selectedCategory:"",chartTypes:["bar","horizontal_bar","pie","doughnut"],isLoading:!0,chartApiData:null,dataWidgetData:null,reportId:null}),beforeMount(){this.selectedCategory=this.defaultCategory,this.selectedChartType=this.defaultChartType,this.getDataFromServer()},methods:{getColumnClass(){return getColumnClass()},getDataFromServer(){this.isLoading=!0,b(this.widgetDataApi)&&w.get(this.widgetDataApi,{params:this.getUrlParams()}).then(t=>{this.dataWidgetData=t.data.data,this.updateDataCount("widget",this.dataWidgetData)}).catch(t=>{S(t,"category-based-report")}),w.get(this.categoryChartDataApi,{params:this.getUrlParams()}).then(t=>{this.chartApiData=Ft(t.data.data),this.isLoading=!1,this.updateDataCount("chart",this.chartApiData)}).catch(t=>{S(t,"category-based-report")})},updateDataCount(t,e){let a=!1,i=!1;t==="chart"&&(a=e.every(n=>n.data.length===0)),t==="widget"&&(i=e.every(n=>n.value===0)),this.$emit("showReports",!(a||i))},onCategoryChange(t){this.selectedCategory=t,this.$emit("updateChangedValue",this.selectedCategory,this.reportIndex,"selected_view_by"),this.getDataFromServer()},onChangeChartType(t){this.selectedChartType=t,this.$emit("updateChangedValue",this.selectedChartType,this.reportIndex,"selected_chart_type")},getUrlParams(){let t=J(this.filterParams);return typeof this.categoryPrefix<"u"&&(t[this.categoryPrefix]=this.selectedCategory),t}},watch:{filterParams(){this.getDataFromServer()}}},ma={class:"row mb-3"},ga={class:"col-sm-12"},fa={key:0,class:"btn-group float-end"},ya={type:"button",class:"btn btn-sm btn-light dropdown-toggle text-capitalize","data-bs-toggle":"dropdown",id:"category-dropdown"},ba={class:"dropdown-menu dropdown-menu-end",style:{},"aria-labelledby":"category-dropdown"},va=["onClick"],Ca={class:"float-end btn-group"},wa={class:"btn btn-sm btn-light dropdown-toggle",id:"chart-type-dropdown","data-bs-toggle":"dropdown"},ka={class:"dropdown-menu dropdown-menu-end",style:{},"aria-labelledby":"chart-type-dropdown"},Da=["onClick"],Sa={class:"data-widget"},Oa={class:"row"},Ra={class:"card card-light"},$a={class:"card-header"},Aa={class:"card-title"},Ta={class:"card-body"};function Ia(t,e,a,i,n,o){const p=c("loader"),h=c("data-widget"),y=c("faveo-chart");return s(),l("div",null,[t.isLoading?(s(),f(p,{key:0,duration:4e3})):u("",!0),r("div",ma,[r("div",ga,[a.categories&&a.categories.length?(s(),l("div",fa,[r("button",ya,d(t.lang(a.categoryPrefix))+" "+d(t.selectedCategory),1),r("div",ba,[(s(!0),l(A,null,I(a.categories,(m,k)=>(s(),l("a",{key:k,class:x(["dropdown-item text-capitalize",t.selectedCategory===m?"active":""]),onClick:R=>o.onCategoryChange(m),href:"javascript:;"},d(t.lang(a.categoryPrefix))+" "+d(m),11,va))),128))])])):u("",!0),r("div",Ca,[r("button",wa,d(t.lang("chart_type")),1),r("div",ka,[(s(!0),l(A,null,I(t.chartTypes,m=>(s(),l("a",{key:m,class:x(["dropdown-item",t.selectedChartType===m?"active":""]),href:"javascript:;",onClick:k=>o.onChangeChartType(m)},d(t.lang(a.categoryPrefix))+" "+d(t.lang(m)),11,Da))),128))])])])]),r("div",Sa,[a.widgetDataApi?(s(),f(h,{key:0,"data-widget-data":t.dataWidgetData},null,8,["data-widget-data"])):u("",!0)]),r("div",Oa,[(s(!0),l(A,null,I(t.chartApiData,m=>(s(),l("div",{class:x(a.layoutClass),key:m.id},[r("div",Ra,[r("div",$a,[r("h3",Aa,d(m.panelTitle),1)]),r("div",Ta,[g(y,{"chart-data":m,"chart-type":t.selectedChartType},null,8,["chart-data","chart-type"])])])],2))),128))])])}const La=C(_a,[["render",Ia],["__scopeId","data-v-78a0cfd0"]]),Fa={name:"report-entry-page",components:{"ticket-filter":ct,"tabular-report-layout":Ot,"time-series-chart":ut,"category-based-report":La,"save-report-modal":it,"tool-tip":gt,InfiniteDropdown:Ie},data:()=>({reportConfigObj:null,clonedReportConfigOnj:null,isLoading:!0,openSaveReportModal:!1,modalMode:"",filterParams:{},isShowFilter:!1,dataCount:0,randKey:Math.floor(Math.random()*11111),customFilters:[],reportId:"",requiredPayload:[],scheduleData:"",showReport:!1,filterId:""}),beforeMount(){window.location.pathname.split("/").includes("rating-in-depth")&&this.customFilters.push({eventKey:"rating",label:this.trans("rating_default_rating"),api:"ratings-list",limit:5}),this.dashboardInit()},created(){window.emitter.on("onReportsColumnUpdate",this.onColumnUpdate),window.emitter.on("refreshReportEntryPage",this.dashboardInit),window.emitter.on("dataCount",this.getCount),window.emitter.on("rating",t=>{this.customFilterHandler(t)})},computed:{showExportButton:function(){if(this.reportConfigObj&&Array.isArray(this.reportConfigObj.sub_reports)){for(let t=0;t<this.reportConfigObj.sub_reports.length;t++)if(this.reportConfigObj.sub_reports[t].data_type==="datatable")return!0}return!1}},methods:{getCount(t){this.dataCount=t},toggleFilterView(){this.isShowFilter=!this.isShowFilter},dashboardInit(){this.getReportConfiguration(ft(window.location.pathname))},getLayoutClass(t){return qt(t)},getReportConfiguration(t){this.isLoading=!0;let e=J(this.filterParams);e.include_filters=1,this.reportId=t,w.get("api/agent/report-config/"+t,{params:e}).then(a=>{this.reportConfigObj=a.data.data,this.scheduleData=a.data.data,this.clonedReportConfigOnj=JSON.parse(JSON.stringify(this.reportConfigObj)),this.filterId=a.data.data.filter_id,this.reportConfigObj.sub_reports&&Array.isArray(this.reportConfigObj.sub_reports)&&this.reportConfigObj.sub_reports.forEach(i=>{Array.isArray(i.columns)&&i.columns.forEach(n=>{n.key==="turn_around_time_department"&&(n.is_sortable=0)})}),this.updateFilterObj()}).catch(a=>{S(a,"report-entry-page")}).finally(a=>{this.isLoading=!1})},updateFilterObj(){let t={};Array.isArray(this.reportConfigObj.filters)&&this.reportConfigObj.filters.forEach(e=>{t[e.key]=e.value}),this.filterParams=t},exportReport(){const t={...this.filterParams,total:this.dataCount};this.isLoading=!0,w.post(this.reportConfigObj.export_url,t).then(e=>{U(e,"tabular-report-layout")}).catch(e=>{S(e,"tabular-report-layout")}).finally(()=>{this.isLoading=!1})},forkUpdateAction(t){window.emitter.emit("performApplyAction"),this.modalMode=t,this.openSaveReportModal=!0},closeSaveReportModal(){this.openSaveReportModal=!1},setFilter(t){this.filterParams=JSON.parse(JSON.stringify(t)),this.clonedReportConfigOnj.filters=Bt(this.filterParams),this.schedulePayload=this.clonedReportConfigOnj.filters},updateChangedValue(t,e,a){this.clonedReportConfigOnj.sub_reports[e][a]=t},onColumnUpdate(){window.emitter.emit("refreshData")},customFilterHandler(t){t.type==="rating"&&(this.reportConfigObj.sub_reports.forEach(e=>{let a=e.data_url,i=e.data_widget_url,n="?rating_id=",o=a.indexOf(n),p=i.indexOf(n);o>0&&(a=a.substring(0,o)),p>0&&(i=i.substring(0,p));let h=`?rating_id=${t.id}`;e.data_url=a+h,e.data_widget_url=i+h}),this.randKey++)},scheduleList(){this.requiredPayload=JSON.stringify(this.filterParams),this.$router.push({path:"/reports/schedule/add/"+this.scheduleData.type+"/"+this.reportId,query:{params:this.requiredPayload}})},async exportGraphicalReport(){const t=new FormData,e=document.getElementById("hd-report-template"),a=e.querySelectorAll(".btn-group");this.isShowFilter===!0&&(this.isShowFilter=!1),a.forEach(n=>{n.style.display="none"}),e.querySelectorAll("h3").forEach(n=>{n.style.whiteSpace="nowrap"});try{const n=await xt(e);a.forEach(h=>{h.style.display="block"});const o=await fetch(n).then(h=>h.blob());t.append("report_id",this.reportId),t.append("image",o,"report.png"),this.isLoading=!0;const p=await w.post("api/export/graphical-report",t);U(p,"report-entry-page"),this.isLoading=!1}catch(n){this.isLoading=!1,S(n,"report-entry-page")}},handleExport(t){this.showReport=t}}},xa={class:"col-sm-12",id:"hd-report-template"},Pa={key:1,class:"card card-light report-box-primary"},ja={class:"card-header"},Ua={class:"card-title"},Ma=["href"],Ea={class:"card-tools"},Ha={class:"btn-group"},Va={class:"card-body"};function Na(t,e,a,i,n,o){const p=c("alert"),h=c("custom-loader"),y=c("tool-tip"),m=c("infinite-dropdown"),k=c("ticket-filter"),R=c("tabular-report-layout"),F=c("category-based-report"),v=c("time-series-chart"),T=c("save-report-modal"),P=j("tooltip");return s(),l("div",xa,[g(p,{componentName:"report-entry-page"}),t.isLoading?(s(),f(h,{key:0,duration:4e3})):u("",!0),t.reportConfigObj?(s(),l("div",Pa,[r("div",ja,[r("h3",Ua,[D(d(t.reportConfigObj.name)+" ",1),t.reportConfigObj.helplink?(s(),l("a",{key:0,href:t.reportConfigObj.helplink,target:"__blank"},[g(y,{slot:"headerTooltip",message:t.lang("click_to_see_how_to_read_this_report"),size:"medium"},null,8,["message"])],8,Ma)):u("",!0)]),r("div",Ea,[r("div",Ha,[t.customFilters.length?(s(!0),l(A,{key:0},I(t.customFilters,_=>(s(),f(m,yt({key:_.label,"event-key":_.eventKey,api:_.api,limit:_.limit,id:_.label,label:_.label},{[bt(_.eventKey)]:o.customFilterHandler}),null,16,["event-key","api","limit","id","label"]))),128)):u("",!0),L((s(),l("button",{type:"button",class:"btn btn-tool",onClick:e[0]||(e[0]=_=>o.toggleFilterView())},e[6]||(e[6]=[r("i",{class:"glyphicon glyphicon-filter"},null,-1)]))),[[P,t.lang("report_config_filter")]]),o.showExportButton&&t.dataCount?L((s(),l("button",{key:1,id:"export-report",class:"btn btn-tool",onClick:e[1]||(e[1]=(..._)=>o.exportReport&&o.exportReport(..._))},e[7]||(e[7]=[r("i",{class:"fas fa-paper-plane","aria-hidden":"true"},null,-1)]))),[[P,t.lang("export")]]):u("",!0),!o.showExportButton&&t.showReport?L((s(),l("button",{key:2,id:"graphical-report",class:"btn btn-tool",onClick:e[2]||(e[2]=(..._)=>o.exportGraphicalReport&&o.exportGraphicalReport(..._))},e[8]||(e[8]=[r("i",{class:"fas fa-paper-plane","aria-hidden":"true"},null,-1)]))),[[P,t.lang("export")]]):u("",!0),o.showExportButton&&t.dataCount?L((s(),l("button",{key:3,id:"schedule-report",class:"btn btn-tool",onClick:e[3]||(e[3]=_=>o.scheduleList())},e[9]||(e[9]=[r("i",{class:"fas fa-calendar","aria-hidden":"true"},null,-1)]))),[[P,t.lang("schedule")]]):u("",!0)])])]),r("div",Va,[t.isShowFilter?(s(),f(k,{key:0,onFilter:o.setFilter,isApplyOnlyMode:!0,"prefilled-filter-object":t.filterParams,"filter-dependencies-api-endpoint":"/api/agent/filter-dependencies",showFilter:t.isShowFilter,closeFilterView:o.toggleFilterView,filterNumber:t.filterId},{"filter-operation-btn-group":$(()=>[t.reportConfigObj.is_default?u("",!0):(s(),l("button",{key:0,class:"btn btn-primary",onClick:e[4]||(e[4]=_=>o.forkUpdateAction("update"))},[e[10]||(e[10]=r("i",{class:"fas fa-edit","aria-hidden":"true"},null,-1)),D("  "+d(t.lang("edit")),1)])),r("button",{class:"btn btn-primary",onClick:e[5]||(e[5]=_=>o.forkUpdateAction("fork"))},[e[11]||(e[11]=r("i",{class:"fas fa-save","aria-hidden":"true"},null,-1)),D("  "+d(t.lang("save")),1)])]),_:1},8,["onFilter","prefilled-filter-object","showFilter","closeFilterView","filterNumber"])):u("",!0),(s(),l("div",{key:t.randKey},[(s(!0),l(A,null,I(t.reportConfigObj.sub_reports,(_,q)=>(s(),l("section",{key:_.id},[_.data_type==="datatable"?(s(),f(R,{key:0,"data-url":_.data_url,"table-columns":_.columns,"sub-report-id":_.id,"export-url":t.reportConfigObj.export_url,"add-custom-column-url":_.add_custom_column_url,"delete-custom-column-url":"api/delete-custom-column","short-code-url":"api/report-shortcodes/"+t.reportConfigObj.type,filterParams:t.filterParams,"report-index":q,"report-id":t.reportId},null,8,["data-url","table-columns","sub-report-id","export-url","add-custom-column-url","short-code-url","filterParams","report-index","report-id"])):u("",!0),_.data_type==="category-chart"?(s(),f(F,{key:1,"category-chart-data-api":_.data_url,"widget-data-api":_.data_widget_url,categories:_.list_view_by,"default-category":_.selected_view_by,"default-chart-type":_.selected_chart_type,"category-prefix":"view_by","layout-class":o.getLayoutClass(_.layout),filterParams:t.filterParams,"report-index":q,onUpdateChangedValue:o.updateChangedValue,onShowReports:o.handleExport},null,8,["category-chart-data-api","widget-data-api","categories","default-category","default-chart-type","layout-class","filterParams","report-index","onUpdateChangedValue","onShowReports"])):u("",!0),_.data_type==="time-series-chart"?(s(),f(v,{key:2,"chart-data-api":_.data_url,"data-widget-api":_.data_widget_url,categories:_.list_view_by,"default-category":_.selected_view_by,filterParams:t.filterParams,"report-index":q,onUpdateChangedValue:o.updateChangedValue,onShowReports:o.handleExport},null,8,["chart-data-api","data-widget-api","categories","default-category","filterParams","report-index","onUpdateChangedValue","onShowReports"])):u("",!0)]))),128))]))])])):u("",!0),t.openSaveReportModal?(s(),f(T,{key:2,onClose:o.closeSaveReportModal,reportDataObj:t.clonedReportConfigOnj,"modal-mode":t.modalMode},null,8,["onClose","reportDataObj","modal-mode"])):u("",!0)])}const Ba=C(Fa,[["render",Na]]),qa={name:"data-table-user",description:"Contains user name",props:{data:{type:Object,required:!0}},data(){return{base:window.axios.defaults.baseURL}}},Wa={class:"btn-group"};function Ka(t,e,a,i,n,o){const p=c("router-link");return s(),l("div",Wa,[g(p,{id:"user",to:"/user/"+a.data.user.id},{default:$(()=>[D(d(a.data.user.first_name)+" "+d(a.data.user.last_name),1)]),_:1},8,["to"])])}const za=C(qa,[["render",Ka]]);const Ja={name:"report-exports",description:"Exports table component",setup(){const t=Z();return{formattedTime:G(()=>t.getters.formattedTime)}},data(){let t=new URLSearchParams(window.location.search);const e=this;return{base:window.axios.defaults.baseURL,columns:["file","ext","type","user","created_at","action"],options:{texts:{filter:"",limit:""},headings:{file:this.trans("filename"),ext:this.trans("format"),type:this.trans("type"),user:this.trans("user"),created_at:this.trans("created_at"),action:this.trans("action")},templates:{action:(a,i)=>e.h(Et,{data:i}),user:(a,i)=>e.h(za,{data:i}),created_at:(a,i)=>e.formattedTime(i.created_at),ext(a,i){return i.ext.toUpperCase()}},sortable:["file","ext","type","created_at"],filterable:["file","ext","type","created_at"],pagination:{chunk:5,nav:"scroll"},requestAdapter(a){return{sort_by:a.orderBy?a.orderBy:"created_at",order:a.ascending?"desc":"asc",search:a.query.trim(),page:a.page,per_page:a.limit,type:t.get("type"),"user-filter":t.get("user-filter")}},responseAdapter({data:a}){return{data:a.data.data.map(i=>(i.delete_url=window.axios.defaults.baseURL+"/report/api/agent/export/delete/"+i.id,i.download_check_url="/report/api/agent/export/download/"+i.hash,i.deleteMessage="are_you_sure_you_want_to_delete_this_report",i)),count:a.data.total}},orderBy:{column:"created_at",ascending:!0}},apiUrl:"/report/api/agent/exports/"}}},Xa={class:"col-sm-12"},Ya={class:"card card-light"},Za={class:"card-header"},Ga={class:"card-title"},Qa={class:"card-body"};function tr(t,e,a,i,n,o){const p=c("alert"),h=c("data-table");return s(),l("div",Xa,[g(p,{componentName:"dataTableModal"}),r("div",Ya,[r("div",Za,[r("h3",Ga,d(t.lang("reports")),1)]),r("div",Qa,[g(h,{url:n.apiUrl,dataColumns:n.columns,option:n.options},null,8,["url","dataColumns","option"])])])])}const er=C(Ja,[["render",tr],["__scopeId","data-v-1445c331"]]);function ar(t){const{records:e}=t;let a={records:[e,"isRequired","minValue(1)"]};const i=new tt(et),{errors:n,isValid:o}=i.validate(a);return at.dispatch("setValidationError",n),{errors:n,isValid:o}}const rr={name:"reports-settings",description:"reports settings page",components:{"static-select":vt},beforeMount(){this.getInitialValues()},data:()=>({records:0,loading:!1,isDisabled:!1,elements:[{id:200,name:200},{id:400,name:400},{id:600,name:600},{id:800,name:800},{id:1e3,name:1e3},{id:1200,name:1200},{id:1400,name:1400},{id:1600,name:1600},{id:1800,name:1800},{id:2e3,name:2e3},{id:2200,name:2200},{id:2400,name:2400},{id:2600,name:2600},{id:2800,name:2800},{id:3e3,name:3e3}]}),methods:{getInitialValues(){this.loading=!0,this.isDisabled=!0,w.get("/api/report-settings").then(t=>{this.records=t.data.data.records_per_file,this.loading=!1,this.isDisabled=!1}).catch(t=>S(t))},isValid(){const{errors:t,isValid:e}=ar(this.$data);return!!e},onChange(t,e){this[e]=t},initialState(){this.loading=!1,this.isDisabled=!1},onSubmit(){this.isValid()&&(this.loading=!0,this.isDisabled=!0,w.post("/api/report-settings",{records_per_file:this.records}).then(t=>{U(t),this.initialState()}).catch(t=>{S(t),this.initialState()}))}}},sr={class:"col-sm-12"},ir={class:"row"},or={key:0,class:"row",slot:"fields"},nr={class:"card-footer"},lr=["disabled"];function dr(t,e,a,i,n,o){const p=c("alert"),h=c("static-select"),y=c("custom-loader"),m=c("faveo-box");return s(),l("div",sr,[g(p),g(m,{title:t.trans("settings")},{actions:$(()=>[r("div",nr,[r("button",{type:"button",id:"submit_btn",onClick:e[0]||(e[0]=k=>o.onSubmit()),class:"btn btn-primary",disabled:t.isDisabled},[e[1]||(e[1]=r("i",{class:"fas fa-save","aria-hidden":"true"},null,-1)),D(" "+d(t.trans("submit")),1)],8,lr)])]),default:$(()=>[r("div",ir,[g(h,{label:t.trans("record_per_export"),value:t.records,name:"records",classname:"col-sm-6",elements:t.elements,onChange:o.onChange,type:"number",required:!0,hint:t.trans("record_per_export_tooltip")},null,8,["label","value","elements","onChange","hint"]),t.loading===!0?(s(),l("div",or,[g(y,{duration:4e3})])):u("",!0)])]),_:1},8,["title"])])}const cr=C(rr,[["render",dr]]);const pr={name:"AllScheduleList",description:"Schedule list component",data(){return{columns:[],hasDataPopulated:!1,visibleColumns:{},staticColumns:["actions"],reportType:"schedule-report",apiUrl:"/schedules",filterOptions:[{section:[{name:"report_type",url:"/api/report-types",label:"report_type"},{name:"user_id",url:"/api/dependency/users",label:"notify_assign"},{name:"scheduled_by",label:"schedule_by",type:"static-select",elements:[{id:"daily",name:"Daily"},{id:"weekly",name:"Weekly"},{id:"monthly",name:"Monthly"}]}]},{section:[{name:"executed_at",type:"time",label:"execute_at",timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0,placeholder:"select_date"},{name:"status",label:"status",type:"static-select",elements:[{id:1,name:"Active"},{id:0,name:"Inactive"}]},{name:"created_at",type:"date",label:["created_at","created_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]},{section:[{name:"updated_at",type:"date",label:["updated_at","updated_within_last"],timeOptions:{start:"00:00",step:"00:30",end:"23:30"},range:!0}]}],options:{},isShowFilter:!1,appliedFilters:{},columnData:null,scheduleData:"",loading:!0,newReportId:"",deleteMessage:"are_you_sure_you_want_to_delete_this_schedule_report"}},created(){window.emitter.on("onColumnUpdate",this.onColumnUpdate),window.emitter.on("updateFilter",this.updateFilter)},beforeMount(){this.filterData(),this.getScheduleData()},methods:{handleScheduleByChanged(t){if(this.filterOptions[2].section){const e=this.filterOptions[2].section.findIndex(a=>a.name==="monthly");e!==-1&&this.filterOptions[2].section.splice(e,1)}if(this.filterOptions[2].section){const e=this.filterOptions[2].section.findIndex(a=>a.name==="weekly");e!==-1&&this.filterOptions[2].section.splice(e,1)}if(t==="Monthly"){const e={name:"monthly",label:"monthly",className:"col-sm-4",isMultiple:!0,elements:[...Array.from({length:31},(a,i)=>({id:i+1,name:i+1}))]};this.filterOptions[2].section||(this.filterOptions[2].section=[]),this.filterOptions[2].section.push(e)}if(t==="Weekly"){const e={name:"weekly",label:"weekly",className:"col-sm-4",isMultiple:!0,elements:[{id:"Monday",name:"Monday"},{id:"Tuesday",name:"Tuesday"},{id:"Wednesday",name:"Wednesday"},{id:"Thursday",name:"Thursday"},{id:"Friday",name:"Friday"},{id:"Saturday",name:"Saturday"},{id:"Sunday",name:"Sunday"}]};this.filterOptions[2].section||(this.filterOptions[2].section=[]),this.filterOptions[2].section.push(e)}},updateFilter(t){this.filterOptions.map(function(e){e.section.map(function(a){t.name==a.name&&(a.value=t.value)})})},updateFilterMeta(t){this.filterOptions.map(function(e){e.section.map(function(a){a.value=t[a.name]?t[a.name]:""})})},getScheduleData(){this.hasDataPopulated=!1,w.get("api/agent/report-config/schedule-report").then(t=>{this.newReportId=t.data.data.id,this.columnData=t.data.data.sub_reports,this.hasDataPopulated=!0,this.columnData.forEach(e=>{e.columns.forEach(a=>{}),this.columns=e.columns}),this.columns.map(e=>{e.is_visible=!!e.is_visible}),this.updateVisibleColumns()}).catch(t=>{this.hasDataPopulated=!0,this.columns=[],S(t)})},onColumnUpdate(t){this.columns=t,this.updateVisibleColumns()},updateVisibleColumns(){this.visibleColumns={},this.columns.map(t=>{b(t.is_visible)&&(this.visibleColumns[t.key]=t.label)})},filterData(){this.filterOptions.map(function(t){t.section.map(function(e){e.elements=e.type==="static-select"?e.elements:[],e.isMultiple=e.type!=="static-select",e.isPrepopulate=!1,e.value="",e.className="col-sm-4"})})},selectedFilters(t){return t==="closeEvent"?this.isShowFilter=!1:t==="resetEvent"?this.resetFilter():this.applyFilter(t)},resetFilter(){this.apiUrl="/schedules",this.filterOptions=this.filterOptions.map(function(t){return t.section.map(function(e){e.elements=e.type==="static-select"?e.elements:[],e.isMultiple=e.type!=="static-select",e.isPrepopulate=!1,e.value="",e.className="col-sm-4"}),t})},applyFilter(t){t.scheduled_by===null&&this.filterOptions[2].section[1]&&this.filterOptions[2].section.splice(1,1),this.updateFilterMeta(t),this.appliedFilters=t;let e="/schedules?",a=Ct(this.filterOptions,t);a[a.length-1]==="&"&&(a=a.slice(0,-1)),this.apiUrl=e+a,this.isShowFilter=!1},toggleFilterView(){this.isShowFilter=!this.isShowFilter}},components:{"schedule-filter":Ht,"user-column-list":Rt,"dynamic-datatable":$t}},hr={class:"col-sm-12"},ur={key:0,class:"card card-light"},_r={class:"card-header"},mr={class:"card-title"},gr={class:"card-tools"},fr={class:"card-body",id:"schedule_list"};function yr(t,e,a,i,n,o){const p=c("alert"),h=c("schedule-filter"),y=c("user-column-list"),m=c("dynamic-datatable"),k=j("tooltip");return s(),l("div",hr,[g(p,{componentName:"dataTableModal"}),n.hasDataPopulated?(s(),l("div",ur,[r("div",_r,[r("h3",mr,d(t.trans("schedule")),1),r("div",gr,[L((s(),l("a",{id:"advance-filter-btn",class:"btn btn-tool",onClick:e[0]||(e[0]=(...R)=>o.toggleFilterView&&o.toggleFilterView(...R)),href:"javascript:;"},e[1]||(e[1]=[r("span",{class:"glyphicon glyphicon-filter"},null,-1)]))),[[k,t.trans("filter")]])])]),r("div",fr,[n.isShowFilter?(s(),f(h,{key:0,id:"filter-box",metaData:n.filterOptions,appliedFilters:n.appliedFilters,onSelectedFilters:o.selectedFilters,onScheduleByChanged:o.handleScheduleByChanged},null,8,["metaData","appliedFilters","onSelectedFilters","onScheduleByChanged"])):u("",!0),(s(!0),l(A,null,I(n.columnData,R=>(s(),l("section",{key:R},[g(y,{"table-columns":R.columns,reportId:R.id,columnId:n.newReportId},null,8,["table-columns","reportId","columnId"]),n.columns.length?(s(),f(m,{key:0,"data-url":n.apiUrl,columns:n.visibleColumns,columnsMeta:R.columns,staticColumns:n.staticColumns,deleteMessage:n.deleteMessage},null,8,["data-url","columns","columnsMeta","staticColumns","deleteMessage"])):u("",!0)]))),128))])])):u("",!0)])}const br=C(pr,[["render",yr],["__scopeId","data-v-1547663d"]]);const vr={props:{ticket:{type:Object,default:()=>({})}}},Cr={class:"daily-widget"},wr={class:"info-box bg-light data-widget-box"},kr={class:"info-box-content"},Dr={class:"info-box-text text-wrap"};function Sr(t,e,a,i,n,o){return s(),l("div",Cr,[r("div",wr,[r("span",{class:"info-box-icon elevation-1 bg-light box-icon-color",style:Q({background:a.ticket.icon_color})},[r("i",{class:x(a.ticket.icon_class)},null,2)],4),r("div",kr,[r("span",Dr,d(a.ticket.key),1)])])])}const Or=C(vr,[["render",Sr],["__scopeId","data-v-f116e86b"]]);const Rr={props:{ticket:{type:Object,default:()=>({})},removeItem:{type:Function}},methods:{onDelete(t){this.removeItem(t)}}},$r={class:"daily-widget"},Ar={class:"report_table"},Tr={class:"report_head"},Ir={class:"report_head_h4"},Lr={class:"report_delete"},Fr={class:"report_content"},xr={class:"report_content"},Pr={key:1},jr={class:"report_content"},Ur={key:2},Mr={class:"report_content"},Er={class:"report_content_title"},Hr={class:"report_badge"},Vr={class:"report_badge_1"},Nr={class:"report_content_date"};function Br(t,e,a,i,n,o){const p=j("tooltip");return s(),l("div",$r,[r("table",Ar,[r("tbody",null,[r("tr",null,[r("td",Tr,[r("h4",Ir,d(a.ticket.key),1)]),r("td",Lr,[L((s(),l("a",{class:"btn btn-light btn-sm",onClick:e[0]||(e[0]=h=>o.onDelete(a.ticket))},e[1]||(e[1]=[r("i",{class:"fas fa-trash"},null,-1)]))),[[p,t.trans("delete")]])])]),e[9]||(e[9]=r("tr",null,[r("td",{class:"report_line",colspan:"2"},[r("hr",{class:"report_line_hr"})])],-1)),a.ticket.id=="system_analysis"?(s(),l(A,{key:0},[r("tr",null,[r("td",Fr,d(t.trans("received_tickets")),1),e[2]||(e[2]=r("td",null,[r("span",{class:"report_count"},"10")],-1))]),r("tr",null,[r("td",xr,d(t.trans("exceptions_caught")),1),e[3]||(e[3]=r("td",null,[r("span",{class:"report_count"},"03")],-1))])],64)):a.ticket.id=="todo_list"?(s(),l("tr",Pr,[r("td",jr,[e[4]||(e[4]=r("span",null,"→",-1)),e[5]||(e[5]=D(" ")),r("i",null,d(t.trans("todo_eg")),1)])])):(s(),l("tr",Ur,[r("td",Mr,[r("a",null,[r("span",null,d(t.trans("sample_report_num")),1),e[6]||(e[6]=r("br",null,null,-1)),r("span",Er,d(t.trans("sample_report_tic")),1)]),a.ticket.id=="requires_immediate_action"?(s(),l(A,{key:0},[e[7]||(e[7]=D("  ")),r("a",Hr,d(t.trans("assigned_to_me")),1),e[8]||(e[8]=D("  ")),r("a",Vr,d(t.trans("reopened")),1)],64)):u("",!0)]),r("td",Nr,[r("span",null,d(t.trans("sample_report_due")),1)])]))])])])}const qr=C(Rr,[["render",Br],["__scopeId","data-v-b315a2fc"]]);function Wr(t){const{report_name:e}=t;let a={report_name:[e,"max(50)"]};const i=new tt(et),{errors:n,isValid:o}=i.validate(a);return at.dispatch("setValidationError",n),{errors:n,isValid:o}}const Kr={name:"daily-report-settings",data(){return{ticket_components:[],dragged_elements:[],loading:!1,existData:"",report_name:"",labelStyle:{display:"none"},date:"",day:"",month:"",showNameModal:!1,report_full_name:""}},mounted(){const t=["January","February","March","April","May","June","July","August","September","October","November","December"],e=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],a=new Date;this.month=t[a.getMonth()],this.day=e[a.getDay()],this.date=a.getDate(),this.loadData()},methods:{onClose(){this.showNameModal=!1,this.report_name=this.report_full_name,this.report_name||(this.report_name="Daily Report")},onSave(t){this.report_full_name=t,this.report_name||(this.report_name="Daily Report"),this.isValid()&&(this.showNameModal=!1)},onChange(t,e){this[e]=t},removeItem(t){let e=this.dragged_elements.map(a=>a.id).indexOf(t.id);this.dragged_elements.splice(e,1)},onClone(t){if(!this.dragged_elements.map(e=>e.id).includes(t.id))return t},loadData(){this.loading=!0,Promise.all([this.loadTicketComponents(),this.loadExistData()]).then(t=>{[this.ticket_components,this.existData]=t,this.dragged_elements=this.existData.components,this.report_name=this.existData.name?this.existData.name:"Daily Report",this.report_full_name=this.report_name,this.loading=!1}).catch(t=>{this.loading=!1,S(t,"daily-report-settings")})},loadTicketComponents(){return w.get("/get/admin/daily-report/ticket-components-widgets").then(t=>t.data.data.components)},loadExistData(){return w.get("/get/admin/daily-report").then(t=>t.data.data)},isValid(){const{errors:t,isValid:e}=Wr(this.$data);return e},onSend(){if(this.isValid()){let t=[];for(let a in this.dragged_elements)t.push({component_id:this.dragged_elements[a].id,order:parseInt(a)+1});this.loading=!0;let e={};e.report_id=this.existData.id,e.name=this.report_name?this.report_name:"Daily Report",e.component_ids=t,w.post("/api/admin/daily-report/createOrUpdateReport",e).then(a=>{this.loading=!1,U(a,"daily-report-settings"),this.loadData()}).catch(a=>{this.loading=!1,S(a,"daily-report-settings")})}}},components:{Draggable:Mt,DraggableWidgets:Or,DraggedWidgets:qr,"text-field":wt}},zr={class:"col-sm-12"},Jr={class:"row"},Xr={class:"col-sm-4"},Yr={class:"card"},Zr={class:"card-header p_18"},Gr={class:"card-title"},Qr={class:"col-sm-8"},ts={class:"card"},es={class:"card-header"},as={class:"card-title mt-1"},rs={class:"card-tools"},ss={key:0,type:"button",class:"btn btn-tool rotating","data-card-widget":"refresh"},is={class:"card-body"},os={class:"modal-title"},ns={class:"row"},ls={class:"report_table_main"},ds={class:"report_color_row"},cs={class:"report_color_row_td"},ps={class:"report_calendar"},hs={class:"report_cal_name"},us={class:"report_daily_head text-capitalize"},_s={class:"report_cal_edit"},ms={class:"report_calendar_date"},gs={class:"report_calendar_day"},fs={class:"report_table_pad"},ys={class:"report_table"},bs={class:"report_owner"},vs={class:"report_owner_wish"};function Cs(t,e,a,i,n,o){const p=c("alert"),h=c("draggable-widgets"),y=c("draggable"),m=c("text-field"),k=c("modal"),R=c("dragged-widgets"),F=j("focus-first-input"),v=j("tooltip");return s(),l("div",zr,[g(p,{componentName:"daily-report-settings"}),r("div",Jr,[r("div",Xr,[r("div",Yr,[r("div",Zr,[r("h3",Gr,d(t.trans("select_widgets")),1)])]),g(y,{tag:"div",group:{name:"ticket_components",pull:"clone",put:!1},class:"draggable-list",list:n.ticket_components,animation:200,itemKey:"id",clone:o.onClone},{item:$(({element:T,index:P})=>[(s(),f(h,{ticket:T,key:T.id},null,8,["ticket"]))]),_:1},8,["list","clone"])]),r("div",Qr,[r("div",ts,[r("div",es,[r("h3",as,d(t.trans("preview_of_daily_report")),1),r("div",rs,[r("button",{type:"button",class:"btn btn-primary btn-sm",onClick:e[0]||(e[0]=T=>o.onSend())},[e[3]||(e[3]=r("i",{class:"fas fa-save"},null,-1)),D(" "+d(t.trans("save")),1)]),n.loading?(s(),l("button",ss,e[4]||(e[4]=[r("i",{class:"fas fa-sync-alt"},null,-1)]))):u("",!0)])]),r("div",is,[n.showNameModal?(s(),f(k,{key:0,showModal:!0,onClose:o.onClose,showCloseBtn:!0},{title:$(()=>[r("h4",os,d(t.trans("edit_report_name")),1)]),fields:$(()=>[L((s(),l("div",ns,[g(m,{label:t.trans("report_name"),type:"text",value:n.report_name,name:"report_name",class:"col-sm-12",labelStyle:n.labelStyle,onChange:o.onChange,placehold:t.lang("enter_a_value")},null,8,["label","value","labelStyle","onChange","placehold"])])),[[F]])]),controls:$(()=>[r("button",{type:"button",onClick:e[1]||(e[1]=T=>o.onSave(n.report_name)),class:"btn btn-primary"},[e[5]||(e[5]=r("i",{class:"fas fa-check"},null,-1)),D("  "+d(t.trans("proceed")),1)])]),_:1},8,["onClose"])):u("",!0),r("table",ls,[r("tbody",null,[r("tr",ds,[r("td",cs,[r("table",null,[r("tbody",null,[r("tr",null,[r("td",ps,[r("span",null,d(n.month),1)]),r("td",hs,[r("h2",us,d(n.report_full_name?n.report_full_name:t.trans("daily_reports")),1)]),r("td",_s,[L((s(),l("button",{class:"btn btn-sm btn-light",onClick:e[2]||(e[2]=T=>n.showNameModal=!0)},e[6]||(e[6]=[r("i",{class:"fas fa-edit"},null,-1)]))),[[v,t.trans("edit_report_name")]])])]),r("tr",null,[r("td",ms,[r("span",null,d(n.date),1)]),r("td",null,[r("h3",gs,d(n.day),1)])])])])])])])]),r("div",fs,[r("table",ys,[r("tbody",null,[r("tr",null,[r("td",bs,[r("h5",vs,[D(d(t.trans("greetings"))+", ",1),e[7]||(e[7]=r("b",null,"XXXXXXXXXXX YYYYYYYYY",-1))])])])])]),g(y,{tag:"div",group:"ticket_components",class:"draggable-list",list:n.dragged_elements,animation:200,itemKey:"id"},{item:$(({element:T,index:P})=>[(s(),f(R,{ticket:T,key:T.id,removeItem:o.removeItem},null,8,["ticket","removeItem"]))]),_:1},8,["list"])])])])])])])}const ws=C(Kr,[["render",Cs],["__scopeId","data-v-9c4d939f"]]);let ks=[{path:"/reports",component:Tt,name:"Helpdesk Reports",redirect:"/reports/get",children:[{path:"get",component:Y,name:"Reports Index",meta:{title:"reports",crumb:{active:"reports"}}},{path:":type",component:Y,name:"Reports Index Individual",meta:{title:"reports",crumb:{active:"reports"}}},{path:":type/:id",component:Ba,name:"Reports Entry",meta:{title:"from_report",crumb:{link:{name:"reports",to:"/reports/get"},active:"from_report"}}},{path:":type/:module/:id",component:Pt,name:"SD Reports",meta:{title:"from_report",crumb:{link:{name:"reports",to:"/reports/get"},active:"from_report"}},props:!0},{path:"activity-download",component:er,name:"Reports Download",meta:{title:"activity-download",crumb:{active:"activity-download"}}},{path:"settings",component:cr,name:"Reports Settings",meta:{title:"report-settings",crumb:{active:"report-settings"}}},{path:"schedules",component:br,name:"AllScheduleList",meta:{title:"schedule_list",crumb:{active:"schedule_list"}}}]}];ks.forEach(function(t){At.addRoute(t)});let Ds=[{path:"/daily-report",component:Nt,name:"Daily Report Settings",redirect:"/daily-report/settings",children:[{path:"settings",component:ws,name:"DailyReport Settings",meta:{title:"daily_reports",crumb:{link:{name:"admin_panel",to:"/"},active:"daily_reports"}}}]}];Ds.forEach(function(t){Vt.addRoute(t)});
