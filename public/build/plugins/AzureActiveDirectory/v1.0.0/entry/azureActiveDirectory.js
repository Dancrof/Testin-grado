import{_ as C,Z as V,c as N,B as z,C as B,E as A,k as p,W as q,o,l as d,F as r,G as _,v as s,L as h,m as L,P as x,q as g,ad as T,a2 as E,s as P,ah as F,ag as M,T as R,I as b,x as f,an as $,J as S,K as H,t as I,X as U,O as J}from"../../../../v9.4.0.5/chunks/bootstrap.js";import{r as O,A as G}from"../../../../v9.4.0.5/chunks/adminRouter.js";import{a as j}from"../../../../v9.4.0.5/chunks/DataTableActions.js";import{C as K}from"../../../../v9.4.0.5/chunks/Checkbox.js";import"../../../../v9.4.0.5/chunks/vue-router.js";import"../../../../v9.4.0.5/chunks/FormGenerator.js";import"../../../../v9.4.0.5/chunks/AdminNavigationBar.js";import"../../../../v9.4.0.5/chunks/HelpSection.js";const W={name:"AzureActiveDirectoryIndex",setup(){const e=V();return{formattedTime:N(()=>e.getters.formattedTime)}},data(){let e=this;return{isLoading:!1,hideDefaultLogin:!1,columns:["app_name","app_id","created_at","updated_at","action"],options:{texts:{filter:"",limit:""},headings:{app_name:this.trans("app_name"),app_id:this.trans("app_id"),created_at:this.trans("created-at"),updated_at:this.trans("updated-at"),action:this.trans("action")},templates:{action:(t,n)=>e.h(j,{data:n}),created_at(t,n){return e.formattedTime(n.created_at)},updated_at(t,n){return e.formattedTime(n.updated_at)}},sortable:["app_name","app_id","created_at","updated_at"],filterable:["app_name","app_id","created_at","updated_at"],pagination:{chunk:5,nav:"fixed",edge:!0},requestAdapter(t){return{sort_field:t.orderBy?t.orderBy:"id",sort_order:t.ascending?"desc":"asc",search_query:t.query.trim(),page:t.page,limit:t.limit}},responseAdapter({data:t}){return e.hideDefaultLogin=t.data.hide_default_login,{data:t.data.directories.data.map(n=>(n.edit_url="/azure-active-directory/"+n.id+"/edit",n.delete_url=this.basePath()+"/api/azure-active-directory/settings/"+n.id,n)),count:t.data.directories.total}},orderBy:{column:"id",ascending:!0}},apiUrl:"api/azure-active-directory/settings"}},methods:{updateHideDefaultLogin(){this.isLoading=!0;const e={hide_default_login:this.hideDefaultLogin};z.post("api/azure-active-directory/hide-default-login",e).then(t=>{B(t,"azure-list-page")}).catch(t=>{A(t,"azure-list-page")}).finally(()=>{this.isLoading=!1})}}},X={class:"col-sm-12"},Z={class:"card-tools d-flex mt-1"},Q={class:"btn-tool"};function Y(e,t,n,m,a,i){const l=p("alert"),c=p("loader"),u=p("router-link"),v=p("data-table"),y=p("faveo-box"),k=q("tooltip");return o(),d("div",X,[r(l,{componentName:"dataTableModal"}),r(y,{title:e.trans("list_of_azure_active_directories")},{headerMenu:_(()=>[s("div",Z,[h((o(),L(u,{class:"btn btn-tool",to:"/azure-active-directory/create"},{default:_(()=>t[2]||(t[2]=[s("i",{class:"glyphicon glyphicon-plus","aria-hidden":"true"},null,-1)])),_:1})),[[k,e.trans("create_new_directory")]]),h((o(),d("span",Q,[h(s("input",{class:"hide-checkbox",type:"checkbox","onUpdate:modelValue":t[0]||(t[0]=D=>a.hideDefaultLogin=D),onChange:t[1]||(t[1]=D=>i.updateHideDefaultLogin())},null,544),[[x,a.hideDefaultLogin]])])),[[k,e.trans("hide_default_login")]])])]),default:_(()=>[r(l,{componentName:"azure-list-page"}),a.isLoading?(o(),L(c,{key:0,duration:4e3})):g("",!0),r(v,{url:a.apiUrl,dataColumns:a.columns,option:a.options},null,8,["url","dataColumns","option"])]),_:1},8,["title"])])}const ee=C(W,[["render",Y],["__scopeId","data-v-f1760f60"]]);function te(e){const{appName:t,appId:n,appSecret:m,tenantId:a}=e;var i={appName:[t,"isRequired"],appId:[n,"isRequired"],appSecret:[m,"isRequired"],tenantId:[a,"isRequired"]};const l=new T(E),{errors:c,isValid:u}=l.validate(i);return P.dispatch("setValidationError",c),{errors:c,isValid:u}}const ae={name:"AzureActiveDirectorySettings",data:()=>({app_name:"",app_id:"",app_secret:"",tenant_id:"",login_button_label:"",hasDataPopulated:!0,loading:!1,azureAdId:null}),beforeMount(){const e=F(window.location.pathname);this.azureAdId=e||"",this.azureAdId&&this.getConfiguration()},methods:{onChange(e,t){this[t]=e},isValid(){return te(this.$data).isValid},saveConfiguration(e=!1){this.isValid()&&(this.loading=!0,z.post("api/azure-active-directory/settings",{id:this.azureAdId,app_name:this.app_name,tenant_id:this.tenant_id,app_id:this.app_id,app_secret:this.app_secret,login_button_label:this.login_button_label,import:e}).then(t=>{this.loading=!1,this.hasDataPopulated=!0,B(t,"AzureActiveDirectorySettings"),this.azureAdId&&setTimeout(()=>{this.$router.push({name:"AzureActiveDirectory Settings"})},3e3),this.azureAdId=t.data.data.azure_ad_id,this.getConfiguration()}).catch(t=>{this.loading=!1,A(t,"AzureActiveDirectorySettings")}).finally(()=>{this.loading=!1}))},getConfiguration(){this.loading=!0,z.get("api/azure-active-directory/settings/"+this.azureAdId).then(e=>{this.app_name=e.data.data.app_name,this.tenant_id=e.data.data.tenant_id,this.app_id=e.data.data.app_id,this.app_secret=e.data.data.app_secret,this.login_button_label=e.data.data.login_button_label}).catch(e=>{A(e,"AzureActiveDirectorySettings")}).finally(()=>{this.loading=!1})}},components:{"static-select":M,"text-field":R,checkbox:K}},ne={class:"col-sm-12"},ie={key:0,class:"row"},oe={key:1},re={class:"row"},se={class:"row"},le={class:"row"},de={class:"card-footer"},ue=["disabled"],pe=["disabled"];function ce(e,t,n,m,a,i){const l=p("custom-loader"),c=p("alert"),u=p("text-field"),v=p("faveo-box"),y=q("focus-first-input");return o(),d("div",ne,[e.hasDataPopulated===!1||e.loading===!0?(o(),d("div",ie,[r(l)])):g("",!0),r(c,{componentName:"AzureActiveDirectorySettings"}),e.hasDataPopulated?(o(),d("div",oe,[r(v,{title:e.lang("configuration_settings")},{actions:_(()=>[s("div",de,[s("button",{id:"azure-settings-save",class:"btn btn-primary",onClick:t[0]||(t[0]=()=>i.saveConfiguration(!1)),disabled:e.loading},[t[2]||(t[2]=s("span",{class:"fas fa-save"},null,-1)),b("  "+f(e.lang("save")),1)],8,ue),s("button",{id:"azure-settings-submit",class:"btn btn-primary",onClick:t[1]||(t[1]=()=>i.saveConfiguration(!0)),disabled:e.loading},[t[3]||(t[3]=s("span",{class:"fas fa-save"},null,-1)),b("  "+f(e.lang("save_and_import")),1)],8,pe)])]),default:_(()=>[h((o(),d("div",re,[r(u,{label:e.trans("app_name"),value:e.app_name,type:"text",name:"app_name",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-md-6",required:!0,id:"app-name"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.lang("tenant_id"),value:e.tenant_id,type:"text",name:"tenant_id",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"tenant-id"},null,8,["label","value","onChange","placehold"])])),[[y]]),s("div",se,[r(u,{label:e.trans("app_id"),value:e.app_id,type:"text",name:"app_id",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"app-id"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.trans("app_secret"),value:e.app_secret,type:"password",name:"app_secret",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0,id:"app-secret"},null,8,["label","value","onChange","placehold"])]),s("div",le,[r(u,{label:e.trans("login_button_label"),value:e.login_button_label,type:"text",name:"login_button_label",onChange:i.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",id:"login-button-label"},null,8,["label","value","onChange","placehold"]),r(u,{label:e.trans("azure_redirect_uri"),hint:e.trans("azure_redirect_uri_hint"),value:e.basePath()+"/azure-active-directory/auth-token/callback",type:"text",name:"login_button_label",onChange:i.onChange,classname:"col-sm-6",disabled:!0},null,8,["label","hint","value","onChange"])])]),_:1},8,["title"])])):g("",!0)])}const w=C(ae,[["render",ce]]);const _e={props:["data"],data(){return{azureSettings:null,oauthLogin:"",oauthConfig:{"border-radius":"4px !important","border-width":"2px !important","border-color":"#BDC1CAFF !important","border-style":"solid !important"}}},beforeMount(){this.azureSettings=JSON.parse(this.data).providerData.azure_meta_settings,this.azureSettings.hide_default_login&&this.hideDefaultLogin(),this.oauthLogin=JSON.parse(this.data).login_type},methods:{azureLoginSubmit(e){window.location=e},hideDefaultLogin(){document.getElementById("user_name").style.display="none",document.getElementById("password").style.display="none",document.getElementById("remember_me").style.display="none",document.getElementById("default-login-button").style.display="none",document.getElementById("default-forgot-password").style.display="none"}},computed:{...$({buttonStyle:"getButtonStyle",linkStyle:"getLinkStyle"})}},ge={key:0,id:"azure-login"},me=["src","alt"],he={class:"azure-login-block"},be={class:"d-grid"},fe=["id","onClick"],ve={key:0};function ye(e,t,n,m,a,i){return a.azureSettings?(o(),d("div",ge,[a.azureSettings.hide_default_login?(o(),d("img",{key:0,src:e.basePath()+"/images/azure.png",style:{margin:"-60px 0 -10px 92px"},alt:e.trans("azure_active_directory"),width:"256",height:"256"},null,8,me)):g("",!0),(o(!0),d(S,null,H(a.azureSettings.directory_settings,(l,c)=>(o(),d("span",he,[s("div",be,[s("button",{id:"azure-login-button-"+c,class:I(["azure-login-button btn-block btn-flat mt-1 mb-2",a.oauthLogin==="oAuth"?"btn-light link-dark border-0 p-2":"btn btn-custom"]),style:U(a.oauthLogin==="oAuth"?"border-radius: 4px !important; border-width: 1px !important; border-color: #BDC1CAFF !important; border-style: solid !important;":e.buttonStyle),onClick:()=>i.azureLoginSubmit(l.login_url)},[s("i",{class:I(["fa fa-server",a.oauthLogin==="oAuth"?"text-info":""]),"aria-hidden":"true"},null,2),t[0]||(t[0]=b("  ")),a.oauthLogin==="oAuth"?(o(),d("strong",ve,f(l.login_button_label!==""?l.login_button_label:e.lang("login_via_azure")),1)):(o(),d(S,{key:1},[b(f(l.login_button_label!==""?l.login_button_label:e.lang("login_via_azure")),1)],64))],14,fe)])]))),256))])):g("",!0)}const ze=C(_e,[["render",ye]]);let Ae={path:"/azure-active-directory",component:G,name:"Azure",redirect:"/azure-active-directory/settings",children:[{path:"settings",component:ee,name:"AzureActiveDirectory Settings",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"azure_configuration_settings"}}},{path:"create",component:w,name:"AzureActiveDirectory Create",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"azure_configuration_settings",to:"/azure-active-directory"},active:"create"}}},{path:":id/edit",component:w,name:"AzureActiveDirectory Edit",meta:{title:"azure_configuration_settings",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},parent_link:{name:"azure_configuration_settings",to:"/azure-active-directory"},active:"edit"}}}]};O.addRoute(Ae);J("azure-login",ze,"login-box-mounted","login-box");
