import{_ as Z,a5 as q,e as o,aj as B,a2 as V,k as T,W as Q,o as b,l as x,v as t,I,x as c,m as X,G as h,L as k,N as ne,q as M,ak as j,F as O,J as le,B as R,E as z,al as re,a4 as ie,w as de,O as H}from"../../../../v9.4.0.5/chunks/bootstrap.js";import{C as ce}from"../../../../v9.4.0.5/chunks/Checkbox.js";import{C as F,Z as me,R as G,j as L,t as P,T as pe,X as ue,_ as fe,r as ye}from"../../../../v9.4.0.5/chunks/index.js";const ve={components:{Checkbox:ce,Modal:q},name:"FaveoRedaction",props:{data:{type:String,required:!0}},setup(p){const a=o(!1),y=o(!1),e=o(""),_=o(""),v=o(""),g=o(""),f=o(""),m=o(""),w=o(""),s=o(null),D=o(""),C=o(""),d=o(3600),r=o(!0),u=o(""),K=[{label:"True",value:!0},{label:"False",value:!1}],E=async()=>{const{privateKey:n,publicKey:i}=await me({type:"rsa",rsaBits:2048,userIDs:[{name:"User",email:"user@example.com"}],passphrase:"vks9fODlRcTdQdftGJSSIw"});return{privateKey:n,publicKey:i}},W=async n=>{const i=await G({armoredKey:f.value}),S=await L({text:n});D.value=await P({message:S,encryptionKeys:i}),y.value=!1,await l()},N=async()=>{const n=await G({armoredKey:f.value});v.value=await P({message:await L({text:_.value}),encryptionKeys:n}),y.value=!1,await l()},l=async()=>{try{const n=e.value==="message"?v.value:D.value,i=await R.post("secret/secret-messages",{secret_messages:n,expiration:d.value,ticket_id:JSON.parse(p.data).ticket.id,one_time:r.value,messageKey:w.value,filename:C.value});window.emitter.emit("appendSecretMessage",i.data)}catch(n){z(n,"timeline")}},U=o([]),Y=async()=>{try{const n=await R.get("secret/file-system-settings-values");n.data.success&&(U.value=n.data.data.allowed_files.split(","))}catch(n){z(n,"timeline")}},J=async n=>{const i=n.target.files[0],S=i.name.split(".").pop().toLowerCase();if(U.value.includes(S))u.value="";else{u.value=V("file_type_not_supported")+`${U.value.join(", ")}`;return}if(i.size>5*1024*1024){u.value=V("secret_file_upload_size");return}else u.value="";C.value=i.name;const A=new FileReader;A.onload=async se=>{const oe=se.target.result;await W(oe)},A.readAsDataURL(i),s.value=i};B(async()=>{await Y()});const $=async()=>{e.value==="message"?await N():e.value==="image"&&s.value&&await J({target:{files:[s.value]}})},ee=n=>{e.value=n,y.value=!0,r.value=!0,_.value="",C.value=""},ae=()=>{y.value=!1,u.value=""},te=(n,i)=>{i==="sendOneTimeDownload"&&(r.value=n)};return B(async()=>{const{publicKey:n,privateKey:i}=await E();f.value=n,m.value=i;const S="uJELGmwsyWIZP6yiA";w.value=F.AES.encrypt(m.value,S).toString()}),{showModal:y,modalType:e,message:_,encryptedMessage:v,decryptedMessage:g,publicKey:f,privateKey:m,encrptedPrivatekey:w,imageFile:s,encryptedImage:D,fileName:C,selectedDuration:d,sendOneTimeDownload:r,checkboxOptions:K,encryptContent:$,onImageUpload:J,sendingData:l,onClose:ae,onChange:te,openModal:ee,lang:V,loading:a,fileSizeError:u}}},ge={class:"btn btn-light btn-sm dropdown-toggle secretContent",type:"button","data-bs-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"},we={class:"dropdown-menu","aria-labelledby":"secretMessageDropdown"},_e={class:"modal-title"},be={key:0,class:"col-sm-12"},he=["placeholder"],Ce={key:1,class:"col-sm-12"},xe={for:"fileInput",class:"btn-bs-file btn btn-sm btn-light btn-block"},ke={key:0,class:"text-danger mt-2 mb-1"},Me={class:"col-sm-6 duration"},Te={class:"durationText mt-2"},De={class:"radio-buttons-inline"},Ke={class:"custom-label cursor-pointer",for:"one-hour"},Se={class:"custom-label cursor-pointer",for:"one-day"},Ie={class:"custom-label cursor-pointer",for:"one-week"},We={class:"row p-0"},Oe=["disabled"];function Ee(p,a,y,e,_,v){const g=T("Checkbox"),f=T("alert"),m=T("modal"),w=Q("focus-first-input");return b(),x(le,null,[t("button",ge,[a[9]||(a[9]=t("i",{class:"fa-solid fa-lock"},null,-1)),I(" "+c(p.trans("secret_content")),1)]),t("div",we,[t("a",{class:"dropdown-item",onClick:a[0]||(a[0]=s=>e.openModal("message"))},[a[10]||(a[10]=t("i",{class:"fa-solid fa-envelope-open-text me-1"},null,-1)),I(c(p.trans("secret_message")),1)]),t("a",{class:"dropdown-item",onClick:a[1]||(a[1]=s=>e.openModal("image"))},[a[11]||(a[11]=t("i",{class:"fa-solid fa-file-circle-plus me-1"},null,-1)),I(c(p.trans("secret_file")),1)])]),e.showModal?(b(),X(m,{key:0,showModal:e.showModal,onClose:e.onClose},{title:h(()=>[t("h4",_e,c(e.modalType==="message"?e.lang("secret_message"):e.lang("secret_file")),1)]),fields:h(()=>[e.modalType==="message"?k((b(),x("div",be,[t("label",null,c(e.lang("encrypt_message")),1),k(t("textarea",{"onUpdate:modelValue":a[2]||(a[2]=s=>e.message=s),cols:8,name:"task_description",placeholder:p.trans("whats_your_secret"),class:"form-control"},null,8,he),[[ne,e.message]])])),[[w]]):M("",!0),e.modalType==="image"?(b(),x("div",Ce,[t("input",{type:"file",onChange:a[3]||(a[3]=(...s)=>e.onImageUpload&&e.onImageUpload(...s)),class:"form-control-file d-none",id:"fileInput"},null,32),t("label",xe,[t("span",null,[a[12]||(a[12]=t("i",{class:"far fa-file"},null,-1)),I(" "+c(e.fileName||"Choose file"),1)])]),e.fileSizeError?(b(),x("div",ke,c(e.fileSizeError),1)):M("",!0),t("i",null,c(e.lang("file_upload_size")),1)])):M("",!0),t("div",Me,[t("p",Te,c(e.lang("the_encryted_message_will_be_deleted")),1),t("div",De,[t("div",null,[k(t("input",{type:"radio",class:"custom-input cursor-pointer",id:"one-hour",value:3600,"onUpdate:modelValue":a[4]||(a[4]=s=>e.selectedDuration=s)},null,512),[[j,e.selectedDuration]]),t("label",Ke,c(e.lang("one_hour")),1)]),t("div",null,[k(t("input",{type:"radio",class:"custom-input cursor-pointer",id:"one-day",value:86400,"onUpdate:modelValue":a[5]||(a[5]=s=>e.selectedDuration=s)},null,512),[[j,e.selectedDuration]]),t("label",Se,c(e.lang("one_day")),1)]),t("div",null,[k(t("input",{type:"radio",class:"custom-input cursor-pointer",id:"one-week",value:604800,"onUpdate:modelValue":a[6]||(a[6]=s=>e.selectedDuration=s)},null,512),[[j,e.selectedDuration]]),t("label",Ie,c(e.lang("one_week")),1)])]),t("div",We,[O(g,{modelValue:e.sendOneTimeDownload,"onUpdate:modelValue":a[7]||(a[7]=s=>e.sendOneTimeDownload=s),name:"sendOneTimeDownload",value:e.checkboxOptions,label:p.trans("view_once"),onChange:e.onChange,classname:"col-sm-12 mt-2"},null,8,["modelValue","value","label","onChange"])])])]),alert:h(()=>[O(f,{componentName:"inbox-reply"})]),controls:h(()=>[e.modalType==="message"?(b(),x("button",{key:0,type:"button",onClick:a[8]||(a[8]=(...s)=>e.encryptContent&&e.encryptContent(...s)),class:"btn btn-primary",disabled:!e.message},[a[13]||(a[13]=t("i",{class:"fa-solid fa-envelope-open-text me-1"},null,-1)),I(c(e.lang("save")),1)],8,Oe)):M("",!0)]),_:1},8,["showModal","onClose"])):M("",!0)],64)}const Ne=Z(ve,[["render",Ee],["__scopeId","data-v-4795cb53"]]),Ue={components:{previewContent:re,Alert:ie,Modal:q},name:"SecretMessageDecryption",props:{data:{type:String,required:!0}},setup(p){const a=o(!1),y=o("Decrypted Content"),e=o(""),_=o("text"),v=o(""),g=o(""),f=o(""),m=o("decrypted-image.png"),w=async d=>{await s(d);const r="vks9fODlRcTdQdftGJSSIw";try{const u=await pe({armoredKey:g.value}),K=await ue({privateKey:u,passphrase:r}),E=await fe({armoredMessage:v.value}),{data:W}=await ye({message:E,decryptionKeys:K,format:"utf8"}),N=l=>l.startsWith("data:image/")?"image":l.startsWith("data:application/pdf")?"pdf":l.startsWith("data:text/csv")?"csv":l.startsWith("data:text/plain")?"filetext":l.startsWith("data:application/json")?"json":l.startsWith("data:application/zip")?"zip":l.startsWith("data:application/x-rar-compressed")?"rar":l.startsWith("data:application/msword")?"doc":l.startsWith("data:application/vnd.openxmlformats-officedocument.wordprocessingml.document")?"docx":l.startsWith("data:application/vnd.ms-excel")?"xls":l.startsWith("data:application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")?"xlsx":l.startsWith("data:application/vnd.ms-powerpoint")?"ppt":l.startsWith("data:application/vnd.openxmlformats-officedocument.presentationml.presentation")?"pptx":"text";_.value=N(W),e.value=W}catch{}},s=async d=>{try{const r=await R.get(`secret/secret-messages/show/${d}`);v.value=r.data.data.secret_messages,m.value=r.data.data.filename||"decrypted-image.png";const u="uJELGmwsyWIZP6yiA",K=F.AES.decrypt(r.data.data.messageKey,u);g.value=K.toString(F.enc.Utf8),f.value=""}catch(r){v.value="",g.value="",e.value="",setTimeout(()=>{z(r,"secret-message-model")},800)}},D=()=>{const d=document.createElement("a");d.href=e.value,d.download=typeof m.value=="string"?m.value:"download.jpeg",document.body.appendChild(d),d.click(),document.body.removeChild(d)},C=()=>{window.emitter.emit("hideRedactionPreviewModal"),a.value=!1};return de(()=>p.data,d=>{const r=JSON.parse(d);a.value=r.showModal,r.id&&w(r.id)},{immediate:!0}),{showModal:a,modalTitle:y,decryptedMessage:e,contentType:_,fileName:m,downloadImage:D,onClose:C}}},Ve={class:"modal-title"};function je(p,a,y,e,_,v){const g=T("alert"),f=T("preview-content"),m=T("modal"),w=Q("tooltip");return b(),X(m,{key:0,showModal:!0,onClose:e.onClose},{title:h(()=>[t("h4",Ve,c(e.modalTitle),1)]),alert:h(()=>[O(g,{componentName:"secret-message-model"})]),fields:h(()=>[O(f,{decryptedMessage:e.decryptedMessage,filename:e.fileName,contentType:e.contentType},null,8,["decryptedMessage","filename","contentType"])]),controls:h(()=>[this.contentType==="image"?k((b(),x("button",{key:0,class:"btn btn-light",onClick:a[0]||(a[0]=(...s)=>e.downloadImage&&e.downloadImage(...s))},a[1]||(a[1]=[t("i",{class:"fa-solid fa-file-arrow-down"},null,-1)]))),[[w,p.trans("download_link_here")]]):M("",!0)]),_:1},8,["onClose"])}const Re=Z(Ue,[["render",je]]);H("redaction-profile",Ne,"redaction-box-mounted","redaction-view");H("view-redaction",Re,"render-redacted-message","view-redacted-content");
