import{ad as k,a2 as R,s as M,_ as b,B as g,C as O,E as V,T as S,R as F,k as _,W as D,o,l as i,F as l,q as h,m as A,G as v,v as n,I as P,x as p,L as w,ao as I,t as C,J as x,K as U,O as B}from"../../../../v9.4.0.5/chunks/bootstrap.js";import{r as N,A as T}from"../../../../v9.4.0.5/chunks/adminRouter.js";import"../../../../v9.4.0.5/chunks/vue-router.js";import"../../../../v9.4.0.5/chunks/FormGenerator.js";import"../../../../v9.4.0.5/chunks/AdminNavigationBar.js";import"../../../../v9.4.0.5/chunks/DataTableActions.js";import"../../../../v9.4.0.5/chunks/Checkbox.js";import"../../../../v9.4.0.5/chunks/HelpSection.js";function j(e){const{username:t,password:m,source:c}=e;let a={username:[t,"isRequired"],password:[m,"isRequired"],source:[c,"isRequired"]};const s=new k(R),{errors:u,isValid:r}=s.validate(a);return M.dispatch("setValidationError",u),{errors:u,isValid:r}}const E={name:"crm-settings",description:"Alliance CRM Settings page",data(){return{loading:!0,hasDataPopulated:!1,username:"",password:"",source:"",app_id:"",app_secret:"",radioOptions:[{name:"yes",value:1},{name:"no",value:0}],required_for_agents:1,required_for_clients:1}},beforeMount(){this.getInitialValues()},methods:{getInitialValues(){this.loading=!0,g.get("/alliance-crm/api/settings").then(e=>{this.loading=!1,this.hasDataPopulated=!0,this.updatesStateWithData(e.data.data)}).catch(e=>{this.loading=!1,this.hasDataPopulated=!0})},updatesStateWithData(e){const t=this,m=this.$data;Object.keys(e).map(c=>{m.hasOwnProperty(c)&&(t[c]=e[c])})},isValid(){const{errors:e,isValid:t}=j(this.$data);return t},onChange(e,t){this[t]=e},onSubmit(){if(this.isValid()){this.loading=!0;let e={};e.username=this.username,e.password=this.password,e.source=this.source,e.app_id=this.app_id||null,e.app_secret=this.app_secret||null,e.required_for_agents=this.required_for_agents,e.required_for_clients=this.required_for_clients,g.post("/alliance-crm/api/settings",e).then(t=>{this.loading=!1,this.hasDataPopulated=!0,O(t,"crm-settings"),this.getInitialValues()}).catch(t=>{this.loading=!1,this.hasDataPopulated=!0,V(t,"crm-settings")})}}},components:{"text-field":S,"radio-button":F}},L={class:"col-sm-12"},W={key:0},H={class:"row"},J={class:"row"},z={class:"row"},G={class:"card-footer"},K=["disabled"];function Q(e,t,m,c,a,s){const u=_("alert"),r=_("custom-loader"),d=_("text-field"),f=_("radio-button"),y=_("faveo-box"),q=D("focus-first-input");return o(),i("div",L,[l(u,{componentName:"crm-settings"}),a.loading?(o(),i("div",W,[l(r,{loadingSpeed:4e3})])):h("",!0),a.hasDataPopulated?(o(),A(y,{key:1,title:e.trans("alliance_crm_integration")},{actions:v(()=>[n("div",G,[n("button",{slot:"actions",type:"button",onClick:t[0]||(t[0]=_e=>s.onSubmit()),disabled:a.loading,class:"btn btn-primary"},[t[1]||(t[1]=n("i",{class:"fa fa-save"},null,-1)),P(" "+p(e.trans("save")),1)],8,K)])]),default:v(()=>[w((o(),i("div",H,[l(d,{label:e.trans("user_name"),type:"text",value:a.username,name:"username",class:"col-sm-6",required:!0,onChange:s.onChange},null,8,["label","value","onChange"]),l(d,{label:e.trans("password"),type:"password",name:"password",value:a.password,classname:"col-sm-6",required:!0,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])])),[[q]]),n("div",J,[l(d,{label:e.trans("source"),type:"text",value:a.source,name:"source",class:"col-sm-6",required:!0,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"]),l(d,{label:e.trans("app_id"),type:"text",name:"app_id",value:a.app_id,classname:"col-sm-6",required:!1,onChange:s.onChange,placehold:e.lang("enter_a_value")},null,8,["label","value","onChange","placehold"])]),n("div",z,[l(d,{label:e.trans("app_secret"),type:"text",value:a.app_secret,name:"app_secret",class:"col-sm-6",required:!1,onChange:s.onChange},null,8,["label","value","onChange"]),l(f,{options:a.radioOptions,label:e.trans("required_for_agents"),name:"required_for_agents",value:a.required_for_agents,onChange:s.onChange,classname:"form-group col-sm-6"},null,8,["options","label","value","onChange"]),l(f,{options:a.radioOptions,label:e.trans("required_for_clients"),name:"required_for_clients",value:a.required_for_clients,onChange:s.onChange,classname:"form-group col-sm-6"},null,8,["options","label","value","onChange"])])]),_:1},8,["title"])):h("",!0)])}const X=b(E,[["render",Q],["__scopeId","data-v-c9f595d3"]]);const Y={name:"alliance-customer-timeline",props:{data:{type:String,required:!0}},data(){return{showUserData:!1,customerDataFields:{},loading:!0,userData:null,cardOpen:!1}},beforeMount(){this.userData=JSON.parse(this.data)},created(){window.emitter.on("ticket-timeline-boxes-mounted",this.updateUserData)},methods:{toggleCard(){this.cardOpen=!this.cardOpen,this.cardOpen&&this.getCustomerFromCRM()},updateUserData(e){this.userData.user.user_name!=e.user.user_name&&(this.userData=e,this.getCustomerFromCRM())},getCustomerFromCRM(){let e=this.userData.id;this.showUserData=!1,this.loading=!0,g.get("/alliance-crm/api/search-ticket-customer/"+e+"?"+I()).then(t=>{this.showUserData=!0,this.customerDataFields=t.data.data,this.loading=!1}).catch(t=>{this.loading=!1})},ucfirst(e){return e.charAt(0).toUpperCase()+e.slice(1)}}},Z={class:"card card-light"},$={class:"card-header pointer"},ee={class:"card-tools"},te={key:0,class:"card-body"},ae={key:0},se={class:"row"},ne={class:"col-md-12"},oe={key:0,class:"row"},re={class:"col-md-6 info-row"},ie={class:"col-md-6"},le={class:"col-md-6"},ce={key:1};function de(e,t,m,c,a,s){const u=D("tooltip");return o(),i("div",Z,[n("div",$,[n("h3",{class:"card-title w_80",onClick:t[0]||(t[0]=(...r)=>s.toggleCard&&s.toggleCard(...r))},p(e.trans("alliance_crm_infomation")),1),n("div",ee,[a.cardOpen?w((o(),i("a",{key:0,class:C(["btn btn-tool",a.loading?"rotating":""]),onClick:t[1]||(t[1]=(...r)=>s.getCustomerFromCRM&&s.getCustomerFromCRM(...r)),href:"javascript:;"},t[3]||(t[3]=[n("i",{class:"fas fa-sync-alt"},null,-1)]),2)),[[u,e.trans("refresh")]]):h("",!0),n("button",{type:"button",class:"btn btn-tool",onClick:t[2]||(t[2]=(...r)=>s.toggleCard&&s.toggleCard(...r))},[n("i",{class:C([{"fas fa-angle-up":a.cardOpen,"fas fa-angle-down":!a.cardOpen},"fs-25"])},null,2)])])]),a.cardOpen?(o(),i("div",te,[a.loading?h("",!0):(o(),i("div",ae,[n("div",se,[n("div",ne,[a.showUserData?(o(),i("div",oe,[(o(!0),i(x,null,U(a.customerDataFields,(r,d)=>(o(),i("div",re,[n("div",ie,[n("label",null,p(s.ucfirst(d)),1)]),n("div",le,p(r),1)]))),256))])):(o(),i("div",ce,p(e.lang("alliance_crm_infomation_description")),1))])])]))])):h("",!0)])}const ue=b(Y,[["render",de],["__scopeId","data-v-0a14781e"]]);let me={path:"/alliance-crm",component:T,name:"AllianceCRM",redirect:"/alliance-crm/settings",children:[{path:"settings",component:X,name:"AllianceCRM Settings",meta:{title:"alliance_crm_integration",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"alliance_crm_integration"}}}]};N.addRoute(me);B("alliance-customer-timeline",ue,"ticket-timeline-boxes-mounted","timeline-boxes");
