import{ad as T,a2 as B,s as L,_ as C,B as q,E as k,C as S,T as V,D as F,k as d,W as v,o as i,m as f,G as u,v as o,x as W,F as l,l as h,q as _,L as b,t as N,I as P,a1 as M,H as R}from"../../../../v9.4.0.5/chunks/bootstrap.js";import{L as U,r as O,A as H}from"../../../../v9.4.0.5/chunks/adminRouter.js";import{b as I,c as Y}from"../../../../v9.4.0.5/chunks/DataTableActions.js";import{S as z}from"../../../../v9.4.0.5/chunks/FormGenerator.js";import"../../../../v9.4.0.5/chunks/vue-router.js";import"../../../../v9.4.0.5/chunks/HelpSection.js";import"../../../../v9.4.0.5/chunks/AdminNavigationBar.js";import"../../../../v9.4.0.5/chunks/Checkbox.js";function j(e){const{name:t,sid:s,token:g,business_phone:a}=e;let n={name:[t,"isRequired"],sid:[s,"isRequired"],token:[g,"isRequired"],business_phone:[a,"isRequired"]};const p=new T(B),{errors:m,isValid:r}=p.validate(n);return L.dispatch("setValidationError",m),{errors:m,isValid:r}}const G={data(){return{template:"",password:"password",name:"",sid:"",token:"",business_phone:"",webhook_url:"",app_exists:!1,required:!0,loading:!1,isLoading:!1,loadingSpeed:4e3,elements_new_ticket:[{name:"One Day",value:1},{name:"Five Days",value:5},{name:"Ten Days",value:10},{name:"Fifteen Days",value:15},{name:"Thirty Days",value:30}],containerStyle:{width:"500px"},elements_is_image_inline:[{name:"Yes",value:1},{name:"No",value:0}],new_ticket_interval:{name:"One Day",value:"1"},is_image_inline:{name:"Yes",value:1}}},methods:{resetFields(){this.name="",this.sid="",this.token="",this.business_phone="",this.is_image_inline={name:"Yes",value:1},this.new_ticket_interval="",this.template=""}}};const J={mixins:[G],name:"whatsapp-create-edit-modal",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},title:{type:String,default:""},app_id:{type:[String,Number],default:""}},data(){return{loading:!1,isDisabled:!1,name:"",auth_token:"",account_sid:"",department:"",iconClass:"fas fa-save",btnName:"save"}},beforeMount(){this.app_id&&(this.iconClass="fas fa-sync",this.btnName="update",this.getData())},methods:{getData(){this.loading=!0,this.isDisabled=!0,q.get("/whatsapp/api/WhatsappNumberList/"+this.app_id).then(e=>{this.loading=!1,this.isDisabled=!1,this.name=e.data.data[0].name,this.token=e.data.data[0].token,this.sid=e.data.data[0].sid,this.business_phone=e.data.data[0].business_phone,this.is_image_inline=this.filterValues(this.elements_is_image_inline,e.data.data[0].is_image_inline),this.new_ticket_interval=this.filterValues(this.elements_new_ticket,e.data.data[0].new_ticket_interval),this.template=e.data.data[0].template,this.department=e.data.data[0].department.name}).catch(e=>{this.isDisabled=!1,this.loading=!1,k(e,"whatsapp-create-edit")})},filterValues(e,t){return e.filter(s=>{if(s.value==t)return s})[0]},onChange(e,t){this[t]=e},isValid(){const{erros:e,isValid:t}=j(this.$data);return t},onSubmit(){if(this.isValid()){this.loading=!0,this.isDisabled=!0;let e={};e.token=this.token,e.name=this.name,e.business_phone=this.business_phone,e.is_image_inline=this.is_image_inline.value,e.new_ticket_interval=this.new_ticket_interval.value,e.sid=this.sid,e.template=this.template,e.dept_id=this.department?this.department.id:null,q.post("/whatsapp/api/createOrUpdate/"+this.app_id,e).then(t=>{this.loading=!1,this.isDisabled=!1,S(t,"whatsapp-create-edit"),setTimeout(()=>{window.emitter.emit("refreshData"),this.onClose()},2e3)}).catch(t=>{this.isDisabled=!1,k(t,"whatsapp-create-edit"),this.loading=!1})}}},computed:{containerStyle(){return{width:"900px",maxWidth:"900px !important"}}},components:{"text-field":V,"dynamic-select":F}},K={class:"modal-title"},Q={key:0,class:"row"},X={key:1,id:"whatsapp-settings"},Z={class:"row"},x={class:"row"},$={class:"row"},ee={class:"row"},te={class:"row"},ae={id:"controls"},se=["disabled"];function ne(e,t,s,g,a,n){const p=d("alert"),m=d("reuse-loader"),r=d("text-field"),c=d("dynamic-select"),y=d("modal"),w=v("focus-first-input");return s.showModal?(i(),f(y,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:n.containerStyle,class:"scrollable-area"},{title:u(()=>[o("h4",K,W(e.trans(s.title)),1)]),alert:u(()=>[l(p,{componentName:"whatsapp-create-edit"})]),fields:u(()=>[a.loading?(i(),h("div",Q,[l(m,{"animation-duration":4e3,color:"#1d78ff",size:60})])):_("",!0),a.loading?_("",!0):(i(),h("div",X,[b((i(),h("div",Z,[l(r,{label:e.lang("name"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:a.name,type:"text",name:"name",required:e.required,classname:"col-sm-6",hint:e.lang("name_hint"),id:"name"},null,8,["label","onChange","placehold","value","required","hint"]),l(r,{label:e.lang("account_sid"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.sid,type:"text",name:"sid",required:e.required,classname:"col-sm-6",hint:e.lang("sid_hint"),id:"sid"},null,8,["label","onChange","placehold","value","required","hint"])])),[[w]]),o("div",x,[l(r,{label:e.lang("auth_token"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.token,type:"password",name:"token",required:e.required,classname:"col-sm-6",hint:e.lang("token_hint"),id:"token"},null,8,["label","onChange","placehold","value","required","hint"]),l(r,{label:e.lang("business_phone"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.business_phone,type:"text",name:"business_phone",required:e.required,classname:"col-sm-6",hint:e.lang("business_phone_hint"),id:"business_phone"},null,8,["label","onChange","placehold","value","required","hint"])]),o("div",$,[l(c,{name:"new_ticket_interval",classname:"col-sm-6",elements:e.elements_new_ticket,multiple:!1,prePopulate:!1,label:e.lang("new_ticket_interval"),value:e.new_ticket_interval,onChange:n.onChange,searchable:!1,clearable:!1},null,8,["elements","label","value","onChange"]),l(c,{label:e.lang("which_department"),multiple:!1,name:"department",strlength:"40",classname:"col-sm-6",apiEndpoint:"/api/dependency/departments",value:a.department,onChange:n.onChange,clearable:!!a.department,style:{"margin-top":"auto"}},null,8,["label","value","onChange","clearable"])]),o("div",ee,[l(c,{name:"is_image_inline",classname:"col-sm-6",elements:e.elements_is_image_inline,multiple:!1,prePopulate:!1,label:e.lang("is_image_inline"),value:e.is_image_inline,onChange:n.onChange,searchable:!1,clearable:!1},null,8,["elements","label","value","onChange"])]),o("div",te,[l(r,{label:e.lang("approved_template_for_whatsapp"),onChange:n.onChange,placehold:e.lang("enter_a_value"),value:e.template,type:"textarea",name:"template",classname:"col-sm-12",hint:e.lang("approved_template_hint"),id:"template",disabled:!1},null,8,["label","onChange","placehold","value","hint"])])]))]),controls:u(()=>[o("div",ae,[o("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=D=>n.onSubmit()),disabled:a.isDisabled},[o("i",{class:N(a.iconClass)},null,2),P(" "+W(e.trans(a.btnName)),1)],8,se)])]),_:1},8,["showModal","onClose","containerStyle"])):_("",!0)}const A=C(J,[["render",ne]]),le={name:"whatsapp-table-actions",props:{data:{type:Object,required:!0}},data(){return{showDeleteModal:!1,showEditModal:!1,title:"whatsapp_number_edit"}},methods:{onModal(e){this[e]=!0,this.$store.dispatch("unsetAlert")},onClose(){this.showEditModal=!1,this.showDeleteModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"delete-modal":I,"whatsapp-create-edit-modal":A}};function ie(e,t,s,g,a,n){const p=d("whatsapp-create-edit-modal"),m=d("delete-modal"),r=v("tooltip");return i(),h("div",null,[b((i(),h("button",{class:"btn btn-light table_btn",onClick:t[0]||(t[0]=c=>n.onModal("showEditModal"))},t[2]||(t[2]=[o("i",{class:"fas fa-edit"},null,-1)]))),[[r,e.lang("edit")]]),b((i(),h("button",{class:"btn btn-light table_btn",onClick:t[1]||(t[1]=c=>n.onModal("showDeleteModal"))},t[3]||(t[3]=[o("i",{class:"fas fa-trash"},null,-1)]))),[[r,e.lang("delete")]]),l(M,{name:"modal"},{default:u(()=>[a.showEditModal?(i(),f(p,{key:0,onClose:n.onClose,showModal:a.showEditModal,title:a.title,app_id:s.data.id},null,8,["onClose","showModal","title","app_id"])):_("",!0)]),_:1}),l(M,{name:"modal"},{default:u(()=>[a.showDeleteModal?(i(),f(m,{key:0,onClose:n.onClose,showModal:a.showDeleteModal,deleteUrl:s.data.delete_url},null,8,["onClose","showModal","deleteUrl"])):_("",!0)]),_:1})])}const oe=C(le,[["render",ie]]),de={components:{"status-switch":z},props:["data"],methods:{onChange(e,t){this.statusChange(t)},statusChange(e){axios.get("whatsapp/api/status/"+e).then(t=>{S(t,"dataTableModal"),window.emitter.emit("refreshData")}).catch(t=>{k(t,"dataTableModal")})}}},re={class:"btn-group"};function he(e,t,s,g,a,n){const p=d("status-switch");return i(),h("div",re,[(i(),f(p,{name:s.data.business_phone,value:s.data.active,key:Math.random(),onChange:n.onChange},null,8,["name","value","onChange"]))])}const pe=C(de,[["render",he]]);const ue={name:"whatsapp-number-settings",data(){return{apiUrl:"whatsapp/api/WhatsappNumberList",columns:["name","business_phone","department.name","status","actions"],options:{},showModal:!1,title:"whatsapp_create",business_phone:"",copied:!1}},beforeMount(){const e=this;this.webhook_url=this.basePath()+"/whatsapp",this.options={headings:{name:this.trans("name"),business_phone:this.trans("whatsapp_number"),status:this.trans("status"),"department.name":this.trans("department"),actions:this.trans("actions")},columnsClasses:{name:"whatsapp-name",business_phone:"whatsapp-number",status:"whatsapp-active",department:"Department",actions:"whatsapp-action"},sortIcon:{base:"glyphicon",up:"glyphicon-chevron-down",down:"glyphicon-chevron-up"},texts:{filter:"",limit:""},templates:{status:(t,s)=>e.h(pe,{data:s}),actions:(t,s)=>e.h(oe,{data:s})},requestAdapter(t){return{"sort-field":t.orderBy?t.orderBy:"id","sort-order":t.ascending?"desc":"asc","search-query":t.query.trim(),page:t.page,limit:t.limit}},responseAdapter({data:t}){return{data:t.data.map(s=>(s.delete_url=e.basePath()+"/whatsapp/api/WhatsappNumberDelete/"+s.id,s)),count:t.data.length}},orderBy:{column:"id",ascending:!0},sortable:[],filterable:!1,pagination:{chunk:5,nav:"fixed",edge:!0}}},methods:{onCopy(){Y(this.webhook_url),this.copied=!0,setTimeout(()=>{this.copied=!1},5e3)},addWhatsApp(){this.showModal=!0},onClose(){this.showModal=!1,this.$store.dispatch("unsetValidationError"),this.$store.dispatch("unsetAlert")}},components:{LabelCreateEdit:U,"Whatsapp-create-edit-modal":A,"text-field":V}},me={class:"col-sm-12"},ce={class:"row"},_e={class:"col-sm-1 ps-0"},be={class:"card-tools"},ge={id:"whatsapp-view"};function fe(e,t,s,g,a,n){const p=d("alert"),m=d("text-field"),r=d("data-table"),c=d("faveo-box"),y=d("Whatsapp-create-edit-modal"),w=v("tooltip"),D=v("focus-first-input");return i(),h("div",me,[l(p,{componentName:"dataTableModal"}),l(c,{title:e.trans("whats_app_number_list")},{headerMenu:u(()=>[o("div",be,[b((i(),h("button",{class:"btn btn-tool",onClick:t[1]||(t[1]=E=>n.addWhatsApp())},t[2]||(t[2]=[o("i",{class:"glyphicon glyphicon-plus"},null,-1)]))),[[w,e.trans("add_whatsapp_number")]])])]),default:u(()=>[b((i(),h("div",ce,[l(m,{label:e.lang("webhook_url"),value:e.webhook_url,type:"text",name:"webhook_url",placehold:e.lang("enter_a_value"),classname:"col-sm-5",hint:e.lang("webhook_url_hint"),id:"webhook_url",disabled:!0},null,8,["label","value","placehold","hint"]),o("div",_e,[b((i(),h("a",{class:"btn btn-light uri-copy",onClick:t[0]||(t[0]=R(E=>n.onCopy(),["prevent"]))},[o("span",{class:N(a.copied?"fas fa-check text-success":"fa fa-clipboard"),id:"eye"},null,2)])),[[w,a.copied?e.trans("clipboard-copy-message"):e.trans("click-to-copy")]])])])),[[D]]),o("div",ge,[l(r,{url:a.apiUrl,dataColumns:a.columns,option:a.options,scroll_to:"whatsapp-view"},null,8,["url","dataColumns","option"])])]),_:1},8,["title"]),l(M,{name:"modal"},{default:u(()=>[a.showModal?(i(),f(y,{key:0,onClose:n.onClose,showModal:a.showModal,title:a.title},null,8,["onClose","showModal","title"])):_("",!0)]),_:1})])}const we=C(ue,[["render",fe],["__scopeId","data-v-d76b9069"]]);let ve={path:"/whatsapp",component:H,name:"Whatsapp",redirect:"/whatsapp/settings",children:[{path:"settings",component:we,name:"Whatsapp Settings",meta:{title:"whatsapp_config",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"whatsapp_settings"}}}]};O.addRoute(ve);
