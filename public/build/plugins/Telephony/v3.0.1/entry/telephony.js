import{_ as k,T as E,D as I,k as m,W as D,o,m as y,G as f,v as i,x as u,l,F as _,t as $,q as c,L as w,B as M,aE as g,E as C,C as A,R as q,I as v,a1 as S,A as K,Z as P,c as O,J as j,K as L,X as U,a9 as G,N as H,aF as J,s as B,ab as W,ay as X}from"../../../../v9.4.0.5/chunks/bootstrap.js";import{r as Z,A as Q}from"../../../../v9.4.0.5/chunks/adminRouter.js";import"../../../../v9.4.0.5/chunks/vue-router.js";import"../../../../v9.4.0.5/chunks/FormGenerator.js";import"../../../../v9.4.0.5/chunks/AdminNavigationBar.js";import"../../../../v9.4.0.5/chunks/DataTableActions.js";import"../../../../v9.4.0.5/chunks/Checkbox.js";import"../../../../v9.4.0.5/chunks/HelpSection.js";const Y={list:[]},x={getItems:e=>e.list},ee={addUpdateElement(e,t){let s=!0;for(let r=0;r<e.list.length;r++)if(e.list[r].id===t.id){clearTimeout(e.list[r].timer.timerId),s=!1,e.list[r].data=t.data,e.list[r].status=t.status,e.list[r].timer=t.timer;break}s&&e.list.push(t),e.list.length>3&&e.list.shift()},removeElement(e,t){clearTimeout(t.timer),e.list=e.list.filter(s=>s.id!==t.id)},clearAll(e){e.list=[]}},te={addUpdateElement({commit:e},t){e("addUpdateElement",t)},removeElement({commit:e},t){e("removeElement",t)},clearAll({commit:e}){e("clearAll")}},ie={state:Y,getters:x,mutations:ee,actions:te};const se={name:"telephony-settings-modal",description:"Telephony settings modal component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},data:{type:Object,default:()=>{}}},data(){return{department:"",helptopic:"",containerStyle:{width:"800px"},loading:!1,dept_url:this.data.base_url,topic_url:this.data.base_url}},methods:{onChange(e,t){this[t]=e,t==="department"&&(e?this.dept_url=this.data.base_url+"/"+e.id+"/department":this.dept_url=this.data.base_url),t==="helptopic"&&(e?this.topic_url=this.data.base_url+"/"+e.id+"/helptopic":this.topic_url=this.data.base_url)},copyDeptUrl(){this.$refs.dept_text.select(),document.execCommand("copy")},copyTopicUrl(){this.$refs.topic_text.select(),document.execCommand("copy")}},components:{"text-field":E,"dynamic-select":I}},ne={class:"modal-title"},oe={key:0,class:"row"},ae={key:1},le={class:"row"},re={class:"row mb-3"},de={class:"col-sm-12"},ce={class:"input-group"},ue=["value"],pe={class:"row mb-3"},me={class:"col-sm-12"},he={class:"input-group"},_e=["value"];function fe(e,t,s,r,n,a){const d=m("reuse-loader"),p=m("dynamic-select"),h=m("modal"),b=D("tooltip");return s.showModal?(o(),y(h,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:n.containerStyle},{title:f(()=>[i("h4",ne,u(e.lang("settings")),1)]),fields:f(()=>[n.loading?(o(),l("div",oe,[_(d,{"animation-duration":4e3,color:"#1d78ff",size:e.size,class:$({spin:e.lang_locale=="ar"})},null,8,["size","class"])])):c("",!0),n.loading?c("",!0):(o(),l("div",ae,[i("div",le,[_(p,{label:e.lang("department"),multiple:!1,name:"department",prePopulate:!0,classname:"col-sm-6",apiEndpoint:"/api/dependency/departments",value:n.department,onChange:a.onChange,clearable:!!n.department},null,8,["label","value","onChange","clearable"]),_(p,{label:e.lang("helptopics"),multiple:!1,name:"helptopic",prePopulate:!0,classname:"col-sm-6",apiEndpoint:"/api/dependency/help-topics",value:n.helptopic,onChange:a.onChange,clearable:!!n.helptopic},null,8,["label","value","onChange","clearable"])]),i("div",re,[i("div",de,[i("label",null,u(e.lang("department_url")),1),i("div",ce,[i("input",{type:"text",class:"form-control",ref:"dept_text",value:n.dept_url,readonly:""},null,8,ue),w((o(),l("button",{class:"btn btn-light telephony_btn",onClick:t[0]||(t[0]=(...T)=>a.copyDeptUrl&&a.copyDeptUrl(...T))},t[2]||(t[2]=[i("i",{class:"fas fa-copy"},null,-1)]))),[[b,e.lang("copy")]])])])]),i("div",pe,[i("div",me,[i("label",null,u(e.lang("helptopic_url")),1),i("div",he,[i("input",{type:"text",class:"form-control",ref:"topic_text",value:n.topic_url,readonly:""},null,8,_e),w((o(),l("button",{class:"btn btn-light telephony_btn",onClick:t[1]||(t[1]=(...T)=>a.copyTopicUrl&&a.copyTopicUrl(...T))},t[3]||(t[3]=[i("i",{class:"fas fa-copy"},null,-1)]))),[[b,e.lang("copy")]])])])])]))]),_:1},8,["showModal","onClose","containerStyle"])):c("",!0)}const ge=k(se,[["render",fe],["__scopeId","data-v-578d56f1"]]),ye={name:"telephony-settings-modal",description:"Telephony settings modal component",props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},data:{type:Object,default:()=>{}}},data(){return{app_id:"",token:"",log_miss_call:"",iso:"",containerStyle:{width:"1000px"},loading:!1,isDisabled:!1,radioOptions:[{name:"yes",value:1},{name:"no",value:0}],conversion_waiting_time:0}},beforeMount(){this.getValues()},methods:{getValues(){this.loading=!0,this.isDisabled=!0,M.get("/telephony/api/get-provider-details/"+this.data.short).then(e=>{this.token=g(e.data.data,"key","token").value,this.log_miss_call=g(e.data.data,"key","log_miss_call").value,this.app_id=g(e.data.data,"key","app_id").value,this.iso=g(e.data.data,"key","iso").value,this.fullName=g(e.data.data,"key","name").value,this.shortName=g(e.data.data,"key","short").value,this.conversion_waiting_time=g(e.data.data,"key","conversion_waiting_time").value,this.loading=!1,this.isDisabled=!1}).catch(e=>{this.loading=!1,this.isDisabled=!1,C(e,"telephony-edit")})},onChange(e,t){this[t]=e},onSubmit(){if(this.loading=!0,this.isDisabled=!0,!this.iso)return this.loading=!1,this.isDisabled=!1,this.$store.dispatch("setValidationError",{iso:""}),!1;const e={app_id:this.app_id,token:this.token,log_miss_call:this.log_miss_call,iso:this.iso.iso,conversion_waiting_time:this.conversion_waiting_time};M.post("/telephony/api/update-provider-details/"+this.data.short,e).then(t=>{this.loading=!1,this.isDisabled=!1,this.onClose(),A(t,"dataTableModal")}).catch(t=>{this.loading=!1,this.isDisabled=!1,C(t,"telephony-edit")})}},components:{"text-field":E,"radio-button":q,"dynamic-select":I}},ke={class:"modal-title"},be={key:0},ve={key:0,class:"row"},we={class:"row"},Te={key:1,class:"row"},Ce=["disabled"];function De(e,t,s,r,n,a){const d=m("alert"),p=m("text-field"),h=m("dynamic-select"),b=m("radio-button"),T=m("reuse-loader"),V=m("modal"),z=D("focus-first-input");return s.showModal?(o(),y(V,{key:0,showModal:s.showModal,onClose:s.onClose,containerStyle:n.containerStyle},{title:f(()=>[i("h4",ke,u(e.lang("edit"))+" "+u(this.data.name),1)]),alert:f(()=>[_(d,{componentName:"telephony-edit"})]),fields:f(()=>[n.loading?c("",!0):(o(),l("div",be,[s.data.short!=="threecx"?w((o(),l("div",ve,[_(p,{label:e.lang("api_token"),value:n.token,type:"text",name:"token",onChange:a.onChange,classname:"col-sm-6",hint:e.lang("telephony_app_token_hint")},null,8,["label","value","onChange","hint"]),s.data.short!=="threecx"?(o(),y(p,{key:0,label:e.lang("conversion_waiting_time"),value:n.conversion_waiting_time,type:"text",name:"conversion_waiting_time",onChange:a.onChange,classname:"col-sm-6",hint:e.lang("conversion_waiting_time_hint")},null,8,["label","value","onChange","hint"])):c("",!0)])),[[z]]):c("",!0),i("div",we,[_(h,{label:e.lang("select_default_region"),multiple:!1,name:"iso",required:!0,prePopulate:!0,classname:"col-sm-6",apiEndpoint:"/telephony/api/get-regions-list",value:n.iso,onChange:a.onChange,clearable:!!n.iso,hint:e.lang("default_region")},null,8,["label","value","onChange","clearable","hint"]),_(b,{options:n.radioOptions,label:e.lang("log_miss_call"),name:"log_miss_call",value:n.log_miss_call,onChange:a.onChange,classname:"form-group col-sm-6",hint:e.lang("telephony_log_missed_call_hint")},null,8,["options","label","value","onChange","hint"])])])),n.loading?(o(),l("div",Te,[_(T,{"animation-duration":4e3,color:"#1d78ff",size:60})])):c("",!0)]),controls:f(()=>[i("button",{type:"button",onClick:t[0]||(t[0]=(...F)=>a.onSubmit&&a.onSubmit(...F)),class:"btn btn-primary",disabled:n.isDisabled},[t[1]||(t[1]=i("i",{class:"fas fa-save"},null,-1)),v(" "+u(e.lang("save")),1)],8,Ce)]),_:1},8,["showModal","onClose","containerStyle"])):c("",!0)}const Ne=k(ye,[["render",De]]);const Me={name:"data-table-actions",description:"Contains edit, delete and view buttons as group which can be used as a component as whole. It is built basically for displaying edit, delete and view button in a datable.",props:{data:{type:Object,required:!0}},data(){return{showSettingsModal:!1,showEditModal:!1}},methods:{onClose(){this.showSettingsModal=!1,this.showEditModal=!1,this.$store.dispatch("unsetValidationError")}},components:{"telephony-settings-modal":ge,"telephony-edit-modal":Ne}},Se={class:"block"};function Ue(e,t,s,r,n,a){const d=m("telephony-settings-modal"),p=m("telephony-edit-modal"),h=D("tooltip");return o(),l("div",Se,[w((o(),l("a",{class:"btn btn-primary btn-sm",onClick:t[0]||(t[0]=b=>n.showEditModal=!0),href:"javascript:;"},t[2]||(t[2]=[i("i",{class:"fas fa-edit"},null,-1)]))),[[h,e.lang("edit")]]),w((o(),l("a",{class:"btn btn-primary btn-sm",id:"settings-modal-button",onClick:t[1]||(t[1]=b=>n.showSettingsModal=!0),href:"javascript:;"},t[3]||(t[3]=[i("i",{class:"fas fa-link"},null,-1)]))),[[h,e.lang("get_webhook_url")]]),_(S,{name:"modal"},{default:f(()=>[n.showSettingsModal?(o(),y(d,{key:0,onClose:a.onClose,showModal:n.showSettingsModal,data:s.data},null,8,["onClose","showModal","data"])):c("",!0)]),_:1}),_(S,{name:"modal"},{default:f(()=>[n.showEditModal?(o(),y(p,{key:0,onClose:a.onClose,showModal:n.showEditModal,data:s.data},null,8,["onClose","showModal","data"])):c("",!0)]),_:1})])}const Ee=k(Me,[["render",Ue],["__scopeId","data-v-5d2dbdba"]]),Ie={data(){return{showModal:!1,data:{id:0,name:""},columns:["name","action"],options:{headings:{name:this.trans("name"),action:this.trans("action")},templates:{action:(e,t)=>this.h(Ee,{data:t})},filterable:!1,sortable:[],pagination:{chunk:5,nav:"scroll"},requestAdapter(e){return{page:e.page,limit:e.limit}},responseAdapter({data:e}){return{data:e.data.data.map(t=>(t.edit_modal="api/get-providers-list",t)),count:e.data.total}}},apiUrl:"/telephony/api/get-providers-list"}},components:{"tool-tip":K}},$e={class:"col-sm-12"},Ae={class:"card card-light"},Pe={class:"card-header"},Oe={class:"card-title"},je={class:"card-body"};function Le(e,t,s,r,n,a){const d=m("alert"),p=m("tool-tip"),h=m("data-table");return o(),l("div",$e,[_(d,{componentName:"dataTableModal"}),i("div",Ae,[i("div",Pe,[i("h3",Oe,u(e.lang("telephony_providers")),1),_(p,{message:e.lang("telephony_providers_attributes_description"),size:"large"},null,8,["message"])]),i("div",je,[_(h,{url:n.apiUrl,dataColumns:n.columns,option:n.options},null,8,["url","dataColumns","option"])])])])}const Be=k(Ie,[["render",Le]]);function R(e,t,s,r=!0,n=!0){this.timerId,this.remaining=t,this.canUserStopTimer=s,this.canPauseResume=r,this.showTimer=n,this.pause=function(){clearTimeout(this.timerId)},this.getRemaining=function(){return this.remaining},this.resume=function(){clearTimeout(this.timerId),this.timerId=setInterval(()=>{this.remaining-=1,this.remaining<=0&&(clearTimeout(this.timerId),e())},1e3)},this.resume()}const Re={setup(){const e=P();return{formattedTime:O(()=>e.getters.formattedTime)}},props:{ticketList:{type:Array,default:()=>[]},onTicketClick:{type:Function,required:!0}},data:()=>({}),mounted(){window.onclick=function(e){if(!e.target.matches(".link-ticket-btn")){const t=document.getElementsByClassName("rt_dropdown-content");for(let s=0;s<t.length;s++){let r=t[s];r.classList.contains("rt_show-list")&&r.classList.remove("rt_show-list")}}}},methods:{openTicketList(){document.getElementById("ticket-list-dropdown").classList.toggle("rt_show-list")}}},Ve={key:0,class:"link-ticket dropdown"},ze=["title"],Fe={id:"ticket-list-dropdown",class:"rt_dropdown-content"},qe=["onClick"],Ke={class:"ticket-details-element-table"},Ge=["title"],He={style:{"padding-top":"1rem","padding-left":"1rem"}},Je={style:{"padding-left":"1rem"}},We=["href"],Xe=["title"],Ze={style:{"padding-bottom":"1rem","padding-left":"1rem"}};function Qe(e,t,s,r,n,a){return s.ticketList&&s.ticketList.length>0?(o(),l("div",Ve,[i("i",{class:"fa fa-ticket fa-ticket link-ticket-btn",id:"link-ticket-btn","aria-hidden":"true",title:e.lang("recent_tickets"),onClick:t[0]||(t[0]=d=>a.openTicketList())},null,8,ze),i("div",Fe,[(o(!0),l(j,null,L(s.ticketList,d=>(o(),l("div",{class:"ticket-details-element",key:d.id,onClick:p=>s.onTicketClick(d)},[i("div",Ke,[i("table",null,[i("tr",null,[i("td",{rowspan:"3",style:U({"border-left":"5px solid "+d.priority_color}),title:"Priority: "+d.priority},null,12,Ge),i("td",He,[i("b",null,u(d.title),1)])]),i("tr",null,[i("td",Je,[i("small",null,[i("a",{class:"rt-ticket-number",href:e.basePath()+"/thread/"+d.id,target:"_blank"},"#"+u(d.ticket_number),9,We),i("i",{class:$(d.status_icon),style:U({color:d.status_icon_color}),title:"Status: "+d.status},null,14,Xe)])])]),i("tr",null,[i("td",Ze,[i("small",null,[v(u(e.lang("created_at"))+": ",1),i("b",null,u(r.formattedTime(d.created_at)),1)])])])])])],8,qe))),128))])])):c("",!0)}const Ye=k(Re,[["render",Qe],["__scopeId","data-v-85300957"]]);const xe={name:"call-popup",props:{callData:{type:Object,required:!0}},data:()=>({userNotificationData:null,internalNote:"",linkedTicketObj:null,loading:!1,showUnlinkBtn:!1,isUserActive:!1}),beforeMount(){this.userNotificationData=this.callData,this.linkedTicketObj=this.callData.data.user.linked_ticket},watch:{callData:{handler:function(e,t){this.userNotificationData=e;const s=e.data.user.linked_ticket;s&&(this.linkedTicketObj=s)},deep:!0}},methods:{onStopTimerClick(){this.isUserActive=!0,clearTimeout(this.userNotificationData.timer.timerId),this.userNotificationData.status==="ended"?this.userNotificationData.timer=new R(()=>this.onSubmit(),this.userNotificationData.data.conversion_waiting_time,!1):this.userNotificationData.timer.showTimer=!1,this.userNotificationData.timer.canPauseResume=!1},unLinkTicket(){this.linkedTicketObj=this.callData.data.user.linked_ticket,this.showUnlinkBtn=!1},onTicketClick(e){this.callData.data.user.linked_ticket||(this.linkedTicketObj=e,this.showUnlinkBtn=!0)},onSubmit(){if(clearTimeout(this.userNotificationData.timer.timerId),!this.userNotificationData.data.allow_ticket_conversion){this.$store.dispatch("removeElement",this.userNotificationData);return}this.loading=!0;const e={link_ticket:this.linkedTicketObj?this.linkedTicketObj.id:void 0,notes:this.internalNote?this.internalNote:void 0};axios.post("telephony/api/convert-call-to-ticket/"+this.userNotificationData.id,e).then(t=>{A(t,"layout")}).catch(t=>{C(t,"layout")}).finally(()=>{this.loading=!1,this.$store.dispatch("removeElement",this.userNotificationData)})}},computed:{getUserProfileUrl(){return this.userNotificationData.data.user.id?this.basePath()+"/user/"+this.userNotificationData.data.user.id:""},getUserProfiePic(){return this.userNotificationData.data.user.profile_pic||""}},components:{"faveo-image-element":G,"recent-ticket-list":Ye}},et={class:"telephone-alert-box"},tt={class:"telephone-alert-box-header"},it={key:0},st={id:"call-pop-countdown"},nt=["title"],ot={class:"telephone-alert-box-body"},at={class:"caller-info"},lt={key:0,class:"user-name-and-email"},rt=["href"],dt={key:0},ct={key:1,class:"unknown-user"},ut={key:0},pt={class:"recent-ticket-list-btn"},mt={key:0,class:"linked-ticket-block padding-top-7"},ht=["href"],_t={key:1,class:"take-note padding-top-7"},ft={key:2,class:"telephone-alert-submit padding-top-7"},gt=["disabled"];function yt(e,t,s,r,n,a){const d=m("faveo-image-element"),p=m("recent-ticket-list");return o(),l("div",et,[i("div",tt,[i("header",null,[v(u(e.lang("call_from"))+" ",1),i("b",null,u(e.userNotificationData.data.call_from),1),e.userNotificationData.timer.showTimer?(o(),l("span",it,[i("span",st,[i("b",null,u(e.userNotificationData.timer.getRemaining()),1),e.userNotificationData.timer.canUserStopTimer?(o(),l("i",{key:0,class:"fa fa-stop pointer-cursor","aria-hidden":"true",onClick:t[0]||(t[0]=(...h)=>a.onStopTimerClick&&a.onStopTimerClick(...h)),title:e.lang("click_to_stop_counter_otherwise_popup_will_close")},null,8,nt)):c("",!0)])])):c("",!0)])]),i("div",ot,[i("div",at,[_(d,{id:"caller-profile-image",class:"caller-profile-image-avatar","source-url":a.getUserProfiePic},null,8,["source-url"]),e.userNotificationData.data.is_registered_user?(o(),l("div",lt,[i("a",{href:a.getUserProfileUrl,target:"_blank"},[v(u(e.userNotificationData.data.user.name)+" ",1),e.userNotificationData.status==="started"&&e.userNotificationData.timer.showTimer?(o(),l("sup",dt,t[4]||(t[4]=[i("span",{class:"spinner-grow text-warning spinner-grow-small"},null,-1)]))):c("",!0)],8,rt),t[5]||(t[5]=i("br",null,null,-1)),i("small",null,u(e.userNotificationData.data.user.email),1)])):(o(),l("div",ct,[v(u(e.lang("unknown_user"))+" ",1),e.userNotificationData.status==="started"&&e.userNotificationData.timer.showTimer?(o(),l("sup",ut,t[6]||(t[6]=[i("span",{class:"spinner-grow text-warning spinner-grow-small"},null,-1)]))):c("",!0)])),i("div",pt,[e.isUserActive?(o(),y(p,{key:0,"ticket-list":e.userNotificationData.data.user.recent_tickets,"on-ticket-click":a.onTicketClick},null,8,["ticket-list","on-ticket-click"])):c("",!0)])]),e.linkedTicketObj&&e.isUserActive?(o(),l("div",mt,[i("small",null,[v(u(e.lang("linked_ticket"))+": #",1),i("a",{href:e.basePath()+"/thread/"+e.linkedTicketObj.id,target:"_blank"},u(e.linkedTicketObj.ticket_number),9,ht),e.showUnlinkBtn?(o(),l("i",{key:0,class:"fa fa-times ticket-unlink-btn pointer-cursor",title:"remove_linked_ticket",onClick:t[1]||(t[1]=h=>a.unLinkTicket())})):c("",!0)])])):c("",!0),e.userNotificationData.status==="ended"&&e.isUserActive?(o(),l("div",_t,[w(i("textarea",{id:"telephone-alert-internal-note",class:"form-control",style:{resize:"none"},"onUpdate:modelValue":t[2]||(t[2]=h=>e.internalNote=h),placeholder:"Add internal note"},null,512),[[H,e.internalNote]])])):c("",!0),e.userNotificationData.status==="ended"&&e.isUserActive?(o(),l("div",ft,[i("button",{class:"btn btn-primary btn-sm",disabled:e.loading,onClick:t[3]||(t[3]=h=>a.onSubmit())},u(e.loading?e.lang("submitting"):e.lang("submit")),9,gt)])):c("",!0)])])}const kt=k(xe,[["render",yt],["__scopeId","data-v-6e0c0c68"]]);const bt={name:"telephone-alert",setup(){const e=P();return{getItems:O(()=>e.getters.getItems)}},data:()=>({}),props:{user:{type:Number,required:!0}},mounted(){window.Echo.channel("user-notifications").listen(".call-started",e=>{this.addUpdateItem(e,"started")}).listen(".call-ended",e=>{this.addUpdateItem(e,"ended")})},methods:{onMouseEnter(e){e.timer.canPauseResume&&e.timer.canUserStopTimer&&e.timer.pause()},onMouseLeave(e){e.timer.canPauseResume&&e.timer.canUserStopTimer&&e.timer.resume()},addUpdateItem(e,t){if(this.isDuplicate(e.call_id,t))return;let s={id:e.call_id,data:e,status:t};s.timer=new R(()=>this.distoryItem(s),15,!0),this.$store.dispatch("addUpdateElement",s)},isDuplicate(e,t){const s=this.getItems.find(r=>r.id===e);return typeof s>"u"?!1:s.status===t},distoryItem(e){this.$store.dispatch("removeElement",e)}},beforeDestroy(){this.$store.dispatch("clearAll")},components:{"call-popup":kt}},vt={id:"telephone-alert-box__position"},wt=["onMouseenter","onMouseleave"];function Tt(e,t,s,r,n,a){const d=m("call-popup");return o(),l("div",vt,[_(J,{name:"slide-fade"},{default:f(()=>[r.getItems.length>0?(o(!0),l(j,{key:0},L(r.getItems,p=>(o(),l("div",{id:"telephone-alert-box",key:p.id,onMouseenter:h=>a.onMouseEnter(p),onMouseleave:h=>a.onMouseLeave(p)},[(o(),y(d,{key:p.id,"call-data":p},null,8,["call-data"]))],40,wt))),128)):c("",!0)]),_:1})])}const Ct=k(bt,[["render",Tt],["__scopeId","data-v-72828e26"]]);B.registerModule("callStore",ie);let Dt={path:"/telephony",component:Q,name:"Telephony",redirect:"/telephony/settings",children:[{path:"settings",component:Be,name:"Telephony Settings",meta:{title:"telephony",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"plugins",to:"/plugins"},active:"telephone-integration"}}}]};Z.addRoute(Dt);const N=W({components:{TelephoneAlert:Ct}});N.use(B);N.mixin(X);N.mount("#telephony-settings");
