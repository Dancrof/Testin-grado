import{_ as D,e as c,Z as I,$ as N,c as T,B as S,E as A,a0 as R,m as F,G as V,a1 as j,q as f,k as x,W as G,o as r,v as a,x as y,L as _,l as d,K as O,t as h,J as P,F as J,H as K,I as L,C as W,a2 as Z}from"./bootstrap.js";const Q={class:"modal-wrapper"},U={class:"modal-container"},X={class:"modal-header"},Y={class:"modal-title"},ee={class:"header-buttons ms-auto"},te={key:0,type:"button",class:"border-0 bg-white dropdown-toggle","data-bs-toggle":"dropdown"},ae={class:"dropdown-menu translate-menu dropdown-menu-end"},se=["onClick"],ne={class:"summary-text"},oe={key:0},le={class:"text-center mt-2"},re=["innerHTML"],ie={key:0,class:"modal-footer"},de={__name:"EleaTicketThreadSummary",props:{data:{type:String,required:!0},showModal:{type:Boolean,required:!0},onClose:{type:Function},ticketId:{type:Number,required:!0},translate:{type:String,required:!0}},setup(M){const u=M,k=c(!1),s=c(!1),m=c(""),b=c([]);c(!1);const p=I(),w=c(""),v=c(!1);N(()=>{B(u.data,u.translate),w.value=u.translate?"translated_ticket_thread":"summarized_ticket_thread"});const E=T(()=>p.getters.isSettingActive),z=T(()=>p.getters.hasOwnProperty("isSettingActive")),B=(t,e)=>{k.value=!0,s.value=!0,$();const o={summarize:"ticket_thread",message:t};e?C(t,e):S.post("elea-assistant/ticket/summarize",o).then(n=>{s.value=!1,m.value=n.data.data}).catch(n=>{s.value=!1,g(),A(n,"layout")})},H=()=>{s.value=!0;const t={content:m.value,ticket_id:u.ticketId,is_internal_note:!0};S.post(`api/thread/reply/${u.ticketId}`,t).then(e=>{s.value=!1,g(),W(e,"timeline"),window.emitter.emit("refreshTableAndData",!0),window.emitter.emit("actionDone","note")}).catch(e=>{s.value=!1,A(e,"timeline")})},$=async()=>{let t=null;p&&p.getters&&(t=await p.getters.isLanguageList),t&&(b.value=t.filter(e=>e.language!=="auto"))},C=async(t,e)=>{setTimeout(async()=>{s.value=!0;const o=await R(t,e,"thread");if(s.value=!1,o==="translation-failed")s.value=!1,g();else{const l=new DOMParser().parseFromString(o,"text/html");l.querySelectorAll('a[title="mention_link"]').forEach(i=>{(i.href.includes("department")||i.href.includes("team"))&&(i.href=i.href.replace(/(department|team)/,"admin/$1")),i.setAttribute("title",i.textContent)}),m.value=l.body.innerHTML}},1)},q=()=>{const t=m.value,e=document.createElement("div");e.innerHTML=t,document.body.appendChild(e);const o=document.createRange();o.selectNodeContents(e);const n=window.getSelection();n.removeAllRanges(),n.addRange(o),document.execCommand("copy"),n.removeAllRanges(),document.body.removeChild(e),v.value=!0,setTimeout(()=>{v.value=!1},5e3),p.dispatch("setAlert",{type:"success",message:Z("content-copied-clipboard"),component_name:"timeline"}),g()},g=()=>{u.onClose()};return(t,e)=>{const o=x("loader"),n=G("tooltip");return k.value?(r(),F(j,{key:0,name:"modal"},{default:V(()=>[a("div",{class:h(["modal-mask summary-modal",{rtl:t.appLanguage==="ar"}])},[a("div",Q,[a("div",U,[a("div",X,[a("h4",Y,y(t.trans(w.value)),1),a("div",ee,[z.value&&E.value("translate_ticket_content_key")&&!s.value?_((r(),d("button",te,e[3]||(e[3]=[a("i",{class:"fas fa-language"},null,-1)]))),[[n,{content:t.trans("translate"),placement:"left"}]]):f("",!0),a("div",ae,[(r(!0),d(P,null,O(b.value,(l,i)=>(r(),d("a",{key:l.language,class:h(["dropdown-item",{"lang-highlight":i===0}]),href:"javascript:;",onClick:ce=>C(m.value,l.language)}," Â  "+y(l.name),11,se))),128))]),_(a("button",{class:h([{left:t.appLanguage==="ar"},"btn-close"]),type:"button",onClick:e[0]||(e[0]=l=>g())},null,2),[[n,t.trans("close")]])])]),a("div",ne,[s.value?(r(),d("div",oe,[J(o,{"animation-duration":4e3,size:60}),e[4]||(e[4]=a("br",null,null,-1)),a("p",le,[a("b",null,y(t.trans("generating"))+"...",1)])])):f("",!0),s.value?f("",!0):(r(),d("div",{key:1,innerHTML:m.value},null,8,re))]),s.value?f("",!0):(r(),d("div",ie,[_((r(),d("button",{class:"btn btn-light",onClick:e[1]||(e[1]=K(l=>q(),["prevent"]))},[a("span",{class:h(v.value?"fas fa-check text-green":"fa fa-clipboard"),id:"eye"},null,2),L(" "+y(v.value?t.trans("clipboard-copy-message"):t.trans("copy")),1)])),[[n,v.value?t.trans("clipboard-copy-message"):t.trans("click-to-copy")]]),_((r(),d("button",{type:"button",class:"btn btn-light",onClick:e[2]||(e[2]=l=>H())},[e[5]||(e[5]=a("i",{class:"fas fa-arrow-up-from-bracket"},null,-1)),L(" "+y(t.trans("insert")),1)])),[[n,t.trans("insert_as_internal_note")]])]))])])],2)]),_:1})):f("",!0)}}},me=D(de,[["__scopeId","data-v-9fb55c11"]]);export{me as E};
