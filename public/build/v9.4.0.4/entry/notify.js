import{_ as V,B as L,C as T,E as M,k as d,W as I,o as n,l as i,F as h,v as s,x as m,J as k,K as S,L as C,m as $,G as y,t as D,ad as E,a2 as q,s as N,D as O,T as j,q as b,I as w,Z as z,c as G,aq as J,a1 as x,ah as F,A as R,ae as W}from"../chunks/bootstrap.js";import{r as B,A as Z}from"../chunks/adminRouter.js";import{a as Q}from"../chunks/DataTableActions.js";import{C as P}from"../chunks/Checkbox.js";import{S as X}from"../chunks/FormGenerator.js";import"../chunks/vue-router.js";import"../chunks/HelpSection.js";import"../chunks/AdminNavigationBar.js";const Y={name:"template-index",data(){return{channels:null,pageLoad:!0,plugin:null}},beforeMount(){this.plugin=new URL(location.href).searchParams.get("plugin"),this.getNotificationChannels()},methods:{getNotificationChannels(){L.get("notify/api/notification-channels").then(e=>{this.pageLoad=!1,this.channels=e.data.data,T(e,"template-index")}).catch(e=>{this.pageLoad=!1,M(e,"template-index")})}}},ee={class:"col-sm-12"},te={key:0,class:"card card-light"},ae={class:"card-header"},se={class:"card-title"},ne={class:"card-body"},le={class:"row"},oe={class:"col-md-2 col-sm-6"},ie={class:"settingiconblue"},re={class:"settingdivblue"},de={class:"fa-stack fa-2x"},ce={class:"text-center text-sm fw_400"},me={key:1,class:"row"};function he(e,t,r,o,a,l){const u=d("alert"),f=d("router-link"),g=d("custom-loader"),v=I("tooltip");return n(),i("div",ee,[h(u,{componentName:"template-index"}),a.pageLoad?(n(),i("div",me,[h(g,{duration:4e3})])):(n(),i("div",te,[s("div",ae,[s("h3",se,m(e.trans("notifications-channels")),1)]),s("div",ne,[s("div",le,[(n(!0),i(k,null,S(a.channels,c=>(n(),i("div",oe,[s("div",ie,[s("div",re,[C((n(),$(f,{to:"/notify/manage/channels/"+c.channel+"/template-sets"+(a.plugin?"?plugin="+a.plugin:"")},{default:y(()=>[s("span",de,[s("i",{class:D([c.icon,"fa-stack-1x"])},null,2)])]),_:2},1032,["to"])),[[v,e.trans(c.desc_lang_key)]])]),s("div",ce,m(e.trans(c.channel)),1)])]))),256))])])]))])}const pe=V(Y,[["render",he],["__scopeId","data-v-17809ed4"]]);function K(e){const{name:t,template_language:r,parent_template_set:o}=e;let a={name:[t,"isRequired"],template_language:[r,"isRequired"],parent_template_set:[o,"isRequired"]};const l=new E(q),{errors:u,isValid:f}=l.validate(a);return N.dispatch("setValidationError",u),{errors:u,isValid:f}}const ue={name:"template-set-create-modal",data(){return{isLoading:!1,name:"",template_language:[],department_id:[],parent_template_set:[],containerStyle:{width:"800px"}}},props:{showModal:{type:Boolean,default:!1},onClose:{type:Function},apiUrl:{type:String},languages:{type:Array,required:!0,default:()=>[]}},methods:{onChange(e,t){this[t]=e||""},onSubmit(){if(this.isValidInputs()){let e={name:this.name,parent_template_set:this.parent_template_set.id,department_id:this.department_id?this.department_id.id:null,template_language:this.template_language.value};this.isLoading=!0,L.post("notify/api/template-sets/create",e).then(t=>{this.isLoading=!1,this.onClose(),T(t,"template-set-list-index"),window.emitter.emit("refreshData")}).catch(t=>{M(t,"template-set-create-modal"),this.isLoading=!1})}},isValidInputs(){const{errors:e,isValid:t}=K(this.$data);return t}},components:{"dynamic-select":O,"text-field":j}},_e={class:"modal-title"},ge={key:0},fe={class:"row"},be={class:"row"},ve={key:1,class:"row"};function ye(e,t,r,o,a,l){const u=d("alert"),f=d("text-field"),g=d("dynamic-select"),v=d("reuse-loader"),c=d("modal"),_=I("focus-first-input");return n(),i("div",null,[r.showModal?(n(),$(c,{key:0,showModal:!0,onClose:r.onClose,containerStyle:a.containerStyle},{title:y(()=>[s("h4",_e,m(e.trans("clone_language_set")),1)]),alert:y(()=>[h(u,{componentName:"template-set-create-modal"})]),fields:y(()=>[a.isLoading?b("",!0):(n(),i("div",ge,[C((n(),i("div",fe,[h(f,{label:e.lang("name"),value:a.name,type:"text",name:"name",onChange:l.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0},null,8,["label","value","onChange","placehold"]),h(g,{id:"parent_template_set",name:"parent_template_set",classname:"col-sm-6",apiEndpoint:r.apiUrl,label:e.lang("template_set_to_clone"),hint:e.lang("select_template_set_to_clone"),required:!0,multiple:!1,value:a.parent_template_set,onChange:l.onChange},null,8,["apiEndpoint","label","hint","value","onChange"])])),[[_]]),s("div",be,[h(g,{id:"department_id",name:"department_id",classname:"col-sm-6",apiEndpoint:"/api/dependency/departments",label:e.lang("department"),hint:e.lang("select_template_department"),value:a.department_id,multiple:!1,onChange:l.onChange},null,8,["label","hint","value","onChange"]),h(g,{id:"template_language",name:"template_language",classname:"col-sm-6",elements:r.languages,label:e.lang("template_language"),required:!0,hint:e.lang("select_language_for_cloned_template"),multiple:!1,value:a.template_language,onChange:l.onChange},null,8,["elements","label","hint","value","onChange"])])])),a.isLoading?(n(),i("div",ve,[h(v,{"animation-duration":4e3,color:"#1d78ff"})])):b("",!0)]),controls:y(()=>[s("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...p)=>l.onSubmit&&l.onSubmit(...p))},[t[1]||(t[1]=s("i",{class:"fas fa-save"}," ",-1)),w(m(e.lang("submit")),1)])]),_:1},8,["onClose","containerStyle"])):b("",!0)])}const Ce=V(ue,[["render",ye]]),we={name:"template-translation-set-create-modal",data(){return{isLoading:!1,name:"",template_language:[],department_id:[],containerStyle:{width:"800px"}}},props:{showTranslateModal:{type:Boolean,default:!1},onClose:{type:Function},languages:{type:Array,required:!0,default:()=>[]}},methods:{onChange(e,t){this[t]=e||""},onSubmit(){if(this.isValidInputs()){let e=new URL(location.href),t=e.pathname.substring(0,e.pathname.lastIndexOf("/")),r=t.substring(t.lastIndexOf("/")+1),o={name:this.name,channel_name:r,department_id:this.department_id?this.department_id.id:null,template_language:this.template_language.value};this.isLoading=!0,L.post("notify/api/template-sets/create_translate",o).then(a=>{this.isLoading=!1,this.onClose(),T(a,"template-set-list-index"),window.emitter.emit("refreshData")}).catch(a=>{M(a,"template-translation-set-create-modal"),this.isLoading=!1})}},isValidInputs(){const{errors:e,isValid:t}=K(this.$data);return t}},components:{"dynamic-select":O,"text-field":j}},ke={class:"modal-title"},Le={key:0},Ae={class:"row"},Se={class:"row"},Te={key:1,class:"row"};function Me(e,t,r,o,a,l){const u=d("alert"),f=d("text-field"),g=d("dynamic-select"),v=d("reuse-loader"),c=d("modal"),_=I("focus-first-input");return n(),i("div",null,[r.showTranslateModal?(n(),$(c,{key:0,"show-modal":r.showTranslateModal,onClose:r.onClose,containerStyle:a.containerStyle},{title:y(()=>[s("h4",ke,m(e.lang("create_translated_set")),1)]),alert:y(()=>[h(u,{componentName:"template-translation-set-create-modal"})]),fields:y(()=>[a.isLoading?b("",!0):(n(),i("div",Le,[C((n(),i("div",Ae,[h(f,{label:e.lang("name"),value:a.name,type:"text",name:"name",onChange:l.onChange,classname:"col-sm-6",required:!0},null,8,["label","value","onChange"]),h(g,{id:"template_language",name:"template_language",classname:"col-sm-6",elements:r.languages,label:e.lang("template_language"),required:!0,multiple:!1,value:a.template_language,onChange:l.onChange},null,8,["elements","label","value","onChange"])])),[[_]]),s("div",Se,[h(g,{id:"department_id",name:"department_id",classname:"col-sm-6",apiEndpoint:"/api/dependency/departments",label:e.lang("department"),hint:e.lang("select_template_department"),value:a.department_id,multiple:!1,onChange:l.onChange},null,8,["label","hint","value","onChange"])])])),a.isLoading?(n(),i("div",Te,[h(v,{"animation-duration":4e3,color:"#1d78ff"})])):b("",!0)]),controls:y(()=>[s("button",{type:"button",class:"btn btn-primary",onClick:t[0]||(t[0]=(...p)=>l.onSubmit&&l.onSubmit(...p))},[t[1]||(t[1]=s("i",{class:"fas fa-save"}," ",-1)),w(m(e.lang("submit")),1)])]),_:1},8,["show-modal","onClose","containerStyle"])):b("",!0)])}const $e=V(we,[["render",Me]]);const De={name:"template-set-list-index",setup(){const e=z();return{formattedTime:G(()=>e.getters.formattedTime)}},data(){return{apiUrl:"notify/api/template-sets",plugin:null,channel:null,columns:["name","active","template_language","department","actions"],showModal:!1,showTranslateModal:!1,languages:[],options:{},showDrop:!1}},beforeMount(){const e=this;let t=new URL(location.href);this.plugin=t.searchParams.get("plugin");let r=t.pathname.substring(0,t.pathname.lastIndexOf("/"));this.channel=r.substring(r.lastIndexOf("/")+1),this.apiUrl=this.apiUrl+"?channel="+this.channel,this.getLanguagesMenu(),this.options={sortIcon:{base:"glyphicon",down:"glyphicon-chevron-up",up:"glyphicon-chevron-down"},headings:{name:this.trans("name"),active:this.trans("status"),template_language:this.trans("language_code"),department:this.trans("department"),actions:this.trans("actions")},columnsClasses:{name:"template-list-name",active:"template-list-active",template_language:"template-list-language",department:"template-list-department",actions:"template-list-actions"},texts:{filter:"",limit:""},templates:{active:function(o,a){let l=e.h("span",{class:a.active?"btn btn-success btn-sm pointer_normal":"btn btn-danger btn-sm pointer_normal"},a.active?"Active":"Inactive");return e.h("a",{class:"pointer_normal"},[l])},department(o,a){return a.department?a.department.name:"--"},actions:(o,a)=>e.h(Q,{data:a})},sortable:["name","active","template_language"],filterable:["name","template_language"],pagination:{chunk:5,nav:"fixed",edge:!0},requestAdapter(o){return{"sort-field":o.orderBy?o.orderBy:"id","sort-order":o.ascending?"desc":"asc","search-query":o.query.trim(),page:o.page,limit:o.limit}},responseAdapter({data:o}){return{data:o.data.data.map(a=>(a.status_toggle_url=e.basePath()+"/notify/api/template-sets/change-status/"+a.id,a.view_url="/notify/manage/channels/"+e.channel+"/template-sets/"+a.id+"/templates"+(e.plugin?"?plugin="+e.plugin:""),a.delete_url=e.basePath()+"/notify/api/delete-template-sets/"+a.id,a.active_status=a.active,a.alertComponentName="template-set-list-index",a)),count:o.data.total}},orderBy:{column:"id",ascending:!0}},setTimeout(()=>{this.showDrop=!0},1e3)},methods:{toggleModal(){this.showModal=!this.showModal},toggleTranslateModal(){this.showTranslateModal=!this.showTranslateModal},onClose(){this.showModal=!1,this.showTranslateModal=!1},getLanguagesMenu(){L.get("api/dependency/languages?meta=true").then(e=>{this.languages=e.data.data.languages.map(function(t,r){return{name:t.name+" ("+t.translation+")",value:t.locale}})}).catch(e=>{})}},components:{"template-translation-set-create-modal":$e,"template-set-create-modal":Ce}},Ve={class:"col-sm-12"},Ie={class:"card card-light"},Ue={class:"card-header"},qe={id:"template-set-index",class:"card-title"},Ee={class:"card-tools"},Ne={class:"dropdown-menu dropdown-menu-right",role:"menu"},je={class:"card-body",id:"template-set-list"};function Fe(e,t,r,o,a,l){const u=d("alert"),f=d("data-table"),g=d("template-set-create-modal"),v=d("template-translation-set-create-modal"),c=I("tooltip");return n(),i("div",Ve,[h(u,{componentName:"template-set-list-index"}),s("div",Ie,[s("div",Ue,[s("h3",qe,m(e.trans("list_of_templates_sets")),1),s("div",Ee,[t[5]||(t[5]=s("a",{href:"javascript:;",class:"btn-tool dropdown-toggle","data-bs-toggle":"dropdown"},[s("i",{class:"glyphicon glyphicon-plus"})],-1)),C(s("div",Ne,[C((n(),i("a",{class:"dropdown-item pointer-cursor",onClick:t[0]||(t[0]=(..._)=>l.toggleModal&&l.toggleModal(..._))},[t[2]||(t[2]=s("i",{class:"glyphicon glyphicon-plus"},null,-1)),w(" "+m(e.trans("clone_language_set")),1)])),[[c,e.trans("clone_language_set")]]),t[4]||(t[4]=s("hr",{class:"m-0"},null,-1)),C((n(),i("a",{class:"dropdown-item pointer-cursor",onClick:t[1]||(t[1]=(..._)=>l.toggleTranslateModal&&l.toggleTranslateModal(..._))},[t[3]||(t[3]=s("i",{class:"fas fa-language"},null,-1)),w(" "+m(e.trans("create_translated_set")),1)])),[[c,e.trans("create_translated_set")]])],512),[[J,a.showDrop]])])]),s("div",je,[h(f,{url:a.apiUrl,dataColumns:a.columns,option:a.options,scroll_to:"template-set-index"},null,8,["url","dataColumns","option"])])]),h(x,{name:"modal"},{default:y(()=>[a.showModal?(n(),$(g,{key:0,showModal:a.showModal,onClose:l.onClose,languages:a.languages,apiUrl:a.apiUrl},null,8,["showModal","onClose","languages","apiUrl"])):b("",!0)]),_:1}),h(x,{name:"modal"},{default:y(()=>[a.showTranslateModal?(n(),$(v,{key:0,showTranslateModal:a.showTranslateModal,onClose:l.onClose,languages:a.languages,apiUrl:a.apiUrl},null,8,["showTranslateModal","onClose","languages","apiUrl"])):b("",!0)]),_:1})])}const Re=V(De,[["render",Fe],["__scopeId","data-v-801e495d"]]),xe={name:"templates-list-index",data(){return{plugin:null,id:null,channel:"",pageLoadnig:!0,list:[]}},beforeMount(){let e=new URL(location.href);this.plugin=e.searchParams.get("plugin"),this.id=F(window.location.pathname),this.channel=location.href.substring(location.href.indexOf("channels/")+9,location.href.indexOf("/template-sets")),this.getTemplatesList()},methods:{getTemplatesList(){let e="notify/api/templates?set_id="+this.id+(this.plugin?"&plugin="+this.plugin:"");L.get(e).then(t=>{this.list=t.data.data,this.pageLoadnig=!1,T(t,"template-edit")}).catch(t=>{this.pageLoadnig=!1,M(t,"template-edit")})}},components:{"tool-tip":R}},Oe={class:"col-sm-12"},Be={key:0,class:"card card-light"},Pe={class:"card-header"},Ke={class:"card-title"},He={key:0,class:"card-body"},ze={key:1,class:"card-body"},Ge={class:"nav nav-tabs",id:"custom-content-below-tab",role:"tablist"},Je={class:D(["nav-item"])},We=["id","href","aria-controls"],Ze={class:"tab-content",id:"custom-content-below-tabContent"},Qe=["id","aria-labelledby"],Xe={class:"table table-bordered table-condensed"},Ye={style:{width:"20%"}},et={style:{width:"70%"}},tt={style:{width:"10%"}},at={style:{width:"20%"}},st={style:{width:"70%"}},nt={style:{width:"10%"}},lt={key:1,class:"row"};function ot(e,t,r,o,a,l){const u=d("alert"),f=d("center"),g=d("router-link"),v=d("custom-loader"),c=I("tooltip");return n(),i("div",Oe,[h(u,{componentName:"templates-list-index"}),a.pageLoadnig?(n(),i("div",lt,[h(v,{duration:4e3})])):(n(),i("div",Be,[s("div",Pe,[s("h3",Ke,m(e.trans("templates")),1)]),a.list.length==0?(n(),i("div",He,[h(f,null,{default:y(()=>[s("p",null,m(e.trans("no_data_found")),1)]),_:1})])):(n(),i("div",ze,[s("ul",Ge,[(n(!0),i(k,null,S(a.list,(_,p,A)=>(n(),i("li",Je,[C((n(),i("a",{class:D(["nav-link",A===0?"active":""]),id:p+"-tab","data-bs-toggle":"pill",href:"#"+p,role:"tab","aria-controls":p,"aria-selected":"true"},[w(m(e.trans(p+"_lang_key")),1)],10,We)),[[c,e.trans(p+"_desc_key")]])]))),256))]),s("div",Ze,[(n(!0),i(k,null,S(a.list,(_,p,A)=>(n(),i("div",{class:D(["tab-pane","fade",A===0?"active show":""]),id:p,role:"tabpanel","aria-labelledby":p},[s("table",Xe,[s("thead",null,[s("tr",null,[s("th",Ye,m(e.trans("name")),1),s("th",et,m(e.trans("description")),1),s("th",tt,m(e.trans("actions")),1)])]),s("tbody",null,[(n(!0),i(k,null,S(_,U=>(n(),i("tr",null,[s("td",at,m(e.trans(U.template)),1),s("td",st,m(e.trans(U.desc_lang_key)),1),s("td",nt,[C((n(),$(g,{class:"btn btn-primary",to:"/notify/manage/channels/"+a.channel+"/template-sets/"+a.id+"/templates/"+U.templates[0].id},{default:y(()=>t[0]||(t[0]=[s("i",{class:"fas fa-edit"},null,-1)])),_:2},1032,["to"])),[[c,e.trans("edit")]])])]))),256))])])],10,Qe))),256))])]))]))])}const it=V(xe,[["render",ot]]);function rt(e){const{subject:t,content:r}=e;let o={subject:[t,"isRequired"],content:[r,"isRequired"]};const a=new E(q),{errors:l,isValid:u}=a.validate(o);return N.dispatch("setValidationError",l),{errors:l,isValid:u}}const dt={name:"template-edit",data(){return{template:null,id:null,showsubject:!1,isDisabled:!1,loading:!1,variable:!1,name:"",content:"",subject:"",cardCollapsed:!1,hiddenKeys:["{!! $ticket_title !!}"]}},beforeMount(){this.id=F(window.location.pathname),this.getTemplateDetails()},methods:{getTemplateDetails(){this.toggleLoaders(!0),L.get("/notify/api/get-template/"+this.id).then(e=>{this.template=e.data.data,this.showsubject=this.template.variable==1,this.name=this.template.name,this.subject=this.template.subject,this.content=this.template.content,this.variable=this.template.variable==1,this.toggleLoaders(!1),T(e,"template-edit")}).catch(e=>{this.toggleLoaders(!1),M(e,"template-edit")})},onChange(e,t){this[t]=e},submit(){if(this.isValidInputs()){this.toggleLoaders(!0);let e={subject:this.subject,variable:this.variable,content:this.content};L.patch("notify/api/update-template/"+this.id,e).then(t=>{this.toggleLoaders(!1),T(t,"template-edit")}).catch(t=>{this.toggleLoaders(!1),M(t,"template-edit")})}},toggleLoaders(e){this.loading=e,this.isDisabled=e},isValidInputs(){const{errors:e,isValid:t}=rt(this.$data);return t},collapseCard(){this.cardCollapsed=!this.cardCollapsed}},components:{"text-field":j,"tool-tip":R}},ct={class:"col-sm-12"},mt={class:"card card-light"},ht={key:0,class:"card-header"},pt={class:"card-title"},ut={class:"card-body"},_t={key:0,class:"row"},gt={class:"col-md-12"},ft={class:"lead"},bt={class:"row"},vt={class:"col-md-12"},yt={class:"card-header"},Ct={class:"card-title"},wt={class:"card-tools"},kt={class:"card-body col-md-12"},Lt={class:"alert alert-info alert-dismissable"},At={key:0,class:"list-inline"},St={key:0,class:"list-inline-item",style:{width:"23%"}},Tt={"data-placement":"right"},Mt={class:"row"},$t={class:"col-md-12 form-group"},Dt={class:"card-footer"},Vt=["disabled"];function It(e,t,r,o,a,l){const u=d("alert"),f=d("custom-loader"),g=d("text-field"),v=d("tiny-editor-with-validation"),c=I("tooltip");return n(),i("div",ct,[h(u,{componentName:"template-edit"}),a.loading?(n(),$(f,{key:0})):b("",!0),s("div",mt,[a.template?(n(),i("div",ht,[s("h3",pt,m(e.trans(a.name)),1)])):b("",!0),s("div",ut,[a.template?(n(),i("div",_t,[s("div",gt,[s("p",ft,m(e.trans(a.template.template_name)),1)])])):b("",!0),s("div",bt,[s("div",vt,[s("div",{class:D(["card card-light",{"collapsed-card":a.cardCollapsed}])},[s("div",yt,[s("h3",Ct,m(e.trans("list-of-available-shot-codes")),1),s("div",wt,[C((n(),i("button",{class:"btn btn-tool","data-lte-toggle":"card-collapse",onClick:t[0]||(t[0]=(..._)=>l.collapseCard&&l.collapseCard(..._)),"data-bs-toggle":"tooltip"},[s("i",{class:D(a.cardCollapsed?"fas fa-plus":"fas fa-minus")},null,2)])),[[c,e.trans("collapse-list")]])])]),s("div",kt,[s("div",Lt,[t[2]||(t[2]=s("i",{class:"fas fa-info-circle"},null,-1)),t[3]||(t[3]=w("  ")),s("span",null,m(e.trans("template-short-code-tips")),1),t[4]||(t[4]=s("button",{type:"button",class:"btn-close float-end","data-bs-dismiss":"alert","aria-label":"Close"},null,-1))]),s("div",null,[a.template?(n(),i("ul",At,[(n(!0),i(k,null,S(a.template.shortCodes,(_,p)=>(n(),i(k,null,[a.hiddenKeys.includes(p)?b("",!0):(n(),i("li",St,[C((n(),i("span",Tt,[w(m(p),1)])),[[c,e.trans(_),void 0,{right:!0}]])]))],64))),256))])):b("",!0)])])],2)])]),s("div",Mt,[s("div",$t,[a.showsubject?(n(),$(g,{key:0,autofocus:!0,label:e.trans("subject"),value:a.subject,type:"text",name:"subject",onChange:l.onChange,placehold:e.lang("enter_a_value"),classname:"col-sm-6",required:!0},null,8,["label","value","onChange","placehold"])):b("",!0),h(v,{value:a.content,id:"template-edit-editor",type:"text",onChange:l.onChange,name:"content",label:e.trans("content"),required:!0,classname:"col-sm-12 width55",lang:"en",convertURLs:!1},null,8,["value","onChange","label"])])])]),s("div",Dt,[s("button",{type:"button",id:"submitter",onClick:t[1]||(t[1]=(..._)=>l.submit&&l.submit(..._)),class:"btn btn-primary",disabled:a.isDisabled},[t[5]||(t[5]=s("i",{class:"fas fa-save","aria-hidden":"true"},null,-1)),w(" "+m(e.trans("update")),1)],8,Vt)])])])}const Ut=V(dt,[["render",It]]);const qt={name:"alert-settings",data(){return{isDisabled:!1,loading:!1,alerts:null,setAlerts:null}},beforeMount(){this.id=F(window.location.pathname),this.getAlerts()},methods:{checkAlertIsSet(e,t=0){for(let r=0;r<e.length;r++){let o=this.setAlerts[e[r].associate_id].join();if(o.includes(t))return!0;if(o!=""&&!t)return!0}return!1},onChange(e,t){e?this.enableAllChannelsForAlert(t):this.toggleAllChannelsForAlert(t,!0)},enableAllChannelsForAlert(e){for(var t=0;t<this.alerts[e].associates.length;t++)if(this.setAlerts[this.alerts[e].associates[t].associate_id].length>0)return!1;this.toggleAllChannelsForAlert(e,!1)},toggleAllChannelsForAlert(e,t){this.alerts[e].allowedChannels.forEach(r=>{this.toggleChannelForAlert(t,this.alerts[e].associates,r.id)})},toggleChannelForAlert(e,t,r){t.forEach(o=>{this.toggleChannel(e,o.associate_id,r)})},toggleChannel(e,t,r){let o=this.setAlerts[t].indexOf(r);o>-1&&this.setAlerts[t].splice(o,1),e||this.setAlerts[t].push(r)},toggleLoaders(e){this.loading=e,this.isDisabled=e},updateSetAlerts(){let e={};for(const[t,r]of Object.entries(this.alerts))r.associates.forEach(function(o){let a=[],l=o.associate_id;o.channels.length>0&&(a=o.channels),e[l]=a});this.setAlerts=e},getAlerts(){this.toggleLoaders(!0),L.get("/notify/api/base-alerts").then(e=>{this.alerts=e.data.data,this.updateSetAlerts(),this.toggleLoaders(!1),T(e,"alert-settings")}).catch(e=>{this.toggleLoaders(!1),M(e,"alert-settings")})},formatAlertFormData(){let e=[];for(const[t,r]of Object.entries(this.setAlerts)){let o={};o.associate=t,o.channels=[],r.forEach(function(a,l){o.channels[l]={channel_id:a}}),e.push(o)}return e},submit(){this.toggleLoaders(!0);let e={alerts:this.formatAlertFormData()};L.patch("notify/api/base-alerts",e).then(t=>{this.toggleLoaders(!1),T(t,"alert-settings")}).catch(t=>{this.toggleLoaders(!1),M(t,"alert-settings")})}},components:{checkbox:P,"tool-tip":R,"status-switch":X}},Et={class:"col-sm-12"},Nt={key:1,class:"card card-light"},jt={class:"card-header"},Ft={class:"card-title"},Rt={class:"card-body"},xt={class:"row"},Ot={class:"col-md-12 form-group"},Bt={class:"table table-sm",style:{"text-align":"center"}},Pt={class:"align-middle"},Kt={style:{"vertical-align":"middle",width:"5%"}},Ht={style:{"vertical-align":"middle",width:"10%"}},zt={class:"table table-borderless table-sm"},Gt={style:{"vertical-align":"middle"}},Jt=["onClick"],Wt={style:{"vertical-align":"middle","text-align":"left"}},Zt={class:"alert-tooltip"},Qt={class:"table table-borderless table-sm"},Xt={style:{"width=":"100%"}},Yt={style:{"text-align":"right"}},ea={style:{width:"5%","text-align":"left"}},ta=["onClick"],aa={slot:"actions",class:"card-footer"},sa=["disabled"];function na(e,t,r,o,a,l){const u=d("alert"),f=d("custom-loader"),g=d("status-switch"),v=I("tooltip");return n(),i("div",Et,[h(u,{componentName:"alert-settings"}),a.loading?(n(),$(f,{key:0})):b("",!0),a.alerts?(n(),i("div",Nt,[s("div",jt,[s("h3",Ft,m(e.trans("alerts")),1)]),s("div",Rt,[s("div",xt,[s("div",Ot,[s("table",Bt,[s("tbody",null,[(n(!0),i(k,null,S(a.alerts,(c,_)=>(n(),i("tr",Pt,[s("td",Kt,[h(g,{name:_,value:l.checkAlertIsSet(c.associates),classname:"btn-tool",onChange:l.onChange},null,8,["name","value","onChange"])]),s("td",Ht,[s("table",zt,[(n(!0),i(k,null,S(c.allowedChannels,p=>(n(),i("tr",null,[s("td",Gt,[s("i",{class:D([p.icon,l.checkAlertIsSet(c.associates,p.id)?"active":"inactive"]),style:{"pointer-events":"initial",cursor:"pointer"},onClick:A=>l.toggleChannelForAlert(l.checkAlertIsSet(c.associates,p.id),c.associates,p.id)},null,10,Jt)])]))),256))])]),s("td",Wt,[w(m(e.trans(c.name))+" ",1),C((n(),i("span",Zt,t[1]||(t[1]=[s("i",{class:"fas fa-info-circle"},null,-1)]))),[[v,e.trans(c.description)]])]),s("td",null,[s("table",Qt,[(n(!0),i(k,null,S(c.associates,p=>(n(),i("tr",Xt,[s("td",Yt,[C((n(),i("span",null,[w(m(e.trans(p.name)),1)])),[[v,e.trans(p.description)]])]),(n(!0),i(k,null,S(c.allowedChannels,A=>(n(),i("td",ea,[s("i",{class:D([A.icon,a.setAlerts[p.associate_id].includes(A.id)?"active":"inactive"]),"aria-hidden":"true",onClick:U=>l.toggleChannel(a.setAlerts[p.associate_id].includes(A.id),p.associate_id,A.id),style:{"pointer-events":"initial",cursor:"pointer"}},null,10,ta)]))),256))]))),256))])])]))),256))])])])])]),s("div",aa,[s("button",{type:"button",id:"submitter",onClick:t[0]||(t[0]=(...c)=>l.submit&&l.submit(...c)),class:"btn btn-primary",disabled:a.isDisabled},[t[2]||(t[2]=s("i",{class:"fas fa-save","aria-hidden":"true"},null,-1)),w(" "+m(e.trans("submit")),1)],8,sa)])])):b("",!0)])}const la=V(qt,[["render",na],["__scopeId","data-v-3773fbb8"]]);function oa(e){const{days_to_delete:t}=e;let r={days_to_delete:[t,"isRequired",{"minValue(1)":q("invalid_input")}]};const o=new E(q),{errors:a,isValid:l}=o.validate(r);return N.dispatch("setValidationError",a),{errors:a,isValid:l}}const ia={name:"inapp-settings",data(){return{pageLoad:!1,loading:!1,days_to_delete:"",showModal:!1,only_read:!1}},methods:{isValid(){const{errors:e,isValid:t}=oa(this.$data);return t},onChange(e,t){this[t]=e},onSubmit(){if(this.isValid()){this.pageLoad=!0;const e={};e.days_to_delete=this.days_to_delete,e.only_read=this.only_read,L.delete("/api/clear-notifications",{data:e}).then(t=>{this.pageLoad=!1,T(t,"inapp-settings"),this.days_to_delete="",this.only_read=!1}).catch(t=>{this.pageLoad=!1,M(t,"inapp-settings")})}},triggerEvent(e){var t=e.which||e.keyCode;t===13&&this.onSubmit()}},components:{"number-field":W,checkbox:P}},ra={class:"col-sm-12"},da={class:"card card-light"},ca={class:"card-header"},ma={class:"card-title"},ha={class:"card-body"},pa={class:"row"},ua={class:"row"},_a={class:"card-footer"},ga={key:0,class:"row"};function fa(e,t,r,o,a,l){const u=d("alert"),f=d("number-field"),g=d("checkbox"),v=d("custom-loader"),c=I("focus-first-input");return n(),i("div",ra,[h(u,{componentName:"inapp-settings"}),s("div",da,[s("div",ca,[s("h3",ma,m(e.trans("notification_settings")),1)]),s("div",ha,[C((n(),i("div",pa,[h(f,{label:e.trans("noti_msg1"),value:a.days_to_delete,name:"days_to_delete",onChange:l.onChange,classname:"col-sm-6",keyupListener:l.triggerEvent,type:"number",required:!0,placeholder:"n",hint:e.trans("noti_msg2")},null,8,["label","value","onChange","keyupListener","hint"])])),[[c]]),s("div",ua,[h(g,{id:"delete-read",name:"only_read",value:a.only_read,label:e.trans("delete_noti"),onChange:l.onChange,classname:"col-md-12",hint:e.trans("delete_only_read_tooltip")},null,8,["value","label","onChange","hint"])])]),s("div",_a,[s("button",{class:"btn btn-secondary",onClick:t[0]||(t[0]=_=>l.onSubmit())},[t[1]||(t[1]=s("i",{class:"fas fa-trash"},null,-1)),w(" "+m(e.trans("delete")),1)])])]),a.pageLoad?(n(),i("div",ga,[h(v,{duration:4e3})])):b("",!0)])}const ba=V(ia,[["render",fa]]);let va={path:"/notify/manage",component:Z,name:"Notify",redirect:"/notify/manage/alerts",children:[{path:"channels",component:pe,name:"TemplateSettings",meta:{title:"channels",crumb:{link:{name:"admin_panel",to:"/"},active:"channels"}}},{path:"channels/:channel/template-sets",component:Re,name:"TemplateSetList",meta:{identifier:"template_sets",title:"template-sets",crumb:{link:{name:"admin_panel",to:"/"},parent_link:{name:"channels",to:"/notify/manage/channels"},active:":channel"}}},{path:"channels/:channel/template-sets/:id/templates",component:it,name:"TemplatesList",meta:{identifier:"templates",title:"template-sets",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"channels",to:"/notify/manage/channels"},parent_link:{name:":channel",to:"/notify/manage/channels/:channel/template-sets"},active:"set :id"}}},{path:"channels/:channel/template-sets/:set/templates/:id",component:Ut,name:"TemplateEdit",meta:{identifier:"template_edit",title:"templates",crumb:{link:{name:"admin_panel",to:"/"},root_link:{name:"channels",to:"/notify/manage/channels"},parent_link:{name:"set :set",to:"/notify/manage/channels/:channel/template-sets/:set/templates"},active:"template :id"}}},{path:"alerts",component:la,name:"AlertSettings",meta:{title:"alerts-settings",crumb:{link:{name:"admin_panel",to:"/"},active:"alerts-settings"}}},{path:"in-app",component:ba,name:"InAppSettings",meta:{title:"manage-in-app-logs",crumb:{link:{name:"admin_panel",to:"/"},active:"manage-in-app-logs"}}}]};B.addRoute(va);B.beforeEach((e,t,r)=>{if(e.meta.identifier!==void 0){let o={template_sets:{link:{name:"admin_panel",to:"/"},parent_link:{name:"channels",to:"/notify/manage/channels"},active:":channel"},templates:{link:{name:"admin_panel",to:"/"},root_link:{name:"channels",to:"/notify/manage/channels"},parent_link:{name:":channel",to:"/notify/manage/channels/:channel/template-sets"},active:"set :id"},template_edit:{link:{name:"admin_panel",to:"/"},root_link:{name:"channels",to:"/notify/manage/channels"},parent_link:{name:"set :set",to:"/notify/manage/channels/:channel/template-sets/:set/templates"},active:"template :id"}};e.meta.crumb=o[e.meta.identifier],Object.keys(e.params).forEach(a=>{H(":"+a,e.params[a],e.meta)})}r()});function H(e,t,r){Object.keys(r).forEach(o=>{typeof r[o]=="string"?r[o]=r[o].replace(e,t):typeof r[o]=="object"&&H(e,t,r[o])})}
